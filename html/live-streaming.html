<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›´æ’­ä¸­ - æ˜Ÿä¹‹å£°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            font-size: 18px;
        }

        /* ç¼©å°é¡¶éƒ¨å¯¼èˆªæ  */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 5%; /* å‡å°å†…è¾¹è· */
            background-color: #ff7b25;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); /* å‡å°é˜´å½± */
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo-img {
            width: 36px; /* å‡å°å°ºå¯¸ */
            height: 36px; /* å‡å°å°ºå¯¸ */
            background-color: white;
            border-radius: 50%;
            margin-right: 10px; /* å‡å°é—´è· */
        }

        .logo-text {
            font-size: 20px; /* å‡å°å­—ä½“ */
            font-weight: bold;
            color: white;
        }

        .main-nav {
            display: flex;
            gap: 25px; /* å‡å°é—´è· */
        }

        .nav-item {
            text-decoration: none;
            color: white;
            font-weight: 500;
            font-size: 16px; /* å‡å°å­—ä½“ */
            transition: color 0.3s;
        }

        .nav-item:hover {
            color: #ffe6d6;
        }

        .search-box {
            display: flex;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 16px; /* å‡å°åœ†è§’ */
            padding: 4px 12px; /* å‡å°å†…è¾¹è· */
            width: 200px; /* å‡å°å®½åº¦ */
        }

        .search-input {
            border: none;
            background: transparent;
            outline: none;
            width: 100%;
            padding: 6px 0; /* å‡å°å†…è¾¹è· */
            font-size: 14px; /* å‡å°å­—ä½“ */
        }

        .search-input::placeholder {
            color: #999;
        }

        .search-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            color: #ff7b25;
            font-size: 14px; /* å‡å°å­—ä½“ */
        }

        .user-functions {
            display: flex;
            align-items: center;
            gap: 18px; /* å‡å°é—´è· */
        }

        .func-item {
            text-decoration: none;
            color: white;
            font-size: 16px; /* å‡å°å­—ä½“ */
            display: flex;
            align-items: center;
            gap: 6px; /* å‡å°é—´è· */
        }

        .func-item.active {
            color: #ffe6d6;
            font-weight: 600;
        }

        .submit-btn {
            background-color: white;
            color: #ff7b25;
            border: none;
            padding: 8px 20px; /* å‡å°å†…è¾¹è· */
            border-radius: 20px; /* å‡å°åœ†è§’ */
            cursor: pointer;
            font-weight: 500;
            font-size: 16px; /* å‡å°å­—ä½“ */
            transition: background-color 0.3s;
        }

        .submit-btn:hover {
            background-color: #ffe6d6;
        }

        /* ä¸­é—´å†…å®¹ä¿æŒä¸å˜ */
        .main-content {
            flex: 1;
            padding: 40px 5%;
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
            display: flex;
            gap: 40px;
        }

        .live-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .live-header {
            background-color: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .live-status {
            display: inline-block;
            background-color: #ff4d4d;
            color: white;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 22px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .live-status.pk {
            background-color: #7b61ff;
        }

        .live-title {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 25px;
            color: #333;
        }

        .host-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: #ddd;
            border: 4px solid #ff7b25;
        }

        .host-name {
            font-weight: bold;
            font-size: 24px;
        }

        .students-list {
            display: flex;
            gap: 35px;
            justify-content: center;
            margin-top: 25px;
        }

        .student-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }

        .student-avatar {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background-color: #eee;
            border: 3px solid #4a90e2;
        }

        .student-avatar.live {
            border-color: #ff4d4d;
            position: relative;
        }

        .student-avatar.live::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 20px;
            height: 20px;
            background-color: #ff4d4d;
            border-radius: 50%;
            border: 2px solid white;
        }

        .student-name {
            font-size: 20px;
            font-weight: 500;
        }

        .chat-container {
            background-color: white;
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            height: 600px;
        }

        .chat-header {
            font-weight: bold;
            font-size: 24px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 3px solid #eee;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 25px;
        }

        .message {
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 15px;
            background-color: #f9f9f9;
        }

        .message.host {
            background-color: #fff5e6;
            border-left: 5px solid #ff7b25;
        }

        .message.student {
            background-color: #f0f8ff;
            border-left: 5px solid #4a90e2;
        }

        .message.system {
            background-color: #f0fff4;
            border-left: 5px solid #4cd964;
        }

        .message-sender {
            font-weight: bold;
            margin-bottom: 12px;
            font-size: 20px;
        }

        .message-content {
            margin-bottom: 12px;
            font-size: 18px;
            line-height: 1.6;
        }

        .message-time {
            font-size: 16px;
            color: #999;
            text-align: right;
        }

        .chat-input {
            display: flex;
            gap: 20px;
        }

        .chat-input input {
            flex: 1;
            padding: 18px;
            border: 2px solid #ddd;
            border-radius: 12px;
            outline: none;
            font-size: 18px;
        }

        .chat-input button {
            background-color: #ff7b25;
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }

        .sidebar {
            width: 400px;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .viewers-panel {
            background-color: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .viewers-header {
            font-weight: bold;
            font-size: 24px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 3px solid #eee;
        }

        .viewer-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 2px solid #f5f5f5;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .viewer-item:hover {
            background-color: #f9f9f9;
        }

        .viewer-item.requesting::before {
            content: 'ğŸ“';
            margin-right: 8px;
        }

        .viewer-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .viewer-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #eee;
        }

        .viewer-name {
            font-size: 20px;
            font-weight: 500;
        }

        .manage-btn {
            background-color: #ff7b25;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
        }

        .stats-panel {
            background-color: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .stats-header {
            font-weight: bold;
            font-size: 24px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 3px solid #eee;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            text-align: center;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #ff7b25;
        }

        .stat-value.pk {
            color: #7b61ff;
        }

        .stat-label {
            font-size: 18px;
            color: #666;
        }

        .controls-panel {
            background-color: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
        }

        .controls-header {
            font-weight: bold;
            font-size: 24px;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 3px solid #eee;
        }

        .control-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .control-btn {
            background-color: #f0f2f5;
            border: none;
            padding: 18px 25px;
            border-radius: 12px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 18px;
            font-weight: 500;
        }

        .control-btn:hover {
            background-color: #e4e6e9;
        }

        .control-btn.primary {
            background-color: #ff7b25;
            color: white;
        }

        .control-btn.pk {
            background-color: #7b61ff;
            color: white;
        }

        .control-btn.primary:hover {
            background-color: #e66a1a;
        }

        .control-btn.pk:hover {
            background-color: #6a52e0;
        }

        /* ç¼©å°åº•éƒ¨æ’­æ”¾æ  */
        .player-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 5%; /* å‡å°å†…è¾¹è· */
            background-color: white;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1); /* å‡å°é˜´å½± */
            position: sticky;
            bottom: 0;
            z-index: 100;
        }

        .player-left {
            display: flex;
            align-items: center;
            gap: 12px; /* å‡å°é—´è· */
            width: 25%;
        }

        .channel-cover {
            width: 40px; /* å‡å°å°ºå¯¸ */
            height: 40px; /* å‡å°å°ºå¯¸ */
            border-radius: 6px; /* å‡å°åœ†è§’ */
            background-color: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 10px; /* å‡å°å­—ä½“ */
        }

        .song-info p {
            margin: 0;
        }

        .song-name {
            font-weight: bold;
            font-size: 14px; /* å‡å°å­—ä½“ */
        }

        .singer {
            font-size: 10px; /* å‡å°å­—ä½“ */
            color: #666;
        }

        .player-middle {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 50%;
        }

        .player-controls {
            display: flex;
            align-items: center;
            gap: 12px; /* å‡å°é—´è· */
            margin-bottom: 8px; /* å‡å°é—´è· */
        }

        .player-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 14px; /* å‡å°å­—ä½“ */
            color: #666;
            transition: color 0.3s;
        }

        .player-btn:hover {
            color: #ff7b25;
        }

        .play-btn {
            font-size: 22px; /* å‡å°å­—ä½“ */
        }

        .progress-container {
            display: flex;
            align-items: center;
            gap: 8px; /* å‡å°é—´è· */
            width: 100%;
        }

        .progress-bar {
            flex: 1;
            height: 3px; /* å‡å°é«˜åº¦ */
            background-color: #e4e6e9;
            border-radius: 2px;
            position: relative;
            cursor: pointer;
        }

        .progress-fill {
            height: 100%;
            background-color: #ff7b25;
            border-radius: 2px;
            width: 30%;
        }

        .time {
            font-size: 10px; /* å‡å°å­—ä½“ */
            color: #666;
            min-width: 35px; /* å‡å°å®½åº¦ */
        }

        .player-right {
            display: flex;
            align-items: center;
            gap: 12px; /* å‡å°é—´è· */
            width: 25%;
            justify-content: flex-end;
        }

        .volume-bar {
            width: 60px; /* å‡å°å®½åº¦ */
            height: 3px; /* å‡å°é«˜åº¦ */
            background-color: #e4e6e9;
            border-radius: 2px;
            position: relative;
            cursor: pointer;
        }

        .volume-fill {
            height: 100%;
            background-color: #ff7b25;
            border-radius: 2px;
            width: 70%;
        }

        /* æ–°å¢çš„PKç›¸å…³æ ·å¼ */
        .pk-container {
            display: none;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #eee;
        }

        .pk-container.active {
            display: block;
        }

        .pk-opponent {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .pk-stats {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
        }

        .pk-team {
            text-align: center;
            width: 45%;
        }

        .pk-team-name {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 20px;
        }

        .pk-progress {
            height: 10px;
            background-color: #eee;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }

        .pk-progress-fill {
            height: 100%;
            background-color: #ff7b25;
            width: 50%;
        }

        .pk-progress-fill.opponent {
            background-color: #7b61ff;
        }

        /* è¿éº¦è¯·æ±‚æç¤º */
        .request-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: none;
            z-index: 1000;
        }

        .request-notification.active {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .request-actions {
            display: flex;
            gap: 10px;
            margin-left: 15px;
        }

        .request-btn {
            padding: 5px 15px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-weight: 500;
        }

        .accept {
            background-color: #4cd964;
            color: white;
        }

        .reject {
            background-color: #ff4d4d;
            color: white;
        }
    </style>
</head>
<body>
<!-- é¡¶éƒ¨å¯¼èˆªæ  - å·²ç¼©å° -->
<header class="header">
    <div class="logo">
        <div class="logo-img"></div>
        <span class="logo-text">æ˜Ÿä¹‹å£°</span>
    </div>
    <nav class="main-nav">
        <a href="#" class="nav-item">é¦–é¡µ</a>
        <a href="#" class="nav-item">åˆ†ç±»</a>
        <a href="#" class="nav-item">é¢‘é“</a>
    </nav>
    <div class="search-box">
        <input type="text" placeholder="Hinted search text" class="search-input">
        <button class="search-btn">æœç´¢</button>
    </div>
    <div class="user-functions">
        <a href="#" class="func-item">æ¶ˆæ¯</a>
        <a href="#" class="func-item">æ”¶è—</a>
        <a href="#" class="func-item">å†å²</a>
        <a href="#" class="func-item">åˆ›ä½œä¸­å¿ƒ</a>
        <button class="submit-btn">æŠ•ç¨¿</button>
    </div>
</header>

<!-- ä¸»è¦å†…å®¹åŒº - ä¿æŒä¸å˜ -->
<main class="main-content">
    <div class="live-container">
        <div class="live-header">
            <div class="live-status" id="live-status">ç›´æ’­ä¸­</div>
            <div class="live-title">èŠå¤©å®¤åå­—</div>
            <div class="host-info">
                <div class="avatar"></div>
                <div class="host-name">xxè€å¸ˆ</div>
            </div>

            <!-- PKç›¸å…³åŒºåŸŸ -->
            <div class="pk-container" id="pk-container">
                <div class="pk-opponent">
                    <div>VS</div>
                    <div class="avatar" style="border-color: #7b61ff;"></div>
                    <div class="host-name">yyè€å¸ˆ</div>
                </div>
                <div class="pk-stats">
                    <div class="pk-team">
                        <div class="pk-team-name">æˆ‘æ–¹</div>
                        <div class="stat-value">12</div>
                        <div class="pk-progress">
                            <div class="pk-progress-fill" id="our-pk-progress"></div>
                        </div>
                    </div>
                    <div class="pk-team">
                        <div class="pk-team-name">å¯¹æ–¹</div>
                        <div class="stat-value pk">8</div>
                        <div class="pk-progress">
                            <div class="pk-progress-fill opponent" id="opponent-pk-progress"></div>
                        </div>
                    </div>
                </div>
                <div class="stat-label">PKå‰©ä½™æ—¶é—´: <span id="pk-remaining-time">05:00</span></div>
            </div>

            <div class="students-list">
                <div class="student-item">
                    <div class="student-avatar live"></div>
                    <div class="student-name">å­¦ç”Ÿ1 (è¿éº¦ä¸­)</div>
                </div>
                <div class="student-item">
                    <div class="student-avatar"></div>
                    <div class="student-name">å­¦ç”Ÿ2</div>
                </div>
                <div class="student-item">
                    <div class="student-avatar"></div>
                    <div class="student-name">å­¦ç”Ÿ3</div>
                </div>
            </div>
        </div>

        <div class="chat-container">
            <div class="chat-header">èŠå¤©å®¤</div>
            <div class="chat-messages" id="chat-messages">
                <div class="message host">
                    <div class="message-sender">xxè€å¸ˆ</div>
                    <div class="message-content">æˆ‘è¦ç‚¹ä¸€äº›åŒå­¦è¿éº¦ï¼Œæœ—è¯»ä¸€ä¸‹è¿™æ®µè¯</div>
                    <div class="message-time">2025.11.22 15:03</div>
                </div>
                <div class="message student">
                    <div class="message-sender">å­¦ç”Ÿä¸€</div>
                    <div class="message-content">ç‚¹æˆ‘</div>
                    <div class="message-time">2025.11.22 15:04</div>
                </div>
            </div>
            <div class="chat-input">
                <input type="text" placeholder="è¯·è¾“å…¥æ¶ˆæ¯..." id="message-input">
                <button id="send-message">å‘é€</button>
            </div>
        </div>
    </div>

    <div class="sidebar">
        <div class="viewers-panel">
            <div class="viewers-header">è§‚çœ‹åˆ—è¡¨</div>
            <div class="viewer-item" id="viewer-1">
                <div class="viewer-info">
                    <div class="viewer-avatar"></div>
                    <div class="viewer-name">å­¦ç”Ÿ1</div>
                </div>
                <button class="manage-btn">è¿éº¦</button>
            </div>
            <div class="viewer-item" id="viewer-2">
                <div class="viewer-info">
                    <div class="viewer-avatar"></div>
                    <div class="viewer-name">å­¦ç”Ÿ2</div>
                </div>
                <button class="manage-btn">è¿éº¦</button>
            </div>
            <div class="viewer-item" id="viewer-3">
                <div class="viewer-info">
                    <div class="viewer-avatar"></div>
                    <div class="viewer-name">å­¦ç”Ÿ3</div>
                </div>
                <button class="manage-btn">è¿éº¦</button>
            </div>
        </div>

        <div class="stats-panel">
            <div class="stats-header">ç›´æ’­æ•°æ®</div>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="viewer-count">32</div>
                    <div class="stat-label">æ”¶çœ‹</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="like-count">3</div>
                    <div class="stat-label">ç‚¹èµ</div>
                    <button class="control-btn" id="like-btn" style="padding: 8px 15px; font-size: 16px;">ç‚¹èµ</button>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="live-duration">0:35</div>
                    <div class="stat-label">ç›´æ’­æ—¶é•¿</div>
                </div>
            </div>
        </div>

        <div class="controls-panel">
            <div class="controls-header">æ“ä½œæ </div>
            <div class="control-buttons">
                <button class="control-btn primary">ç®¡ç†ç›´æ’­é—´</button>
                <button class="control-btn" id="invite-btn">é‚€è¯·è¿éº¦</button>
                <button class="control-btn" id="accept-btn" style="display:none;">æ¥å—è¿éº¦</button>
                <button class="control-btn" id="reject-btn" style="display:none;">æ‹’ç»è¿éº¦</button>
                <button class="control-btn" id="start-pk-btn" class="pk">å‘èµ·PK</button>
                <button class="control-btn" id="end-pk-btn" class="pk" style="display:none;">ç»“æŸPK</button>
                <button class="control-btn">åˆ†äº«ç›´æ’­</button>
                <button class="control-btn">è®¾ç½®</button>
            </div>
        </div>
    </div>
</main>

<!-- è¿éº¦è¯·æ±‚é€šçŸ¥ -->
<div class="request-notification" id="request-notification">
    <div>
        <strong id="requester-name">å­¦ç”Ÿ2</strong> è¯·æ±‚è¿éº¦
    </div>
    <div class="request-actions">
        <button class="request-btn accept" id="accept-request">æ¥å—</button>
        <button class="request-btn reject" id="reject-request">æ‹’ç»</button>
    </div>
</div>

<!-- åº•éƒ¨æ’­æ”¾æ  - å·²ç¼©å° -->
<footer class="player-bar">
    <div class="player-left">
        <div class="channel-cover">é¢‘é“</div>
        <div class="song-info">
            <p class="song-name">Seasons in</p>
            <p class="singer">James</p>
        </div>
    </div>
    <div class="player-middle">
        <div class="player-controls">
            <button class="player-btn">ä¸Šä¸€é¦–</button>
            <button class="player-btn play-btn">æ’­æ”¾</button>
            <button class="player-btn">ä¸‹ä¸€é¦–</button>
            <button class="player-btn">éšæœº</button>
        </div>
        <div class="progress-container">
            <span class="time current">00:00</span>
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
            <span class="time total">00:00</span>
        </div>
    </div>
    <div class="player-right">
        <button class="player-btn">éŸ³é‡</button>
        <div class="volume-bar">
            <div class="volume-fill"></div>
        </div>
    </div>
</footer>

<script>
    // æ•°æ®ç»Ÿè®¡ç›¸å…³å˜é‡
    let viewerCount = 32;
    let likeCount = 3;
    let liveStartTime = new Date();
    liveStartTime.setMinutes(liveStartTime.getMinutes() - 35); // æ¨¡æ‹Ÿå·²ç›´æ’­35åˆ†é’Ÿ
    let isInPk = false;
    let pkOurScore = 12;
    let pkOpponentScore = 8;
    let pkRemainingTime = 300; // 5åˆ†é’Ÿï¼Œå•ä½ï¼šç§’
    let currentRequester = null;

    // DOMå…ƒç´ 
    const viewerCountEl = document.getElementById('viewer-count');
    const likeCountEl = document.getElementById('like-count');
    const liveDurationEl = document.getElementById('live-duration');
    const likeBtn = document.getElementById('like-btn');
    const chatMessagesEl = document.getElementById('chat-messages');
    const messageInputEl = document.getElementById('message-input');
    const sendMessageBtn = document.getElementById('send-message');
    const inviteBtn = document.getElementById('invite-btn');
    const acceptBtn = document.getElementById('accept-btn');
    const rejectBtn = document.getElementById('reject-btn');
    const startPkBtn = document.getElementById('start-pk-btn');
    const endPkBtn = document.getElementById('end-pk-btn');
    const liveStatusEl = document.getElementById('live-status');
    const pkContainerEl = document.getElementById('pk-container');
    const ourPkProgressEl = document.getElementById('our-pk-progress');
    const opponentPkProgressEl = document.getElementById('opponent-pk-progress');
    const pkRemainingTimeEl = document.getElementById('pk-remaining-time');
    const requestNotificationEl = document.getElementById('request-notification');
    const requesterNameEl = document.getElementById('requester-name');
    const acceptRequestBtn = document.getElementById('accept-request');
    const rejectRequestBtn = document.getElementById('reject-request');
    const viewerItems = [
        document.getElementById('viewer-1'),
        document.getElementById('viewer-2'),
        document.getElementById('viewer-3')
    ];

    // æ›´æ–°ç›´æ’­æ—¶é•¿
    function updateLiveDuration() {
        const now = new Date();
        const durationMs = now - liveStartTime;
        const minutes = Math.floor(durationMs / 60000);
        const seconds = Math.floor((durationMs % 60000) / 1000);
        liveDurationEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    }

    // éšæœºæ›´æ–°è§‚çœ‹äººæ•°
    function randomUpdateViewerCount() {
        if (Math.random() > 0.7) { // 30%æ¦‚ç‡æ›´æ–°
            const change = Math.floor(Math.random() * 5) - 2; // -2åˆ°2ä¹‹é—´çš„éšæœºæ•°
            viewerCount = Math.max(1, viewerCount + change);
            viewerCountEl.textContent = viewerCount;
        }
    }

    // æ›´æ–°PKè¿›åº¦
    function updatePkProgress() {
        const total = pkOurScore + pkOpponentScore;
        const ourPercent = total > 0 ? (pkOurScore / total) * 100 : 50;
        const opponentPercent = 100 - ourPercent;

        ourPkProgressEl.style.width = `${ourPercent}%`;
        opponentPkProgressEl.style.width = `${opponentPercent}%`;

        // æ›´æ–°å‰©ä½™æ—¶é—´
        const minutes = Math.floor(pkRemainingTime / 60);
        const seconds = pkRemainingTime % 60;
        pkRemainingTimeEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

        // éšæœºå¢åŠ PKåˆ†æ•°
        if (Math.random() > 0.85) {
            if (Math.random() > 0.5) {
                pkOurScore++;
            } else {
                pkOpponentScore++;
            }
        }
    }

    // å‘é€æ¶ˆæ¯
    function sendMessage(sender, content, isHost = false) {
        const now = new Date();
        const timeStr = `${now.getFullYear()}.${(now.getMonth() + 1).toString().padStart(2, '0')}.${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;

        const messageEl = document.createElement('div');
        messageEl.className = `message ${isHost ? 'host' : 'student'}`;
        messageEl.innerHTML = `
            <div class="message-sender">${sender}</div>
            <div class="message-content">${content}</div>
            <div class="message-time">${timeStr}</div>
        `;

        chatMessagesEl.appendChild(messageEl);
        chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight; // æ»šåŠ¨åˆ°åº•éƒ¨
    }

    // æ˜¾ç¤ºç³»ç»Ÿæ¶ˆæ¯
    function showSystemMessage(content) {
        const now = new Date();
        const timeStr = `${now.getFullYear()}.${(now.getMonth() + 1).toString().padStart(2, '0')}.${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;

        const messageEl = document.createElement('div');
        messageEl.className = 'message system';
        messageEl.innerHTML = `
            <div class="message-sender">ç³»ç»Ÿæ¶ˆæ¯</div>
            <div class="message-content">${content}</div>
            <div class="message-time">${timeStr}</div>
        `;

        chatMessagesEl.appendChild(messageEl);
        chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
    }

    // å‘èµ·è¿éº¦è¯·æ±‚
    function requestConnection(viewerId, viewerName) {
        currentRequester = { id: viewerId, name: viewerName };
        requesterNameEl.textContent = viewerName;
        requestNotificationEl.classList.add('active');

        // 30ç§’åè‡ªåŠ¨æ‹’ç»
        setTimeout(() => {
            if (requestNotificationEl.classList.contains('active')) {
                rejectConnection();
            }
        }, 30000);
    }

    // æ¥å—è¿éº¦
    function acceptConnection() {
        if (currentRequester) {
            showSystemMessage(`${currentRequester.name} å·²è¿éº¦`);
            viewerItems[currentRequester.id - 1].querySelector('.manage-btn').textContent = 'æ–­å¼€';
        }
        requestNotificationEl.classList.remove('active');
        currentRequester = null;
    }

    // æ‹’ç»è¿éº¦
    function rejectConnection() {
        if (currentRequester) {
            showSystemMessage(`å·²æ‹’ç» ${currentRequester.name} çš„è¿éº¦è¯·æ±‚`);
        }
        requestNotificationEl.classList.remove('active');
        currentRequester = null;
    }

    // å¼€å§‹PK
    function startPK() {
        isInPk = true;
        liveStatusEl.classList.add('pk');
        liveStatusEl.textContent = 'ç›´æ’­ä¸­ - PKè¿›è¡Œä¸­';
        pkContainerEl.classList.add('active');
        startPkBtn.style.display = 'none';
        endPkBtn.style.display = 'inline-flex';
        showSystemMessage('PKå·²å¼€å§‹ï¼ŒåŒæ–¹åŠ æ²¹ï¼');
    }

    // ç»“æŸPK
    function endPK() {
        isInPk = false;
        liveStatusEl.classList.remove('pk');
        liveStatusEl.textContent = 'ç›´æ’­ä¸­';
        pkContainerEl.classList.remove('active');
        startPkBtn.style.display = 'inline-flex';
        endPkBtn.style.display = 'none';

        let result = '';
        if (pkOurScore > pkOpponentScore) {
            result = 'æˆ‘æ–¹è·èƒœï¼';
        } else if (pkOurScore < pkOpponentScore) {
            result = 'å¯¹æ–¹è·èƒœï¼';
        } else {
            result = 'åŒæ–¹å¹³å±€ï¼';
        }

        showSystemMessage(`PKå·²ç»“æŸï¼Œ${result} æ¯”åˆ†: ${pkOurScore} - ${pkOpponentScore}`);

        // é‡ç½®PKæ•°æ®
        pkOurScore = 0;
        pkOpponentScore = 0;
        pkRemainingTime = 300;
    }

    // äº‹ä»¶ç›‘å¬
    likeBtn.addEventListener('click', () => {
        likeCount++;
        likeCountEl.textContent = likeCount;

        // PKæœŸé—´ç‚¹èµå¢åŠ åˆ†æ•°
        if (isInPk) {
            pkOurScore++;
            updatePkProgress();
        }
    });

    sendMessageBtn.addEventListener('click', () => {
        const content = messageInputEl.value.trim();
        if (content) {
            sendMessage('æˆ‘', content);
            messageInputEl.value = '';
        }
    });

    messageInputEl.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            sendMessageBtn.click();
        }
    });

    inviteBtn.addEventListener('click', () => {
        // éšæœºé‚€è¯·ä¸€ä¸ªè§‚ä¼—
        const randomIndex = Math.floor(Math.random() * viewerItems.length);
        const viewerName = viewerItems[randomIndex].querySelector('.viewer-name').textContent;
        showSystemMessage(`å·²é‚€è¯· ${viewerName} è¿éº¦`);
    });

    acceptBtn.addEventListener('click', acceptConnection);
    rejectBtn.addEventListener('click', rejectConnection);
    acceptRequestBtn.addEventListener('click', acceptConnection);
    rejectRequestBtn.addEventListener('click', rejectConnection);

    startPkBtn.addEventListener('click', startPK);
    endPkBtn.addEventListener('click', endPK);

    // ä¸ºæ¯ä¸ªè§‚ä¼—é¡¹æ·»åŠ è¿éº¦è¯·æ±‚äº‹ä»¶
    viewerItems.forEach((item, index) => {
        const manageBtn = item.querySelector('.manage-btn');
        const viewerName = item.querySelector('.viewer-name').textContent;

        manageBtn.addEventListener('click', () => {
            if (manageBtn.textContent === 'è¿éº¦') {
                requestConnection(index + 1, viewerName);
            } else {
                showSystemMessage(`${viewerName} å·²æ–­å¼€è¿éº¦`);
                manageBtn.textContent = 'è¿éº¦';
            }
        });
    });

    // å®šæ—¶æ›´æ–°æ•°æ®
    setInterval(updateLiveDuration, 1000);
    setInterval(randomUpdateViewerCount, 5000);

    // PKå®šæ—¶æ›´æ–°
    setInterval(() => {
        if (isInPk) {
            pkRemainingTime--;
            updatePkProgress();

            if (pkRemainingTime <= 0) {
                endPK();
            }
        }
    }, 1000);

    // æ¨¡æ‹Ÿå®æ—¶æ¶ˆæ¯
    setInterval(() => {
        if (Math.random() > 0.7 && !isInPk) { // 30%æ¦‚ç‡å‘é€æ¨¡æ‹Ÿæ¶ˆæ¯
            const students = ['å­¦ç”Ÿ1', 'å­¦ç”Ÿ2', 'å­¦ç”Ÿ3'];
            const randomStudent = students[Math.floor(Math.random() * students.length)];
            const messages = [
                'è€å¸ˆï¼Œè¿™ä¸ªé—®é¢˜æˆ‘ä¸å¤ªæ‡‚',
                'èƒ½å†è®²ä¸€éå—ï¼Ÿ',
                'æˆ‘æ˜ç™½äº†ï¼Œè°¢è°¢è€å¸ˆ',
                'è¿™ä¸ªçŸ¥è¯†ç‚¹å¥½éš¾å•Š',
                'æœ‰æ²¡æœ‰ç›¸å…³çš„èµ„æ–™å¯ä»¥å‚è€ƒï¼Ÿ'
            ];
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            sendMessage(randomStudent, randomMessage);
        }
    }, 15000);
</script>
</body>
</html>