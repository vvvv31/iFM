<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>分类 - 星之声</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/category.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="../js/search.js"></script>
    <script src="../js/category.js"></script>
    <script src="../js/script.js" defer></script>
    <style>
        /* 新增样式：确保内容不被底部播放栏遮挡 */
        .main-content {
            padding-bottom: 96px; /* PlayBar高度约96px */
        }

        /* 紧凑模式下的额外样式 */
        .teacher-avatar {
            font-family: "微软雅黑", sans-serif;
        }

        /* PlayBar（来自 PlayBar.html）的样式 */
        .pv-player-bar {
          position: fixed; left: 0; right: 0; bottom: 0;
          width: 100%; height: 96px; background: #ffffff;
          border-top: 1px solid #e0e0e0; box-shadow: 0 -4px 20px rgba(0,0,0,0.08);
          z-index: 29999; display: flex; align-items: center; user-select: none; pointer-events: auto;
        }
        .pv-inner {
          width: 100%; max-width: 1200px; margin: 0 auto;
          display: grid;
          grid-template-columns: auto 1fr auto;
          align-items: center;
          column-gap: 16px;
          padding: 0 24px;
          height: 100%;
        }
        .pv-left { display: inline-flex; align-items: center; gap: 12px; min-width: 240px; }
        .pv-cover { width: 52px; height: 52px; border-radius: 8px; background: #eee no-repeat center/cover; box-shadow: 0 2px 6px rgba(0,0,0,0.1); flex-shrink: 0; }
        .pv-meta { display: flex; flex-direction: column; min-width: 0; }
        .pv-title { font-size: 16px; font-weight: 700; color: #222; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .pv-artist { font-size: 12px; color: #666; margin-top: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .pv-center { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; min-width: 0; }
        .pv-controls { display: inline-flex; align-items: center; gap: 18px; }
        .ctrl-btn, .mode-btn, .rate-btn {
          background: transparent; border: none; cursor: pointer; color: #444;
          font-size: 18px; padding: 6px; display: inline-flex; align-items: center; justify-content: center; transition: color 0.2s;
        }
        .ctrl-btn:hover, .mode-btn:hover, .rate-btn:hover { color: #ff8c00; }
        .play-btn {
          width: 44px; height: 44px; border-radius: 50%; background: #ff8c00; color: #fff; border: none;
          display: inline-flex; align-items: center; justify-content: center; cursor: pointer;
          box-shadow: 0 4px 10px rgba(255,140,0,0.30); transition: transform 0.1s, background 0.2s;
        }
        .play-btn:hover { background: #e67e00; transform: scale(1.05); }
        .icon { width: 18px; height: 18px; fill: currentColor; }
        .pv-progress-row { display: flex; align-items: center; gap: 12px; width: 100%; }
        .time.small { font-size: 12px; color: #888; width: 48px; text-align: center; font-variant-numeric: tabular-nums; }
        .pv-progress { position: relative; flex: 1; height: 6px; background: #eee; border-radius: 3px; cursor: pointer; touch-action: none; }
        .pv-progress::before { content: ''; position: absolute; top: -10px; bottom: -10px; left: 0; right: 0; z-index: 1; }
        .pv-progress-fill { position: absolute; left: 0; top: 0; bottom: 0; background: #ff8c00; border-radius: 3px; width: 0%; pointer-events: none; }
        .pv-knob { position: absolute; top: 50%; right: -6px; transform: translateY(-50%); width: 12px; height: 12px; background: #fff; border: 2px solid #ff8c00; border-radius: 50%; box-shadow: 0 1px 4px rgba(0,0,0,0.2); opacity: 0; transition: opacity 0.2s; pointer-events: none; }
        .pv-progress:hover .pv-knob, .pv-progress.dragging .pv-knob { opacity: 1; }
        .pv-right { display: inline-flex; align-items: center; justify-content: flex-end; gap: 12px; min-width: 240px; }
        .pv-volume { width: 140px; height: 20px; display: flex; align-items: center; cursor: pointer; position: relative; }
        .pv-volume-bar { width: 100%; height: 4px; background: #eee; border-radius: 2px; position: relative; overflow: visible; pointer-events: none; }
        .pv-volume-fill { height: 100%; background: #888; width: 50%; border-radius: 2px; position: relative; }
        .pv-volume-fill::after { content: ''; position: absolute; right: -5px; top: 50%; transform: translateY(-50%); width: 10px; height: 10px; background: #fff; border: 1px solid #888; border-radius: 50%; opacity: 0; transition: opacity 0.2s; }
        .pv-volume:hover .pv-volume-fill::after { opacity: 1; }
        .popover { position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); background: #fff; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 10px 24px rgba(0,0,0,0.12); padding: 8px; z-index: 30000; display: none; }
        .popover.show { display: flex; }
        .mode-popover { gap: 10px; align-items: center; }
        .mode-item { width: 40px; height: 40px; border-radius: 8px; border: 1px solid #eee; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; color: #444; }
        .mode-item:hover { color: #ff8c00; border-color: #ffeed6; background: #fff9f0; }
        .mode-item.active { color: #fff; background: #ff8c00; border-color: #ff8c00; }
        .rate-popover { flex-direction: column; min-width: 140px; }
        .rate-item { padding: 8px 12px; font-size: 14px; color: #333; cursor: pointer; border-radius: 6px; }
        .rate-item:hover { background: #f7f7f7; }
        .rate-item.active { color: #ff8c00; font-weight: 700; background: #fff4e6; }
        @media (max-width: 900px) {
          .pv-left { min-width: 0; }
          .pv-right { min-width: 0; }
          .pv-inner { grid-template-columns: auto 1fr auto; column-gap: 10px; padding: 0 12px; }
        }
    </style>
</head>
<body>
    <!-- 音频元素 -->
    <audio id="audioPlayer" controls style="display: none;">
        <source src="" type="audio/mpeg">
        您的浏览器不支持音频播放
    </audio>

    <!-- 顶部导航栏 -->
    <header class="header">
        <div class="logo">
            <div class="logo-img"></div>
            <span class="logo-text">星之声</span>
        </div>
        <nav class="main-nav">
            <a href="index.html" class="nav-item">首页</a>
            <a href="category.html" class="nav-item active">分类</a>
            <a href="channel.html" class="nav-item">社区</a>
        </nav>
        <div class="search-box">
            <input type="text" placeholder="搜索课程、频道..." class="search-input" id="homeSearchInput">
            <button class="search-btn" id="homeSearchBtn"><i class="fas fa-search"></i></button>
        </div>
        <div class="user-functions">
            <a href="my-recent.html" class="func-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
            </a>
            <a href="my-message.html" class="func-item"><i class="fas fa-bell"></i> 消息</a>
            <a href="my-collect.html" class="func-item"><i class="fas fa-star"></i> 收藏</a>
            <a href="my-recent.html" class="func-item"><i class="fas fa-history"></i> 历史</a>
            <a href="my-creator_center.html" class="func-item"><i class="fas fa-pen"></i> 创作中心</a>
            <a href="login.html"><button class="submit-btn">登录/注册</button></a>
        </div>
    </header>

    <!-- 主要内容区域 -->
    <main class="main-content">
        <!-- 分类页面标题 -->
        <div class="category-header">
            <h1>课程分类</h1>
            <p>选择适合的英语学习资源</p>
        </div>

        <!-- 分类过滤选项 -->
        <div class="filter-section">
            <!-- 类型过滤 -->
            <div class="filter-group">
                <span class="filter-label">类型：</span>
                <div class="filter-options" id="typeOptions">
                    <button class="filter-option active" data-type="audio">音频</button>
                    <button class="filter-option" data-type="live">直播</button>
                </div>
            </div>

            <!-- 种类过滤 -->
            <div class="filter-group">
                <span class="filter-label">种类：</span>
                <!-- 音频专属种类（默认显示） -->
                <div class="filter-options" id="audioCategories" style="display: flex;">
                    <button class="filter-option active">音乐</button>
                    <button class="filter-option">演讲</button>
                    <button class="filter-option">有声书</button>
                    <button class="filter-option">播客剧</button>
                </div>
                <!-- 直播专属种类（默认隐藏） -->
                <div class="filter-options" id="liveCategories" style="display: none;">
                    <button class="filter-option active">实时访谈</button>
                    <button class="filter-option">直播讲座</button>
                    <button class="filter-option">互动演出</button>
                    <button class="filter-option">答疑直播</button>
                </div>
            </div>

            <!-- 排序选项 -->
            <div class="filter-group">
                <span class="filter-label">排序：</span>
                <div class="filter-options" id="sortOptions">
                    <!-- 原“默认”→改为“时间”，添加data-sort属性标记排序类型 -->
                    <button class="filter-option active" data-sort="time">时间</button>
                    <button class="filter-option" data-sort="popularity">热度</button>
                </div>
            </div>
        </div>

        <!-- 频道网格展示 -->
        <div class="channels-grid">
            <!-- 频道卡片 1 -->
            <div class="channel-card" data-course-id="1">
                <div class="channel-thumbnail">
                    <div class="thumbnail-overlay">
                        <span class="play-icon">▶</span>
                        <span class="video-duration">45:30</span>
                    </div>
                </div>
                <div class="channel-info">
                    <h3 class="channel-title">商务英语会话技巧</h3>
                    <div class="channel-meta">
                        <span class="views-count">2.5万次学习</span>
                        <span class="rating">★★★★★</span>
                    </div>
                    <div class="teacher-info">
                        <div class="teacher-avatar">李</div>
                        <span class="teacher-name">李老师</span>
                    </div>
                </div>
            </div>

            <!-- 频道卡片 2 -->
            <div class="channel-card" data-course-id="2">
                <div class="channel-thumbnail">
                    <div class="thumbnail-overlay">
                        <span class="play-icon">▶</span>
                        <span class="video-duration">60:15</span>
                    </div>
                </div>
                <div class="channel-info">
                    <h3 class="channel-title">日常英语口语600句</h3>
                    <div class="channel-meta">
                        <span class="views-count">5.0万次学习</span>
                        <span class="rating">★★★★★</span>
                    </div>
                    <div class="teacher-info">
                        <div class="teacher-avatar">王</div>
                        <span class="teacher-name">王老师</span>
                    </div>
                </div>
            </div>

            <!-- 频道卡片 3 -->
            <div class="channel-card" data-course-id="3">
                <div class="channel-thumbnail">
                    <div class="thumbnail-overlay">
                        <span class="play-icon">▶</span>
                        <span class="video-duration">38:20</span>
                    </div>
                </div>
                <div class="channel-info">
                    <h3 class="channel-title">英语听力进阶训练</h3>
                    <div class="channel-meta">
                        <span class="views-count">1.4万次学习</span>
                        <span class="rating">★★★★★</span>
                    </div>
                    <div class="teacher-info">
                        <div class="teacher-avatar">张</div>
                        <span class="teacher-name">张老师</span>
                    </div>
                </div>
            </div>

            <!-- 频道卡片 4 -->
            <div class="channel-card" data-course-id="4">
                <div class="channel-thumbnail">
                    <div class="thumbnail-overlay">
                        <span class="play-icon">▶</span>
                        <span class="video-duration">52:10</span>
                    </div>
                </div>
                <div class="channel-info">
                    <h3 class="channel-title">英语写作技巧提升</h3>
                    <div class="channel-meta">
                        <span class="views-count">10万次学习</span>
                        <span class="rating">★★★★★</span>
                    </div>
                    <div class="teacher-info">
                        <div class="teacher-avatar">张</div>
                        <span class="teacher-name">张老师</span>
                    </div>
                </div>
            </div>

            <!-- 频道卡片 5 -->
            <div class="channel-card" data-course-id="5">
                <div class="channel-thumbnail">
                    <div class="thumbnail-overlay">
                        <span class="play-icon">▶</span>
                        <span class="video-duration">28:55</span>
                    </div>
                </div>
                <div class="channel-info">
                    <h3 class="channel-title">零基础英语入门</h3>
                    <div class="channel-meta">
                        <span class="views-count">8.2万次学习</span>
                        <span class="rating">★★★★★</span>
                    </div>
                    <div class="teacher-info">
                        <div class="teacher-avatar">刘</div>
                        <span class="teacher-name">刘老师</span>
                    </div>
                </div>
            </div>

            <!-- 频道卡片 6 -->
            <div class="channel-card" data-course-id="6">
                <div class="channel-thumbnail">
                    <div class="thumbnail-overlay">
                        <span class="play-icon">▶</span>
                        <span class="video-duration">36:30</span>
                    </div>
                </div>
                <div class="channel-info">
                    <h3 class="channel-title">英语语法精讲</h3>
                    <div class="channel-meta">
                        <span class="views-count">4.3万次学习</span>
                        <span class="rating">★★★★★</span>
                    </div>
                    <div class="teacher-info">
                        <div class="teacher-avatar">赵</div>
                        <span class="teacher-name">赵老师</span>
                    </div>
                </div>
            </div>

            <!-- 频道卡片 7 -->
            <div class="channel-card" data-course-id="7">
                <div class="channel-thumbnail">
                    <div class="thumbnail-overlay">
                        <span class="play-icon">▶</span>
                        <span class="video-duration">41:25</span>
                    </div>
                </div>
                <div class="channel-info">
                    <h3 class="channel-title">旅游英语口语</h3>
                    <div class="channel-meta">
                        <span class="views-count">3.7万次学习</span>
                        <span class="rating">★★★★★</span>
                    </div>
                    <div class="teacher-info">
                        <div class="teacher-avatar">孙</div>
                        <span class="teacher-name">孙老师</span>
                    </div>
                </div>
            </div>

            <!-- 频道卡片 8 -->
            <div class="channel-card" data-course-id="8">
                <div class="channel-thumbnail">
                    <div class="thumbnail-overlay">
                        <span class="play-icon">▶</span>
                        <span class="video-duration">47:40</span>
                    </div>
                </div>
                <div class="channel-info">
                    <h3 class="channel-title">英语发音纠正</h3>
                    <div class="channel-meta">
                        <span class="views-count">2.8万次学习</span>
                        <span class="rating">★★★★★</span>
                    </div>
                    <div class="teacher-info">
                        <div class="teacher-avatar">周</div>
                        <span class="teacher-name">周老师</span>
                    </div>
                </div>
            </div>

            <!-- 频道卡片 9 -->
            <div class="channel-card" data-course-id="9">
                <div class="channel-thumbnail">
                    <div class="thumbnail-overlay">
                        <span class="play-icon">▶</span>
                        <span class="video-duration">39:15</span>
                    </div>
                </div>
                <div class="channel-info">
                    <h3 class="channel-title">英语面试技巧</h3>
                    <div class="channel-meta">
                        <span class="views-count">3.2万次学习</span>
                        <span class="rating">★★★★★</span>
                    </div>
                    <div class="teacher-info">
                        <div class="teacher-avatar">吴</div>
                        <span class="teacher-name">吴老师</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 分页控制 -->
        <div class="pagination">
            <button class="page-btn prev-btn">上一页</button>
            <button class="page-btn active">1</button>
            <button class="page-btn">2</button>
            <button class="page-btn">3</button>
            <span class="page-ellipsis">...</span>
            <button class="page-btn">10</button>
            <button class="page-btn next-btn">下一页</button>
        </div>
    </main>

    <!-- 使用 PlayBar.html 的播放栏 -->
    <aside id="pv-player" class="pv-player-bar">
      <div class="pv-inner">
        <div class="pv-left">
          <div id="pv-cover" class="pv-cover"></div>
          <div class="pv-meta">
            <div id="pv-title" class="pv-title">Kalimba (Test Audio)</div>
            <div id="pv-artist" class="pv-artist">Ninja Tuna</div>
          </div>
        </div>

        <div class="pv-center">
          <div class="pv-controls">
            <button id="pv-prev" class="ctrl-btn" title="上一首" aria-label="上一首">
              <svg class="icon" viewBox="0 0 24 24"><path d="M6 6h2v12H6V6zm3.5 6l8.5 6V6l-8.5 6z"/></svg>
            </button>
            <button id="pv-play" class="play-btn" title="播放/暂停" aria-label="播放/暂停">
              <svg id="play-icon" class="icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            </button>
            <button id="pv-next" class="ctrl-btn" title="下一首" aria-label="下一首">
              <svg class="icon" viewBox="0 0 24 24"><path d="M16 6h2v12h-2V6zM6 18l8.5-6L6 6v12z"/></svg>
            </button>

            <div style="position: relative;">
              <button id="pv-mode-btn" class="mode-btn" title="播放模式" aria-label="播放模式">
                <svg class="icon" viewBox="0 0 24 24"><path d="M7 7h8v3l4-4-4-4v3H5v6h2V7zm10 10H9v-3l-4 4 4 4v-3h10v-6h-2v4z"/></svg>
              </button>
              <div id="mode-pop" class="popover mode-popover">
                <div class="mode-item active" data-mode="single" title="单曲循环">
                  <svg class="icon" viewBox="0 0 24 24"><path d="M12 5v4l-1.5-1.5C8 10 8 14 10.5 16.5S16 19 18.5 16.5L20 18c-3 3-8 3-11 0S6 9 9 6L12 5z"/></svg>
                </div>
                <div class="mode-item" data-mode="list" title="歌单顺序循环">
                  <svg class="icon" viewBox="0 0 24 24"><path d="M4 6h12v2H4V6zm0 5h12v2H4v-2zm0 5h8v2H4v-2zm15-7l-3 3h2v4h2v-4h2l-3-3z"/></svg>
                </div>
                <div class="mode-item" data-mode="shuffle" title="歌单乱序循环">
                  <svg class="icon" viewBox="0 0 24 24"><path d="M16 3h5v5h-2V6.41l-4.29 4.3-1.42-1.42L17.59 5H16V3zM4 6h7l2 2H4V6zm0 6h5l2 2H4v-2zm12 3h1.59l-2.29 2.29 1.42 1.42L20 17.41V19h2v-5h-5v2z"/></svg>
                </div>
              </div>
            </div>

            <div class="rate-control" style="position: relative;">
              <button id="pv-rate-btn" class="rate-btn" title="倍速"><span id="rate-text" style="font-size: 12px; font-weight: bold;">1x</span></button>
              <div id="rate-pop" class="popover rate-popover">
                <div class="rate-item" data-rate="0.5">0.5x</div>
                <div class="rate-item active" data-rate="1">1.0x</div>
                <div class="rate-item" data-rate="1.5">1.5x</div>
                <div class="rate-item" data-rate="2">2.0x</div>
              </div>
            </div>
          </div>

          <div class="pv-progress-row">
            <span id="pv-time-cur" class="time small">00:00</span>
            <div id="pv-progress" class="pv-progress">
              <div id="pv-progress-fill" class="pv-progress-fill"></div>
              <div id="pv-knob" class="pv-knob"></div>
            </div>
            <span id="pv-time-total" class="time small">00:00</span>
          </div>
        </div>

        <div class="pv-right">
          <button id="pv-mute" class="ctrl-btn" title="静音/取消静音" aria-label="静音">
            <svg id="vol-icon" class="icon" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3z"/></svg>
          </button>
          <div id="pv-volume" class="pv-volume">
            <div class="pv-volume-bar"><div id="pv-volume-fill" class="pv-volume-fill"></div></div>
          </div>
          <button id="pv-list-btn" class="ctrl-btn" title="播放列表" aria-label="播放列表">
            <svg class="icon" viewBox="0 0 24 24"><path d="M3 5h18v2H3V5zm0 6h12v2H3v-2zm0 6h8v2H3v-2z"/></svg>
          </button>
        </div>
      </div>

      <div id="playlist-panel" class="playlist-panel" style="display:none;">
        <div class="playlist-item active" onclick="playIndex(0)">1. Kalimba (Test)</div>
        <div class="playlist-item" onclick="playIndex(1)">2. Sample MP3 (Test)</div>
      </div>

      <audio id="pv-audio" preload="metadata"></audio>
    </aside>

    <!-- 页面功能脚本（保留与分类相关的逻辑，移除原播放器控制脚本） -->
    <script>
        // 为所有频道卡片添加点击事件 - 跳转到详情页
        document.querySelectorAll('.channel-card').forEach((card, index) => {
            card.addEventListener('click', () => {
                const courseId = card.getAttribute('data-course-id') || (index + 1);
                const title = card.querySelector('.channel-title').textContent;
                const teacher = card.querySelector('.teacher-name').textContent;
                const duration = card.querySelector('.video-duration').textContent;
                const views = card.querySelector('.views-count').textContent;
                
                const courseInfo = {
                    id: courseId,
                    title: title,
                    teacher: teacher,
                    duration: duration,
                    views: views,
                    rating: '★★★★★',
                    description: getCourseDescription(courseId),
                    chapters: getCourseChapters(courseId)
                };
                
                localStorage.setItem('currentCourse', JSON.stringify(courseInfo));
                window.location.href = 'program_list.html';
            });
        });

        function getCourseDescription(courseId) {
            const descriptions = {
                1: "本课程专为商务人士设计，涵盖商务会议、谈判、邮件写作等实用场景，帮助您提升商务英语沟通能力。",
                2: "精选600个日常口语表达，覆盖生活、工作、旅行等各个方面，让您的英语口语更地道。",
                3: "通过系统训练，提高英语听力理解能力，帮助您更好地理解英语对话和讲座。",
                4: "从基础到高级，系统学习英语写作技巧，提高写作表达能力。",
                5: "为零基础学习者设计，从字母发音开始，循序渐进学习英语基础知识。",
                6: "系统讲解英语语法规则，帮助您理解和使用正确的英语语法结构。",
                7: "针对旅游场景的实用英语口语，让您出国旅游更加顺畅。",
                8: "纠正常见的英语发音问题，提高口语发音准确性和流利度。",
                9: "学习英语面试中的常见问题和回答技巧，提高面试成功率。"
            };
            return descriptions[courseId] || "本课程内容丰富，适合不同水平的学习者。";
        }

        function getCourseChapters(courseId) {
            const chaptersData = {
                1: [
                    { title: "商务会议英语", duration: "15:30" },
                    { title: "商务谈判技巧", duration: "18:20" },
                    { title: "商务邮件写作", duration: "11:40" }
                ],
                2: [
                    { title: "日常问候与介绍", duration: "20:15" },
                    { title: "餐厅点餐用语", duration: "15:30" },
                    { title: "购物砍价技巧", duration: "24:30" }
                ],
                3: [
                    { title: "听力基础训练", duration: "15:00" },
                    { title: "对话听力理解", duration: "12:20" },
                    { title: "讲座听力技巧", duration: "10:40" }
                ]
            };
            return chaptersData[courseId] || [
                { title: "第一课", duration: "10:00" },
                { title: "第二课", duration: "12:00" },
                { title: "第三课", duration: "15:00" }
            ];
        }

        // 过滤按钮功能
        document.querySelectorAll('.filter-option').forEach(option => {
            option.addEventListener('click', function() {
                const group = this.parentElement;
                const activeBtn = group.querySelector('.filter-option.active');
                if (activeBtn) activeBtn.classList.remove('active');
                this.classList.add('active');
            });
        });

        // 分页按钮功能
        document.querySelectorAll('.page-btn:not(.prev-btn):not(.next-btn)').forEach(btn => {
            btn.addEventListener('click', function() {
                const activeBtn = document.querySelector('.page-btn.active');
                if (activeBtn) activeBtn.classList.remove('active');
                this.classList.add('active');
            });
        });
    </script>

    <!-- 引入 PlayBar.html 的功能脚本 -->
    <script>
    ;(function () {
    const playlist = [
      { title: "Kalimba (Test Audio)", artist: "Ninja Tuna", cover: "", src: "https://www.learningcontainer.com/wp-content/uploads/2020/02/Kalimba.mp3" },
      { title: "Sample MP3 (700KB)", artist: "Sample Source", cover: "", src: "https://sample.cat/downloads/file_example_MP3_700KB.mp3" }
    ];
    let currentIndex = 0, isPlaying = false, isDraggingProgress = false, isDraggingVolume = false, playMode = 'list';
    const audio = document.getElementById('pv-audio');
    const playBtn = document.getElementById('pv-play');
    const playIcon = document.getElementById('play-icon');
    const prevBtn = document.getElementById('pv-prev');
    const nextBtn = document.getElementById('pv-next');
    const titleEl = document.getElementById('pv-title');
    const artistEl = document.getElementById('pv-artist');
    const coverEl = document.getElementById('pv-cover');
    const progressEl = document.getElementById('pv-progress');
    const progressFill = document.getElementById('pv-progress-fill');
    const knobEl = document.getElementById('pv-knob');
    const timeCurEl = document.getElementById('pv-time-cur');
    const timeTotalEl = document.getElementById('pv-time-total');
    const volEl = document.getElementById('pv-volume');
    const volFill = document.getElementById('pv-volume-fill');
    const listBtn = document.getElementById('pv-list-btn');
    const playlistPanel = document.getElementById('playlist-panel');
    const rateBtn = document.getElementById('pv-rate-btn');
    const rateText = document.getElementById('rate-text');
    const muteBtn = document.getElementById('pv-mute');
    const volIcon = document.getElementById('vol-icon');
    const modeBtn = document.getElementById('pv-mode-btn');
    const modePop = document.getElementById('mode-pop');
    const ratePop = document.getElementById('rate-pop');

    function loadTrack(index) {
      const track = playlist[index];
      titleEl.innerText = track.title;
      artistEl.innerText = track.artist;
      coverEl.style.backgroundImage = track.cover ? `url('${track.cover}')` : '';
      audio.src = track.src;
      document.querySelectorAll('.playlist-item').forEach((item, i) => item.classList.toggle('active', i === index));
    }
    function playTrack() { audio.play().then(() => { isPlaying = true; updatePlayIcon(); }).catch(err => console.error("Play failed:", err)); }
    function pauseTrack() { audio.pause(); isPlaying = false; updatePlayIcon(); }
    function togglePlay() { isPlaying ? pauseTrack() : playTrack(); }
    function updatePlayIcon() {
      if (isPlaying) { playIcon.setAttribute('viewBox','0 0 24 24'); playIcon.innerHTML = '<path d="M6 5h4v14H6V5zm8 0h4v14h-4V5z"/>'; }
      else { playIcon.setAttribute('viewBox','0 0 24 24'); playIcon.innerHTML = '<path d="M8 5v14l11-7z"/>'; }
    }
    function formatTime(s) { if (!s || isNaN(s)) return "00:00"; const m = Math.floor(s/60), ss = Math.floor(s%60); return `${m<10?'0':''}${m}:${ss<10?'0':''}${ss}`; }
    function stopWrap(handler) { return function(e){ e.stopPropagation(); handler(e); }; }

    playBtn.addEventListener('click', stopWrap(togglePlay));
    prevBtn.addEventListener('click', stopWrap(() => prevByMode()));
    nextBtn.addEventListener('click', stopWrap(() => nextByMode()));
    muteBtn.addEventListener('click', stopWrap(() => {
      audio.muted = !audio.muted;
      if (audio.muted || audio.volume === 0) { volIcon.innerHTML = '<path d="M3 9v6h4l5 5V4L7 9H3zM14 3l7 7-1.4 1.4L16 7.8V16h-2V8.6L9.4 4 11 2.4 14 3z"/>'; }
      else if (audio.volume < 0.5) { volIcon.innerHTML = '<path d="M3 9v6h4l5 5V4L7 9H3zM14 9v6c1.7-0.7 3-2.4 3-4.5S15.7 9.7 14 9z"/>'; }
      else { volIcon.innerHTML = '<path d="M3 9v6h4l5 5V4L7 9H3zM14 7v10c3-1 5-3.6 5-7s-2-6-5-7z"/>'; }
    }));

    modeBtn.addEventListener('click', stopWrap(() => { ratePop.classList.remove('show'); modePop.classList.toggle('show'); }));
    modePop.addEventListener('click', stopWrap((e) => {
      const item = e.target.closest('.mode-item'); if (!item) return;
      playMode = item.getAttribute('data-mode');
      document.querySelectorAll('#mode-pop .mode-item').forEach(el => el.classList.toggle('active', el === item));
      modePop.classList.remove('show');
    }));

    rateBtn.addEventListener('click', stopWrap(() => { modePop.classList.remove('show'); ratePop.classList.toggle('show'); }));
    ratePop.addEventListener('click', stopWrap((e) => {
      const item = e.target.closest('.rate-item'); if (!item) return;
      const r = parseFloat(item.getAttribute('data-rate'));
      audio.playbackRate = r; rateText.innerText = r.toFixed(1) + 'x';
      document.querySelectorAll('#rate-pop .rate-item').forEach(el => el.classList.toggle('active', el === item));
      ratePop.classList.remove('show');
    }));

    document.addEventListener('click', (e) => {
      if (!modeBtn.contains(e.target) && !modePop.contains(e.target)) modePop.classList.remove('show');
      if (!rateBtn.contains(e.target) && !ratePop.contains(e.target)) ratePop.classList.remove('show');
    });

    audio.addEventListener('timeupdate', () => {
      if (isDraggingProgress) return;
      const percent = (audio.currentTime / audio.duration) * 100;
      progressFill.style.width = `${percent}%`; knobEl.style.left = `${percent}%`;
      timeCurEl.innerText = formatTime(audio.currentTime);
    });
    audio.addEventListener('loadedmetadata', () => { timeTotalEl.innerText = formatTime(audio.duration); });
    audio.addEventListener('ended', () => { if (playMode === 'single') { audio.currentTime = 0; playTrack(); } else { nextByMode(); } });

    function prevByMode() {
      if (playMode === 'shuffle') currentIndex = Math.floor(Math.random() * playlist.length);
      else currentIndex = (currentIndex - 1 + playlist.length) % playlist.length;
      loadTrack(currentIndex); playTrack();
    }
    function nextByMode() {
      if (playMode === 'shuffle') currentIndex = Math.floor(Math.random() * playlist.length);
      else currentIndex = (currentIndex + 1) % playlist.length;
      loadTrack(currentIndex); playTrack();
    }

    function handleProgressInput(clientX) {
      const rect = progressEl.getBoundingClientRect();
      let x = clientX - rect.left; x = Math.max(0, Math.min(x, rect.width));
      const pct = (x / rect.width) * 100; progressFill.style.width = `${pct}%`; knobEl.style.left = `${pct}%`;
      return (x / rect.width) * audio.duration;
    }
    progressEl.addEventListener('mousedown', stopWrap((e) => { isDraggingProgress = true; progressEl.classList.add('dragging'); const t = handleProgressInput(e.clientX); timeCurEl.innerText = formatTime(t); }));
    document.addEventListener('mousemove', (e) => { if (isDraggingProgress) { e.preventDefault(); const t = handleProgressInput(e.clientX); timeCurEl.innerText = formatTime(t); } });
    document.addEventListener('mouseup', (e) => { if (isDraggingProgress) { isDraggingProgress = false; progressEl.classList.remove('dragging'); const t = handleProgressInput(e.clientX); if (isFinite(t)) audio.currentTime = t; } });

    function getTouchX(e){ return (e.touches&&e.touches[0]) ? e.touches[0].clientX : (e.changedTouches&&e.changedTouches[0] ? e.changedTouches[0].clientX : 0); }
    progressEl.addEventListener('touchstart', (e) => { e.stopPropagation(); e.preventDefault(); isDraggingProgress = true; const t = handleProgressInput(getTouchX(e)); timeCurEl.innerText = formatTime(t); }, { passive:false });
    document.addEventListener('touchmove', (e) => { if (isDraggingProgress) { e.preventDefault(); const t = handleProgressInput(getTouchX(e)); timeCurEl.innerText = formatTime(t); } }, { passive:false });
    document.addEventListener('touchend', (e) => { if (isDraggingProgress) { isDraggingProgress = false; const t = handleProgressInput(getTouchX(e)); if (isFinite(t)) audio.currentTime = t; } }, { passive:false });

    function handleVolumeInput(clientX) {
      const rect = volEl.getBoundingClientRect();
      let x = clientX - rect.left; x = Math.max(0, Math.min(x, rect.width));
      const p = x / rect.width; volFill.style.width = `${p * 100}%`; audio.volume = p;
      if (p === 0 || audio.muted) { volIcon.innerHTML = '<path d="M3 9v6h4l5 5V4L7 9H3zM14 3l7 7-1.4 1.4L16 7.8V16h-2V8.6L9.4 4 11 2.4 14 3z"/>'; }
      else if (p < 0.5) { volIcon.innerHTML = '<path d="M3 9v6h4l5 5V4L7 9H3zM14 9v6c1.7-0.7 3-2.4 3-4.5S15.7 9.7 14 9z"/>'; }
      else { volIcon.innerHTML = '<path d="M3 9v6h4l5 5V4L7 9H3zM14 7v10c3-1 5-3.6 5-7s-2-6-5-7z"/>'; }
    }
    volEl.addEventListener('mousedown', stopWrap((e) => { isDraggingVolume = true; handleVolumeInput(e.clientX); }));
    document.addEventListener('mousemove', (e) => { if (isDraggingVolume) { e.preventDefault(); handleVolumeInput(e.clientX); } });
    document.addEventListener('mouseup', () => { isDraggingVolume = false; });
    volEl.addEventListener('touchstart', (e) => { e.stopPropagation(); e.preventDefault(); isDraggingVolume = true; handleVolumeInput(getTouchX(e)); }, { passive:false });
    document.addEventListener('touchmove', (e) => { if (isDraggingVolume) { e.preventDefault(); handleVolumeInput(getTouchX(e)); } }, { passive:false });
    document.addEventListener('touchend', () => { isDraggingVolume = false; }, { passive:false });

    listBtn.addEventListener('click', stopWrap(() => {
      playlistPanel.style.display = playlistPanel.style.display === 'block' ? 'none' : 'block';
    }));

    window.playIndex = function(index){ currentIndex = index; loadTrack(currentIndex); playTrack(); }
    loadTrack(currentIndex);
    })();
    </script>
</body>
</html>