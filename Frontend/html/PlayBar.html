<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PlayBar（左侧封面与标题，右侧音量与歌单）</title>
<style>
/* 不透明底部栏 + 可拖拽进度/音量（无外部依赖，内联SVG） */
body { margin: 0; padding-bottom: 96px; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: #f4f4f4; }

/* 播放栏容器 */
.pv-player-bar {
  position: fixed; left: 0; right: 0; bottom: 0;
  width: 100%; height: 96px; background: #ffffff;
  border-top: 1px solid #e0e0e0; box-shadow: 0 -4px 20px rgba(0,0,0,0.08);
  z-index: 29999; display: flex; align-items: center; user-select: none; pointer-events: auto;
}
/* 三段式布局：左-中-右 */
.pv-inner {
  width: 100%; max-width: 1200px; margin: 0 auto;
  display: grid;
  grid-template-columns: auto 1fr auto; /* 左侧自适应，中间占满，右侧自适应 */
  align-items: center;
  column-gap: 16px;
  padding: 0 24px;
  height: 100%;
}

/* 左侧：封面 + 标题/歌手，紧贴最左边 */
.pv-left {
  display: inline-flex;
  align-items: center;
  gap: 12px;
  min-width: 240px;
}
.pv-cover {
  width: 52px; height: 52px; border-radius: 8px;
  background: #eee no-repeat center/cover;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  flex-shrink: 0;
}
.pv-meta {
  display: flex; flex-direction: column; min-width: 0;
}
.pv-title {
  font-size: 16px; font-weight: 700; color: #222;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.pv-artist {
  font-size: 12px; color: #666; margin-top: 2px;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}

/* 中间：控制 + 进度，居中 */
.pv-center {
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  gap: 8px; min-width: 0;
}
.pv-controls {
  display: inline-flex; align-items: center; gap: 18px;
}
.ctrl-btn, .mode-btn, .rate-btn {
  background: transparent; border: none; cursor: pointer; color: #444;
  font-size: 18px; padding: 6px; display: inline-flex; align-items: center; justify-content: center; transition: color 0.2s;
}
.ctrl-btn:hover, .mode-btn:hover, .rate-btn:hover { color: #ff8c00; }
.play-btn {
  width: 44px; height: 44px; border-radius: 50%; background: #ff8c00; color: #fff; border: none;
  display: inline-flex; align-items: center; justify-content: center; cursor: pointer;
  box-shadow: 0 4px 10px rgba(255,140,0,0.30); transition: transform 0.1s, background 0.2s;
}
.play-btn:hover { background: #e67e00; transform: scale(1.05); }
.icon { width: 18px; height: 18px; fill: currentColor; }

/* 进度条行 */
.pv-progress-row { display: flex; align-items: center; gap: 12px; width: 100%; }
.time.small { font-size: 12px; color: #888; width: 48px; text-align: center; font-variant-numeric: tabular-nums; }
.pv-progress { position: relative; flex: 1; height: 6px; background: #eee; border-radius: 3px; cursor: pointer; touch-action: none; }
.pv-progress::before { content: ''; position: absolute; top: -10px; bottom: -10px; left: 0; right: 0; z-index: 1; }
.pv-progress-fill { position: absolute; left: 0; top: 0; bottom: 0; background: #ff8c00; border-radius: 3px; width: 0%; pointer-events: none; }
.pv-knob { position: absolute; top: 50%; right: -6px; transform: translateY(-50%); width: 12px; height: 12px; background: #fff; border: 2px solid #ff8c00; border-radius: 50%; box-shadow: 0 1px 4px rgba(0,0,0,0.2); opacity: 0; transition: opacity 0.2s; pointer-events: none; }
.pv-progress:hover .pv-knob, .pv-progress.dragging .pv-knob { opacity: 1; }

/* 右侧：音量 + 歌单，紧贴最右边 */
.pv-right {
  display: inline-flex; align-items: center; justify-content: flex-end;
  gap: 12px; min-width: 240px;
}
.pv-volume { width: 140px; height: 20px; display: flex; align-items: center; cursor: pointer; position: relative; }
.pv-volume-bar { width: 100%; height: 4px; background: #eee; border-radius: 2px; position: relative; overflow: visible; pointer-events: none; }
.pv-volume-fill { height: 100%; background: #888; width: 50%; border-radius: 2px; position: relative; }
.pv-volume-fill::after { content: ''; position: absolute; right: -5px; top: 50%; transform: translateY(-50%); width: 10px; height: 10px; background: #fff; border: 1px solid #888; border-radius: 50%; opacity: 0; transition: opacity 0.2s; }
.pv-volume:hover .pv-volume-fill::after { opacity: 1; }

/* 弹层：循环模式与倍速菜单（靠按钮居中上弹） */
.popover {
  position: absolute; bottom: 100%;
  left: 50%; transform: translateX(-50%);
  background: #fff; border: 1px solid #ddd; border-radius: 8px;
  box-shadow: 0 10px 24px rgba(0,0,0,0.12);
  padding: 8px; z-index: 30000; display: none;
}
.popover.show { display: flex; }
.mode-popover { gap: 10px; align-items: center; }
.mode-item {
  width: 40px; height: 40px; border-radius: 8px; border: 1px solid #eee;
  display: inline-flex; align-items: center; justify-content: center; cursor: pointer; color: #444;
}
.mode-item:hover { color: #ff8c00; border-color: #ffeed6; background: #fff9f0; }
.mode-item.active { color: #fff; background: #ff8c00; border-color: #ff8c00; }
.rate-popover { flex-direction: column; min-width: 140px; }
.rate-item { padding: 8px 12px; font-size: 14px; color: #333; cursor: pointer; border-radius: 6px; }
.rate-item:hover { background: #f7f7f7; }
.rate-item.active { color: #ff8c00; font-weight: 700; background: #fff4e6; }

/* 响应式 */
@media (max-width: 900px) {
  .pv-left { min-width: 0; }
  .pv-right { min-width: 0; }
  .pv-inner { grid-template-columns: auto 1fr auto; column-gap: 10px; padding: 0 12px; }
}
</style>
</head>
<body>

  <aside id="pv-player" class="pv-player-bar">
    <div class="pv-inner">
      <!-- 左侧：封面与标题（最左） -->
      <div class="pv-left">
        <div id="pv-cover" class="pv-cover"></div>
        <div class="pv-meta">
          <div id="pv-title" class="pv-title">Kalimba (Test Audio)</div>
          <div id="pv-artist" class="pv-artist">Ninja Tuna</div>
        </div>
      </div>

      <!-- 中间：控制与进度（居中） -->
      <div class="pv-center">
        <div class="pv-controls">
          <button id="pv-prev" class="ctrl-btn" title="上一首" aria-label="上一首">
            <svg class="icon" viewBox="0 0 24 24"><path d="M6 6h2v12H6V6zm3.5 6l8.5 6V6l-8.5 6z"/></svg>
          </button>
          <button id="pv-play" class="play-btn" title="播放/暂停" aria-label="播放/暂停">
            <svg id="play-icon" class="icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
          </button>
          <button id="pv-next" class="ctrl-btn" title="下一首" aria-label="下一首">
            <svg class="icon" viewBox="0 0 24 24"><path d="M16 6h2v12h-2V6zM6 18l8.5-6L6 6v12z"/></svg>
          </button>

          <!-- 循环模式按钮 + 弹层 -->
          <div style="position: relative;">
            <button id="pv-mode-btn" class="mode-btn" title="播放模式" aria-label="播放模式">
              <svg class="icon" viewBox="0 0 24 24"><path d="M7 7h8v3l4-4-4-4v3H5v6h2V7zm10 10H9v-3l-4 4 4 4v-3h10v-6h-2v4z"/></svg>
            </button>
            <div id="mode-pop" class="popover mode-popover">
              <div class="mode-item active" data-mode="single" title="单曲循环">
                <svg class="icon" viewBox="0 0 24 24"><path d="M12 5v4l-1.5-1.5C8 10 8 14 10.5 16.5S16 19 18.5 16.5L20 18c-3 3-8 3-11 0S6 9 9 6L12 5z"/></svg>
              </div>
              <div class="mode-item" data-mode="list" title="歌单顺序循环">
                <svg class="icon" viewBox="0 0 24 24"><path d="M4 6h12v2H4V6zm0 5h12v2H4v-2zm0 5h8v2H4v-2zm15-7l-3 3h2v4h2v-4h2l-3-3z"/></svg>
              </div>
              <div class="mode-item" data-mode="shuffle" title="歌单乱序循环">
                <svg class="icon" viewBox="0 0 24 24"><path d="M16 3h5v5h-2V6.41l-4.29 4.3-1.42-1.42L17.59 5H16V3zM4 6h7l2 2H4V6zm0 6h5l2 2H4v-2zm12 3h1.59l-2.29 2.29 1.42 1.42L20 17.41V19h2v-5h-5v2z"/></svg>
              </div>
            </div>
          </div>

          <!-- 倍速按钮 + 弹层 -->
          <div class="rate-control" style="position: relative;">
            <button id="pv-rate-btn" class="rate-btn" title="倍速"><span id="rate-text" style="font-size: 12px; font-weight: bold;">1x</span></button>
            <div id="rate-pop" class="popover rate-popover">
              <div class="rate-item" data-rate="0.5">0.5x</div>
              <div class="rate-item active" data-rate="1">1.0x</div>
              <div class="rate-item" data-rate="1.5">1.5x</div>
              <div class="rate-item" data-rate="2">2.0x</div>
            </div>
          </div>
        </div>

        <div class="pv-progress-row">
          <span id="pv-time-cur" class="time small">00:00</span>
          <div id="pv-progress" class="pv-progress">
            <div id="pv-progress-fill" class="pv-progress-fill"></div>
            <div id="pv-knob" class="pv-knob"></div>
          </div>
          <span id="pv-time-total" class="time small">00:00</span>
        </div>
      </div>

      <!-- 右侧：音量 + 歌单（最右） -->
      <div class="pv-right">
        <button id="pv-mute" class="ctrl-btn" title="静音/取消静音" aria-label="静音">
          <svg id="vol-icon" class="icon" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3z"/></svg>
        </button>
        <div id="pv-volume" class="pv-volume">
          <div class="pv-volume-bar"><div id="pv-volume-fill" class="pv-volume-fill"></div></div>
        </div>
        <button id="pv-list-btn" class="ctrl-btn" title="播放列表" aria-label="播放列表">
          <svg class="icon" viewBox="0 0 24 24"><path d="M3 5h18v2H3V5zm0 6h12v2H3v-2zm0 6h8v2H3v-2z"/></svg>
        </button>
      </div>
    </div>

    <!-- 播放列表弹窗（示例） -->
    <div id="playlist-panel" class="playlist-panel" style="display:none;">
      <div class="playlist-item active" onclick="playIndex(0)">1. Kalimba (Test)</div>
      <div class="playlist-item" onclick="playIndex(1)">2. Sample MP3 (Test)</div>
    </div>

    <audio id="pv-audio" preload="metadata"></audio>
  </aside>

<script>
;(function () {
/* 两个样例音频 */
const playlist = [
  { title: "Kalimba (Test Audio)", artist: "Ninja Tuna", cover: "", src: "https://www.learningcontainer.com/wp-content/uploads/2020/02/Kalimba.mp3" },
  { title: "Sample MP3 (700KB)", artist: "Sample Source", cover: "", src: "https://sample.cat/downloads/file_example_MP3_700KB.mp3" }
];

let currentIndex = 0;
let isPlaying = false;
let isDraggingProgress = false;
let isDraggingVolume = false;
let playMode = 'list'; /* single | list | shuffle */

const audio = document.getElementById('pv-audio');
const playBtn = document.getElementById('pv-play');
const playIcon = document.getElementById('play-icon');
const prevBtn = document.getElementById('pv-prev');
const nextBtn = document.getElementById('pv-next');
const titleEl = document.getElementById('pv-title');
const artistEl = document.getElementById('pv-artist');
const coverEl = document.getElementById('pv-cover');
const progressEl = document.getElementById('pv-progress');
const progressFill = document.getElementById('pv-progress-fill');
const knobEl = document.getElementById('pv-knob');
const timeCurEl = document.getElementById('pv-time-cur');
const timeTotalEl = document.getElementById('pv-time-total');
const volEl = document.getElementById('pv-volume');
const volFill = document.getElementById('pv-volume-fill');
const listBtn = document.getElementById('pv-list-btn');
const playlistPanel = document.getElementById('playlist-panel');
const rateBtn = document.getElementById('pv-rate-btn');
const rateText = document.getElementById('rate-text');
const muteBtn = document.getElementById('pv-mute');
const volIcon = document.getElementById('vol-icon');
const modeBtn = document.getElementById('pv-mode-btn');
const modePop = document.getElementById('mode-pop');
const ratePop = document.getElementById('rate-pop');

function loadTrack(index) {
  const track = playlist[index];
  titleEl.innerText = track.title;
  artistEl.innerText = track.artist;
  coverEl.style.backgroundImage = track.cover ? `url('${track.cover}')` : '';
  audio.src = track.src;
  document.querySelectorAll('.playlist-item').forEach((item, i) => item.classList.toggle('active', i === index));
}
function playTrack() { audio.play().then(() => { isPlaying = true; updatePlayIcon(); }).catch(err => console.error("Play failed:", err)); }
function pauseTrack() { audio.pause(); isPlaying = false; updatePlayIcon(); }
function togglePlay() { isPlaying ? pauseTrack() : playTrack(); }
function updatePlayIcon() {
  if (isPlaying) { playIcon.setAttribute('viewBox','0 0 24 24'); playIcon.innerHTML = '<path d="M6 5h4v14H6V5zm8 0h4v14h-4V5z"/>'; }
  else { playIcon.setAttribute('viewBox','0 0 24 24'); playIcon.innerHTML = '<path d="M8 5v14l11-7z"/>'; }
}
function formatTime(s) { if (!s || isNaN(s)) return "00:00"; const m = Math.floor(s/60), ss = Math.floor(s%60); return `${m<10?'0':''}${m}:${ss<10?'0':''}${ss}`; }
function stopWrap(handler) { return function(e){ e.stopPropagation(); handler(e); }; }

/* 控件事件（阻止冒泡） */
playBtn.addEventListener('click', stopWrap(togglePlay));
prevBtn.addEventListener('click', stopWrap(() => prevByMode()));
nextBtn.addEventListener('click', stopWrap(() => nextByMode()));
muteBtn.addEventListener('click', stopWrap(() => {
  audio.muted = !audio.muted;
  if (audio.muted || audio.volume === 0) { volIcon.innerHTML = '<path d="M3 9v6h4l5 5V4L7 9H3zM14 3l7 7-1.4 1.4L16 7.8V16h-2V8.6L9.4 4 11 2.4 14 3z"/>'; }
  else if (audio.volume < 0.5) { volIcon.innerHTML = '<path d="M3 9v6h4l5 5V4L7 9H3zM14 9v6c1.7-0.7 3-2.4 3-4.5S15.7 9.7 14 9z"/>'; }
  else { volIcon.innerHTML = '<path d="M3 9v6h4l5 5V4L7 9H3zM14 7v10c3-1 5-3.6 5-7s-2-6-5-7z"/>'; }
}));

/* 模式弹层 */
modeBtn.addEventListener('click', stopWrap(() => {
  ratePop.classList.remove('show');
  modePop.classList.toggle('show');
}));
modePop.addEventListener('click', stopWrap((e) => {
  const item = e.target.closest('.mode-item');
  if (!item) return;
  playMode = item.getAttribute('data-mode');
  document.querySelectorAll('#mode-pop .mode-item').forEach(el => el.classList.toggle('active', el === item));
  modePop.classList.remove('show');
}));

/* 倍速弹层 */
rateBtn.addEventListener('click', stopWrap(() => {
  modePop.classList.remove('show');
  ratePop.classList.toggle('show');
}));
ratePop.addEventListener('click', stopWrap((e) => {
  const item = e.target.closest('.rate-item');
  if (!item) return;
  const r = parseFloat(item.getAttribute('data-rate'));
  audio.playbackRate = r;
  rateText.innerText = r.toFixed(1) + 'x';
  document.querySelectorAll('#rate-pop .rate-item').forEach(el => el.classList.toggle('active', el === item));
  ratePop.classList.remove('show');
}));

/* 点击其他区域关闭弹层 */
document.addEventListener('click', (e) => {
  if (!modeBtn.contains(e.target) && !modePop.contains(e.target)) modePop.classList.remove('show');
  if (!rateBtn.contains(e.target) && !ratePop.contains(e.target)) ratePop.classList.remove('show');
});

/* 音频事件与切歌模式 */
audio.addEventListener('timeupdate', () => {
  if (isDraggingProgress) return;
  const percent = (audio.currentTime / audio.duration) * 100;
  progressFill.style.width = `${percent}%`;
  knobEl.style.left = `${percent}%`;
  timeCurEl.innerText = formatTime(audio.currentTime);
});
audio.addEventListener('loadedmetadata', () => { timeTotalEl.innerText = formatTime(audio.duration); });
audio.addEventListener('ended', () => {
  if (playMode === 'single') { audio.currentTime = 0; playTrack(); }
  else { nextByMode(); }
});
function prevByMode() {
  if (playMode === 'shuffle') currentIndex = Math.floor(Math.random() * playlist.length);
  else currentIndex = (currentIndex - 1 + playlist.length) % playlist.length;
  loadTrack(currentIndex); playTrack();
}
function nextByMode() {
  if (playMode === 'shuffle') currentIndex = Math.floor(Math.random() * playlist.length);
  else currentIndex = (currentIndex + 1) % playlist.length;
  loadTrack(currentIndex); playTrack();
}

/* 进度条拖拽（鼠标/触摸） */
function handleProgressInput(clientX) {
  const rect = progressEl.getBoundingClientRect();
  let x = clientX - rect.left; x = Math.max(0, Math.min(x, rect.width));
  const pct = (x / rect.width) * 100; progressFill.style.width = `${pct}%`; knobEl.style.left = `${pct}%`;
  return (x / rect.width) * audio.duration;
}
progressEl.addEventListener('mousedown', stopWrap((e) => { isDraggingProgress = true; progressEl.classList.add('dragging'); const t = handleProgressInput(e.clientX); timeCurEl.innerText = formatTime(t); }));
document.addEventListener('mousemove', (e) => { if (isDraggingProgress) { e.preventDefault(); const t = handleProgressInput(e.clientX); timeCurEl.innerText = formatTime(t); } });
document.addEventListener('mouseup', (e) => { if (isDraggingProgress) { isDraggingProgress = false; progressEl.classList.remove('dragging'); const t = handleProgressInput(e.clientX); if (isFinite(t)) audio.currentTime = t; } });

function getTouchX(e){ return (e.touches&&e.touches[0]) ? e.touches[0].clientX : (e.changedTouches&&e.changedTouches[0] ? e.changedTouches[0].clientX : 0); }
progressEl.addEventListener('touchstart', (e) => { e.stopPropagation(); e.preventDefault(); isDraggingProgress = true; const t = handleProgressInput(getTouchX(e)); timeCurEl.innerText = formatTime(t); }, { passive:false });
document.addEventListener('touchmove', (e) => { if (isDraggingProgress) { e.preventDefault(); const t = handleProgressInput(getTouchX(e)); timeCurEl.innerText = formatTime(t); } }, { passive:false });
document.addEventListener('touchend', (e) => { if (isDraggingProgress) { isDraggingProgress = false; const t = handleProgressInput(getTouchX(e)); if (isFinite(t)) audio.currentTime = t; } }, { passive:false });

/* 音量拖拽（鼠标/触摸） */
function handleVolumeInput(clientX) {
  const rect = volEl.getBoundingClientRect();
  let x = clientX - rect.left; x = Math.max(0, Math.min(x, rect.width));
  const p = x / rect.width; volFill.style.width = `${p * 100}%`; audio.volume = p;
  if (p === 0 || audio.muted) { volIcon.innerHTML = '<path d="M3 9v6h4l5 5V4L7 9H3zM14 3l7 7-1.4 1.4L16 7.8V16h-2V8.6L9.4 4 11 2.4 14 3z"/>'; }
  else if (p < 0.5) { volIcon.innerHTML = '<path d="M3 9v6h4l5 5V4L7 9H3zM14 9v6c1.7-0.7 3-2.4 3-4.5S15.7 9.7 14 9z"/>'; }
  else { volIcon.innerHTML = '<path d="M3 9v6h4l5 5V4L7 9H3zM14 7v10c3-1 5-3.6 5-7s-2-6-5-7z"/>'; }
}
volEl.addEventListener('mousedown', stopWrap((e) => { isDraggingVolume = true; handleVolumeInput(e.clientX); }));
document.addEventListener('mousemove', (e) => { if (isDraggingVolume) { e.preventDefault(); handleVolumeInput(e.clientX); } });
document.addEventListener('mouseup', () => { isDraggingVolume = false; });
volEl.addEventListener('touchstart', (e) => { e.stopPropagation(); e.preventDefault(); isDraggingVolume = true; handleVolumeInput(getTouchX(e)); }, { passive:false });
document.addEventListener('touchmove', (e) => { if (isDraggingVolume) { e.preventDefault(); handleVolumeInput(getTouchX(e)); } }, { passive:false });
document.addEventListener('touchend', () => { isDraggingVolume = false; }, { passive:false });

/* 简易播放列表开关（示例） */
listBtn.addEventListener('click', stopWrap(() => {
  playlistPanel.style.display = playlistPanel.style.display === 'block' ? 'none' : 'block';
}));

/* 提供给 HTML 的播放列表切换 */
window.playIndex = function(index){ currentIndex = index; loadTrack(currentIndex); playTrack(); }

/* 初始化第一首 */
loadTrack(currentIndex);
})();
</script>
</body>
</html>