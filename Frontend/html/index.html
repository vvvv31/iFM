<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英语学习中心 - 星之声</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="../js/search.js"></script>
    <style>
        /* 首页特有样式 */
        .recommend-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        /* 轮播图样式 - 替换原来的大卡片 */
        .carousel-container {
            flex: 2;
            min-width: 300px;
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .carousel {
            position: relative;
            width: 100%;
            height: 100%;
            min-height: 200px;
            overflow: hidden;
            background-color: #E0FFFF;
            border: 2px solid #FF8C00;
            border-radius: 8px;
        }

        .carousel-inner {
            display: flex;
            transition: transform 0.5s ease-in-out;
            height: 100%;
        }

        .carousel-item {
            min-width: 100%;
            padding: 30px 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            background-color: #E0FFFF;
            box-sizing: border-box;
        }

        .carousel-item h2 {
            color: #FF8C00;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .carousel-item p {
            color: #666;
            font-size: 16px;
            margin-bottom: 15px;
            max-width: 80%;
        }

        .carousel-btn {
            background-color: #FF8C00;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease;
        }

        .carousel-btn:hover {
            background-color: #e67e00;
        }

        .carousel-controls {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            transform: translateY(-50%);
            padding: 0 10px;
            box-sizing: border-box;
            z-index: 10;
        }

        .carousel-btn-prev,
        .carousel-btn-next {
            background-color: rgba(255, 140, 0, 0.8);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .carousel-btn-prev:hover,
        .carousel-btn-next:hover {
            background-color: rgba(255, 140, 0, 1);
            transform: scale(1.1);
        }

        .carousel-indicators {
            position: absolute;
            bottom: 15px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 8px;
            z-index: 10;
        }

        .carousel-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            border: 1px solid #FF8C00;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .carousel-indicator.active {
            background-color: #FF8C00;
            transform: scale(1.2);
        }

        .small-recommend-grid {
            flex: 3;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            min-width: 300px;
        }

        .small-recommend {
            background-color: #FFF8DC;
            border: 1px solid #FFDAB9;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            transition: all 0.3s ease;
        }

        .small-recommend:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(255, 140, 0, 0.1);
        }

        .small-recommend h3 {
            color: #FF8C00;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .small-recommend p {
            color: #333;
            font-size: 14px;
            font-weight: bold;
        }

        .daily-quote-section {
            margin-bottom: 20px;
        }

        .daily-quote {
            background-color: #FFF8DC;
            border: 1px solid #FFDAB9;
            border-radius: 8px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .quote-content {
            flex: 1;
        }

        .quote-content span {
            display: inline-block;
            background-color: #FF8C00;
            color: white;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .quote-text {
            font-size: 16px;
            color: #333;
            line-height: 1.6;
            font-style: italic;
        }

        .copy-btn {
            background-color: #FF8C00;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s ease;
            margin-left: 20px;
            white-space: nowrap;
        }

        .copy-btn:hover {
            background-color: #e67e00;
        }

        .rank-section {
            margin-bottom: 20px;
        }

        .rank-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .rank-item {
            background-color: #fff;
            border: 1px solid #FFDAB9;
            border-radius: 8px;
            overflow: hidden;
        }

        .rank-header {
            background-color: #FFF8DC;
            padding: 12px 15px;
            border-bottom: 1px solid #FFDAB9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .rank-header h3 {
            color: #333;
            font-size: 14px;
            font-weight: bold;
            margin: 0;
        }

        .rank-icon {
            font-size: 18px;
        }

        .rank-content {
            padding: 15px;
        }

        .rank-item-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .rank-song {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px dashed #FFDAB9;
        }

        .rank-song:last-child {
            border-bottom: none;
        }

        .rank-num {
            width: 25px;
            height: 25px;
            background-color: #FF8C00;
            color: white;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
            flex-shrink: 0;
        }

        .rank-title {
            font-size: 14px;
            color: #333;
            flex: 1;
        }

        .channels-section {
            margin-bottom: 20px;
        }

        .channels-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .channels-header h2 {
            color: #333;
            font-size: 16px;
            font-weight: bold;
            margin: 0;
        }

        .view-more {
            color: #FF8C00;
            font-size: 14px;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .view-more:hover {
            color: #e67e00;
        }

        .channels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
        }

        .channel-item {
            background-color: #fff;
            border: 1px solid #FFDAB9;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .channel-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255, 140, 0, 0.1);
        }

        .channel-icon {
            font-size: 24px;
            width: 50px;
            height: 50px;
            background-color: #E0FFFF;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .channel-info {
            flex: 1;
        }

        .channel-title {
            color: #333;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .channel-desc {
            color: #666;
            font-size: 12px;
            line-height: 1.4;
        }

        /* 响应式调整 */
        @media (max-width: 768px) {
            .recommend-section {
                flex-direction: column;
            }

            .carousel-container,
            .small-recommend-grid {
                width: 100%;
            }

            .rank-container {
                grid-template-columns: 1fr;
            }

            .channels-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .carousel-controls {
                padding: 0 5px;
            }

            .carousel-btn-prev,
            .carousel-btn-next {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
        }

        @media (max-width: 480px) {
            .small-recommend-grid {
                grid-template-columns: 1fr;
            }

            .channels-grid {
                grid-template-columns: 1fr;
            }

            .daily-quote {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .copy-btn {
                margin-left: 0;
            }

            .carousel-indicators {
                bottom: 10px;
            }
        }

        /* PlayBar styles (copied from PlayBar.html) */
.pv-player-bar { left:0; right:0; bottom:0; width:100%; background:rgba(220,220,220,0.95); border-top:4px solid #77bfa3; box-shadow:0 -2px 8px rgba(0,0,0,0.12); font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial; padding:8px 0; }
.pv-player-bar.fixed { position:fixed; z-index:1200; }
.pv-inner { max-width:1200px; margin:0 auto; display:flex; align-items:center; gap:18px; padding:0 20px; }
.pv-left { display:flex; align-items:center; gap:12px; min-width:260px; }
.pv-cover { width:44px; height:44px; border-radius:6px; background:#eee; background-size:cover; background-position:center; cursor: pointer; }
.pv-meta { display:flex; flex-direction:column; overflow:hidden; cursor: pointer; }
.pv-title { font-size:14px; font-weight:600; color:#222; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.pv-artist { font-size:12px; color:#666; margin-top:2px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.pv-center { flex:1; display:flex; flex-direction:column; gap:8px; align-items:center; }
.pv-controls { display:flex; align-items:center; gap:10px; margin-bottom:4px; }
.ctrl-btn { border:0; background:transparent; font-size:16px; width:34px; height:34px; cursor:pointer; }
.play-btn { width:44px; height:36px; background:linear-gradient(#ff8c00,#ff6a00); color:#fff; border-radius:8px; border:none; cursor:pointer; }
.rate-control { display:inline-block; position:relative; }
.rate-btn { padding:6px 8px; border-radius:6px; border:1px solid rgba(0,0,0,0.06); background:#fff; cursor:pointer; font-size:13px; }
.mode-btn { padding:6px 8px; border-radius:6px; border:1px solid rgba(0,0,0,0.06); background:#fff; cursor:pointer; font-size:13px; }
.pv-progress-row { display:flex; align-items:center; gap:12px; width:100%; }
.time.small { font-size:12px; color:#666; width:48px; text-align:center; }
.pv-progress { position:relative; flex:1; height:8px; background:rgba(255,255,255,0.6); border-radius:8px; cursor:pointer; overflow:visible; }
.pv-progress-bg { position:absolute; left:0; right:0; top:0; bottom:0; border-radius:8px; }
.pv-progress-fill { position:absolute; left:0; top:0; bottom:0; width:0%; background:linear-gradient(90deg,#ffd86b,#ffb94d); border-radius:8px; }
.pv-knob { position:absolute; top:50%; transform:translate(-50%,-50%); width:12px; height:12px; background:#ffcf4d; border-radius:50%; box-shadow:0 2px 6px rgba(255,160,0,0.18); border:2px solid rgba(255,255,255,0.5); }
.pv-right { min-width:160px; display:flex; align-items:center; gap:12px; justify-content:flex-end; }
.pv-volume { width:110px; cursor:pointer; }
.pv-volume-bar { height:6px; background:rgba(0,0,0,0.08); border-radius:6px; position:relative; overflow:hidden; }
.pv-volume-fill { height:100%; background:linear-gradient(90deg,#ffd86b,#ffb94d); width:80%; }
.rate-menu { background:#fff; border:1px solid #eee; border-radius:6px; box-shadow:0 8px 26px rgba(0,0,0,0.12); overflow:hidden; padding:6px 0; font-size:14px; }
.rate-option { padding:8px 12px; cursor:pointer; color:#222; white-space:nowrap; }
.rate-option:hover { background:#fafafa; }
.rate-option.active { background:#ff8c00; color:#fff; }
.playlist-panel { background:#fff; border:1px solid #eee; border-radius:8px; box-shadow:0 8px 30px rgba(0,0,0,0.12); overflow:auto; padding:8px; }
.playlist-title { font-weight:600; padding:8px 12px; border-bottom:1px solid #f5f5f5; margin-bottom:6px; color:#333; }
.playlist-list { max-height:320px; overflow:auto; }
.playlist-item { display:flex; align-items:center; justify-content:space-between; gap:12px; padding:8px; cursor:pointer; }
.playlist-item.active { background:#fff3e0; color:#ff8c00; font-weight:600; }
.pi-meta { overflow:hidden; }
.pi-title { font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.pi-artist { font-size:12px; color:#888; }
.teleport-overlay { position:fixed; left:0; right:0; top:0; bottom:0; z-index:29999; background:rgba(0,0,0,0); }
@media (max-width:900px) { .pv-left{display:none;} .pv-right{display:none;} .pv-inner{padding:0 12px;} }
.rate-menu .rate-option, .playlist-panel .playlist-item { user-select:none; }
    </style>
</head>
<body>
    <!-- 音频元素 (保留原来元素 in case other scripts use it) -->
    <audio id="audioPlayer" controls style="display: none;">
        <source src="" type="audio/mpeg">
        您的浏览器不支持音频播放
    </audio>

    <!-- 顶部导航栏 -->
    <header class="header">
        <div class="logo">
            <div class="logo-img"></div>
            <span class="logo-text">星之声</span>
        </div>
        <nav class="main-nav">
            <a href="index.html" class="nav-item active">首页</a>
            <a href="category.html" class="nav-item">分类</a>
            <a href="channel.html" class="nav-item">社区</a>
        </nav>
        <div class="search-box">
            <input type="text" placeholder="搜索课程、频道..." class="search-input" id="homeSearchInput">
            <button class="search-btn" id="homeSearchBtn"><i class="fas fa-search"></i></button>
        </div>
        <div class="user-functions">
            <a href="my-recent.html" class="func-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
            </a>
            <a href="my-message.html" class="func-item"><i class="fas fa-bell"></i> 消息</a>
            <a href="my-collect.html" class="func-item"><i class="fas fa-star"></i> 收藏</a>
            <a href="my-recent.html" class="func-item"><i class="fas fa-history"></i> 历史</a>
            <a href="my-creator_center.html" class="func-item"><i class="fas fa-pen"></i> 创作中心</a>
            <a href="login.html"><button class="submit-btn">登录/注册</button></a>
        </div>
    </header>

    <!-- 主要内容区 -->
    <main class="main-content">
        <!-- 用户信息区（与my-collect.html统一） -->
        <section class="user-info">
            <div class="avatar-wrapper">
                <div class="avatar"></div>
            </div>
            <div class="user-detail">
                <div class="username">欢迎学习英语</div>
                <div class="identity">英语学习者</div>
                <div class="stats">
                    <span>关注 <b>0</b></span>
                    <span>粉丝 <b>0</b></span>
                    <span>学习时长 <b>0</b> 小时</span>
                </div>
            </div>
        </section>

        <!-- 精选课程区域 - 改为轮播图形式 -->
        <section class="recommend-section">
            <div class="carousel-container">
                <div class="carousel" id="courseCarousel">
                    <div class="carousel-inner" id="carouselInner">
                        <!-- 轮播项 1 -->
                        <div class="carousel-item active">
                            <h2>零基础英语入门</h2>
                            <p>从字母发音到基础对话，系统学习英语基础知识</p>
                            <button class="carousel-btn" onclick="window.location.href='program_list.html?course=zero_basics'">开始学习</button>
                        </div>
                        <!-- 轮播项 2 -->
                        <div class="carousel-item">
                            <h2>商务英语进阶</h2>
                            <p>掌握职场沟通技巧，提升商务英语应用能力</p>
                            <button class="carousel-btn" onclick="window.location.href='program_list.html?course=business_advanced'">开始学习</button>
                        </div>
                        <!-- 轮播项 3 -->
                        <div class="carousel-item">
                            <h2>日常口语300句</h2>
                            <p>学习最实用的日常英语表达，提升口语流利度</p>
                            <button class="carousel-btn" onclick="window.location.href='program_list.html?course=daily_conversation'">开始学习</button>
                        </div>
                        <!-- 轮播项 4 -->
                        <div class="carousel-item">
                            <h2>英语听力技巧课</h2>
                            <p>系统训练听力理解能力，掌握听力技巧与方法</p>
                            <button class="carousel-btn" onclick="window.location.href='program_list.html?course=listening_skills'">开始学习</button>
                        </div>
                        <!-- 轮播项 5 -->
                        <div class="carousel-item">
                            <h2>英文写作提升</h2>
                            <p>学习英文写作技巧，提升书面表达能力</p>
                            <button class="carousel-btn" onclick="window.location.href='program_list.html?course=writing_improvement'">开始学习</button>
                        </div>
                    </div>

                    <!-- 轮播控制按钮 -->
                    <div class="carousel-controls">
                        <button class="carousel-btn-prev" id="carouselPrev">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="carousel-btn-next" id="carouselNext">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>

                    <!-- 轮播指示器 -->
                    <div class="carousel-indicators" id="carouselIndicators">
                        <!-- 指示器将由JS动态生成 -->
                    </div>
                </div>
            </div>

            <div class="small-recommend-grid">
                <div class="small-recommend" onclick="window.location.href='program_list.html?course=business_english'">
                    <div class="recommend-info">
                        <h3>精选</h3>
                        <p>商务英语</p>
                    </div>
                </div>
                <div class="small-recommend" onclick="window.location.href='program_list.html?course=daily_dialogue'">
                    <div class="recommend-info">
                        <h3>精选</h3>
                        <p>日常对话</p>
                    </div>
                </div>
                <div class="small-recommend" onclick="window.location.href='program_list.html?course=listening_training'">
                    <div class="recommend-info">
                        <h3>精选</h3>
                        <p>听力训练</p>
                    </div>
                </div>
                <div class="small-recommend" onclick="window.location.href='program_list.html?course=reading_comprehension'">
                    <div class="recommend-info">
                        <h3>精选</h3>
                        <p>阅读理解</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 每日一句 -->
        <section class="daily-quote-section">
            <div class="daily-quote">
                <div class="quote-content">
                    <span>每日一句</span>
                    <p class="quote-text">The way to learn a language is to practice speaking it as often as possible. - Paul Pimsleur</p>
                    <p style="margin-top: 8px; font-size: 14px; color: #666;">学习一门语言的方法是尽可能多地练习说它。 - 保罗·皮姆斯勒</p>
                </div>
                <button class="copy-btn" id="readAloudBtn">
                    <i class="fas fa-volume-up"></i> 朗读
                </button>
            </div>
        </section>

        <!-- 学习排行榜区域 -->
        <section class="rank-section">
            <div class="rank-container">
                <div class="rank-item">
                    <div class="rank-header">
                        <h3>热门课程</h3>
                        <span class="rank-icon">🔥</span>
                    </div>
                    <div class="rank-content">
                        <div class="rank-item-list">
                            <div class="rank-song" onclick="window.location.href='program_list.html?course=zero_basics'">
                                <span class="rank-num">1</span>
                                <span class="rank-title">零基础英语入门</span>
                            </div>
                            <div class="rank-song" onclick="window.location.href='program_list.html?course=business_advanced'">
                                <span class="rank-num">2</span>
                                <span class="rank-title">商务英语进阶</span>
                            </div>
                            <div class="rank-song" onclick="window.location.href='program_list.html?course=daily_conversation'">
                                <span class="rank-num">3</span>
                                <span class="rank-title">日常口语300句</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="rank-item">
                    <div class="rank-header">
                        <h3>学习达人</h3>
                        <span class="rank-icon">⭐</span>
                    </div>
                    <div class="rank-content">
                        <div class="rank-item-list">
                            <div class="rank-song">
                                <span class="rank-num">1</span>
                                <span class="rank-title">学习者 A</span>
                            </div>
                            <div class="rank-song">
                                <span class="rank-num">2</span>
                                <span class="rank-title">学习者 B</span>
                            </div>
                            <div class="rank-song">
                                <span class="rank-num">3</span>
                                <span class="rank-title">学习者 C</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="rank-item">
                    <div class="rank-header">
                        <h3>最新上线</h3>
                        <span class="rank-icon">✨</span>
                    </div>
                    <div class="rank-content">
                        <div class="rank-item-list">
                            <div class="rank-song">
                                <span class="rank-num">1</span>
                                <span class="rank-title">英语听力技巧课</span>
                            </div>
                            <div class="rank-song">
                                <span class="rank-num">2</span>
                                <span class="rank-title">英文写作提升</span>
                            </div>
                            <div class="rank-song">
                                <span class="rank-num">3</span>
                                <span class="rank-title">英语发音纠正</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 学习资源分类区域 -->
        <section class="channels-section">
            <div class="channels-header">
                <h2>学习资源分类</h2>
                <a href="#" class="view-more">查看更多 →</a>
            </div>
            <div class="channels-grid">
                <div class="channel-item" onclick="showChannel('speaking')">
                    <div class="channel-icon">🗣️</div>
                    <div class="channel-info">
                        <h3 class="channel-title">口语练习</h3>
                        <p class="channel-desc">提升口语表达能力</p>
                    </div>
                </div>
                <div class="channel-item" onclick="showChannel('listening')">
                    <div class="channel-icon">👂</div>
                    <div class="channel-info">
                        <h3 class="channel-title">听力训练</h3>
                        <p class="channel-desc">提高听力理解水平</p>
                    </div>
                </div>
                <div class="channel-item" onclick="showChannel('reading')">
                    <div class="channel-icon">📖</div>
                    <div class="channel-info">
                        <h3 class="channel-title">阅读理解</h3>
                        <p class="channel-desc">增强阅读能力</p>
                    </div>
                </div>
                <div class="channel-item" onclick="showChannel('writing')">
                    <div class="channel-icon">✍️</div>
                    <div class="channel-info">
                        <h3 class="channel-title">写作提升</h3>
                        <p class="channel-desc">提升英文写作水平</p>
                    </div>
                </div>
                <div class="channel-item" onclick="showChannel('business')">
                    <div class="channel-icon">🏢</div>
                    <div class="channel-info">
                        <h3 class="channel-title">商务英语</h3>
                        <p class="channel-desc">职场英语技巧</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

  <!-- Replaced footer: use PlayBar.html's player bar -->
  <aside id="pv-player" class="pv-player-bar fixed" role="region" aria-label="播放器" data-no-nav="false">
    <div class="pv-inner">
      <div class="pv-left">
        <div id="pv-cover" class="pv-cover" aria-hidden="true"></div>
        <div class="pv-meta">
          <div id="pv-title" class="pv-title">未播放</div>
          <div id="pv-artist" class="pv-artist"></div>
        </div>
      </div>

      <div class="pv-center">
        <div class="pv-controls">
          <button id="pv-prev" class="ctrl-btn" title="上一首" aria-label="上一首">‹</button>
          <button id="pv-play" class="play-btn" aria-pressed="false" title="播放">▶</button>
          <button id="pv-next" class="ctrl-btn" title="下一首" aria-label="下一首">›</button>

          <button id="pv-mode-btn" class="mode-btn" title="播放模式">🔁</button>

          <div class="rate-control">
            <button id="pv-rate-btn" class="rate-btn" title="播放速率">1x</button>
          </div>

          <button id="pv-list-btn" class="ctrl-btn" title="播放列表">▤</button>
        </div>

        <div class="pv-progress-row">
          <span id="pv-time-cur" class="time small">00:00</span>

          <div id="pv-progress" class="pv-progress" role="slider" aria-valuemin="0" aria-valuemax="0" aria-valuenow="0">
            <div class="pv-progress-bg"></div>
            <div id="pv-progress-fill" class="pv-progress-fill" style="width:0%"></div>
            <div id="pv-knob" class="pv-knob" style="left:0%" aria-hidden="true"></div>
          </div>

          <span id="pv-time-total" class="time small">00:00</span>
        </div>
      </div>

      <div class="pv-right">
        <button id="pv-mute" class="mute-btn ctrl-btn" title="静音">🔊</button>

        <div id="pv-volume" class="pv-volume" title="音量">
          <div class="pv-volume-bar">
            <div id="pv-volume-fill" class="pv-volume-fill" style="width:85%"></div>
          </div>
        </div>
      </div>
    </div>

    <audio id="pv-audio" preload="metadata"></audio>
  </aside>

<script>
/* 轮播图功能 */
document.addEventListener('DOMContentLoaded', function() {
    // 获取轮播相关元素
    const carouselInner = document.getElementById('carouselInner');
    const carouselPrev = document.getElementById('carouselPrev');
    const carouselNext = document.getElementById('carouselNext');
    const carouselIndicators = document.getElementById('carouselIndicators');

    if (!carouselInner) return;

    // 获取所有轮播项
    const carouselItems = carouselInner.querySelectorAll('.carousel-item');
    const totalItems = carouselItems.length;
    let currentIndex = 0;
    let autoPlayInterval;

    // 生成指示器
    function generateIndicators() {
        carouselIndicators.innerHTML = '';
        for (let i = 0; i < totalItems; i++) {
            const indicator = document.createElement('div');
            indicator.className = 'carousel-indicator';
            if (i === currentIndex) {
                indicator.classList.add('active');
            }
            indicator.addEventListener('click', () => goToSlide(i));
            carouselIndicators.appendChild(indicator);
        }
    }

    // 更新轮播位置
    function updateCarousel() {
        // 移除所有active类
        carouselItems.forEach(item => item.classList.remove('active'));

        // 添加当前active类
        carouselItems[currentIndex].classList.add('active');

        // 更新轮播位置
        carouselInner.style.transform = `translateX(-${currentIndex * 100}%)`;

        // 更新指示器
        const indicators = carouselIndicators.querySelectorAll('.carousel-indicator');
        indicators.forEach((indicator, index) => {
            if (index === currentIndex) {
                indicator.classList.add('active');
            } else {
                indicator.classList.remove('active');
            }
        });
    }

    // 切换到指定幻灯片
    function goToSlide(index) {
        currentIndex = index;
        if (currentIndex < 0) {
            currentIndex = totalItems - 1;
        } else if (currentIndex >= totalItems) {
            currentIndex = 0;
        }
        updateCarousel();
        resetAutoPlay();
    }

    // 下一张
    function nextSlide() {
        goToSlide(currentIndex + 1);
    }

    // 上一张
    function prevSlide() {
        goToSlide(currentIndex - 1);
    }

    // 自动播放
    function startAutoPlay() {
        autoPlayInterval = setInterval(nextSlide, 5000); // 5秒切换一次
    }

    // 重置自动播放
    function resetAutoPlay() {
        clearInterval(autoPlayInterval);
        startAutoPlay();
    }

    // 初始化
    generateIndicators();
    updateCarousel();
    startAutoPlay();

    // 绑定事件
    if (carouselPrev) {
        carouselPrev.addEventListener('click', (e) => {
            e.stopPropagation();
            prevSlide();
        });
    }

    if (carouselNext) {
        carouselNext.addEventListener('click', (e) => {
            e.stopPropagation();
            nextSlide();
        });
    }

    // 鼠标悬停时暂停自动播放
    const carousel = document.getElementById('courseCarousel');
    if (carousel) {
        carousel.addEventListener('mouseenter', () => {
            clearInterval(autoPlayInterval);
        });

        carousel.addEventListener('mouseleave', () => {
            startAutoPlay();
        });
    }
});

/*
  PlayBar navigation fix and basic interactions (copied/adapted from PlayBar.html).
  This script adds safe click-to-player behavior and exposes helpers.
*/
(function () {
  const root = document.getElementById('pv-player');
  const audio = document.getElementById('pv-audio');
  const playBtn = document.getElementById('pv-play');
  const prevBtn = document.getElementById('pv-prev');
  const nextBtn = document.getElementById('pv-next');
  const titleEl = document.getElementById('pv-title');
  const artistEl = document.getElementById('pv-artist');
  const coverEl = document.getElementById('pv-cover');
  const progressWrap = document.getElementById('pv-progress');
  const volWrap = document.getElementById('pv-volume');

  let rateMenuEl = null;
  let playlistPanelEl = null;
  let overlayEl = null;

  const INTERACTIVE_SELECTORS = [
    'button',
    'a',
    'input',
    'textarea',
    '.pv-progress',
    '.pv-volume',
    '.rate-menu',
    '.playlist-panel',
    '.playlist-item',
    '.rate-option',
    '.mute-btn',
    '.pv-knob',
    '.pv-progress-fill',
    '.pv-volume-fill'
  ];

  function isInteractiveTarget(target) {
    if (!target) return false;
    for (const sel of INTERACTIVE_SELECTORS) {
      if (target.closest(sel)) return true;
    }
    if (rateMenuEl && rateMenuEl.contains(target)) return true;
    if (playlistPanelEl && playlistPanelEl.contains(target)) return true;
    if (overlayEl && overlayEl.contains(target)) return true;
    return false;
  }

  function openPlayer() {
    const ev = new CustomEvent('pvplayer:beforeNavigate', { cancelable: true, detail: { track: null }} );
    if (!root.dispatchEvent(ev)) return;
    try {
      const p = location.pathname || '';
      const dir = p.endsWith('/') ? p : p.substring(0, p.lastIndexOf('/') + 1);
      const url = dir + 'player.html';
      window.location.href = url;
    } catch (err) {
      window.location.href = 'player.html';
    }
  }

  function onBarClick(e) {
    const target = e.target;
    if (!target) return;
    if (isInteractiveTarget(target)) return;
    openPlayer();
  }

  function attachExplicitOpeners() {
    [coverEl, titleEl, artistEl].forEach(el => {
      if (!el) return;
      el.style.cursor = 'pointer';
      el.addEventListener('click', function (ev) {
        if (isInteractiveTarget(ev.target)) return;
        ev.stopPropagation();
        openPlayer();
      });
    });
    const center = document.querySelector('.pv-center');
    if (center) {
      center.addEventListener('click', function (ev) {
        if (isInteractiveTarget(ev.target)) return;
        ev.stopPropagation();
        openPlayer();
      });
    }
  }

  function initNavFix() {
    try { root.removeEventListener('click', onBarClick); } catch (_) {}
    root.addEventListener('click', onBarClick);
    attachExplicitOpeners();
  }

  initNavFix();

  window.PVPlayBarNav = {
    setRateMenuEl(el) { rateMenuEl = el; },
    setPlaylistPanelEl(el) { playlistPanelEl = el; },
    setOverlayEl(el) { overlayEl = el; },
    openPlayer
  };

  // Basic play/pause handling for pv-audio (keeps UI minimal; integrate with your full player if needed)
  function togglePlay() {
    if (!audio) return;
    if (audio.paused) {
      audio.play().catch(()=>{});
      playBtn.textContent = '❚❚';
      playBtn.setAttribute('aria-pressed','true');
    } else {
      audio.pause();
      playBtn.textContent = '▶';
      playBtn.setAttribute('aria-pressed','false');
    }
  }
  if (playBtn) playBtn.addEventListener('click', (e) => { e.stopPropagation(); togglePlay(); });

  // update time/progress display
  const timeCurEl = document.getElementById('pv-time-cur');
  const timeTotalEl = document.getElementById('pv-time-total');
  const progFill = document.getElementById('pv-progress-fill');
  const pvKnob = document.getElementById('pv-knob');

  function formatTime(s) {
    if (!s || isNaN(s) || s <= 0) return '00:00';
    const m = Math.floor(s / 60), sec = Math.floor(s % 60);
    return `${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;
  }

  if (audio) {
    audio.addEventListener('timeupdate', () => {
      const dur = audio.duration || 0;
      const cur = audio.currentTime || 0;
      const pct = dur ? (cur / dur) * 100 : 0;
      if (progFill) progFill.style.width = pct + '%';
      if (pvKnob) pvKnob.style.left = pct + '%';
      if (timeCurEl) timeCurEl.textContent = formatTime(cur);
      if (timeTotalEl) timeTotalEl.textContent = formatTime(dur);
    });
    audio.addEventListener('loadedmetadata', () => {
      if (timeTotalEl) timeTotalEl.textContent = formatTime(audio.duration);
    });
    audio.addEventListener('ended', () => {
      if (playBtn) { playBtn.textContent = '▶'; playBtn.setAttribute('aria-pressed','false'); }
    });
  }

  // clicking progress to seek
  if (progressWrap) {
    progressWrap.addEventListener('click', (e) => {
      if (!audio || !audio.duration) return;
      const rect = progressWrap.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const p = Math.max(0, Math.min(1, x / rect.width));
      audio.currentTime = p * audio.duration;
    });
  }

})();
</script>

    <!-- JavaScript 功能 (existing index scripts) -->
    <script>
        // 播放器功能 (index page logic) - keep as-is; some controls reference elements that may not exist after replacing footer
        const audioPlayer = document.getElementById('audioPlayer');
        const playBtn = document.querySelector('.play-btn'); // note: pv play button also has .play-btn; keep usage minimal in page scripts
        const speedBtn = document.querySelector('.speed-btn');
        const speedMenu = document.querySelector('.speed-menu');
        const speedOptions = document.querySelectorAll('.speed-option');
        const currentSpeed = document.getElementById('currentSpeed');
        const playlistBtn = document.querySelector('.playlist-btn');
        const playlistPanel = document.querySelector('.playlist-panel');
        const playlistItems = document.querySelectorAll('.playlist-item');
        const progressFill = document.querySelector('.progress-fill');
        const currentTime = document.querySelector('.time.current');
        const volumeBtn = document.getElementById('playerVolumeBtn');
        const volumeFill = document.getElementById('playerVolumeFill');
        const volumeBar = document.querySelector('.volume-bar');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const readAloudBtn = document.getElementById('readAloudBtn');

        // 初始化音频（示例音频） — keep original audioPlayer for backward compat
        if (audioPlayer) {
          audioPlayer.src = 'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3';
          audioPlayer.load();
        }

        // Some controls referenced here may be the pv-player equivalents; guard uses:
        // 播放/暂停控制 (this will affect the original audioPlayer if present)
        if (playBtn && audioPlayer) {
            playBtn.addEventListener('click', () => {
                if (audioPlayer.paused) {
                    audioPlayer.play();
                    playBtn.innerHTML = '<i class="fas fa-pause-circle"></i>';
                } else {
                    audioPlayer.pause();
                    playBtn.innerHTML = '<i class="fas fa-play-circle"></i>';
                }
            });
        }

        // 倍速控制 (if these controls exist)
        if (speedBtn && speedMenu && speedOptions) {
          speedBtn.addEventListener('click', (e) => {
              e.stopPropagation();
              speedMenu.classList.toggle('active');
          });

          speedOptions.forEach(option => {
              option.addEventListener('click', () => {
                  const rate = parseFloat(option.getAttribute('data-rate'));
                  if (audioPlayer) audioPlayer.playbackRate = rate;
                  if (currentSpeed) currentSpeed.textContent = `${rate}x`;
                  speedOptions.forEach(opt => opt.classList.remove('active'));
                  option.classList.add('active');
                  speedMenu.classList.remove('active');
              });
          });
        }

        // 播放列表控制 (guarded)
        if (playlistBtn && playlistPanel) {
          playlistBtn.addEventListener('click', (e) => {
              e.stopPropagation();
              playlistPanel.classList.toggle('active');
          });
        }

        playlistItems.forEach(item => {
            item.addEventListener('click', () => {
                playlistItems.forEach(i => i.classList.remove('active'));
                item.classList.add('active');

                // 根据选择的课程更新播放器信息
                const courseName = item.textContent.substring(3);
                const playerSongName = document.getElementById('playerSongName');
                const playerSinger = document.getElementById('playerSinger');
                if (playerSongName) playerSongName.textContent = courseName;
                if (playerSinger) playerSinger.textContent = '英语学习课程';

                // 这里可以添加切换音频的逻辑
                showMessage(`切换到: ${courseName}`);
            });
        });

        // 进度条控制 (guarded)
        const progressBar = document.querySelector('.progress-bar');
        if (progressBar && audioPlayer) {
            progressBar.addEventListener('click', (e) => {
                const rect = progressBar.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const percentage = Math.max(0, Math.min(1, x / rect.width));
                audioPlayer.currentTime = percentage * audioPlayer.duration;
            });
        }

        // 更新进度显示
        if (audioPlayer) {
          audioPlayer.addEventListener('timeupdate', () => {
              const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
              if (progressFill) progressFill.style.width = `${progress}%`;

              // 更新当前时间
              const minutes = Math.floor(audioPlayer.currentTime / 60);
              const seconds = Math.floor(audioPlayer.currentTime % 60);
              if (currentTime) currentTime.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

              // 更新总时间
              const totalMinutes = Math.floor(audioPlayer.duration / 60);
              const totalSeconds = Math.floor(audioPlayer.duration % 60);
              const totalEl = document.querySelector('.time.total');
              if (totalEl) totalEl.textContent = `${totalMinutes.toString().padStart(2, '0')}:${totalSeconds.toString().padStart(2, '0')}`;
          });

          audioPlayer.addEventListener('loadedmetadata', () => {
              const totalMinutes = Math.floor(audioPlayer.duration / 60);
              const totalSeconds = Math.floor(audioPlayer.duration % 60);
              const totalEl = document.querySelector('.time.total');
              if (totalEl) totalEl.textContent = `${totalMinutes.toString().padStart(2, '0')}:${totalSeconds.toString().padStart(2, '0')}`;
          });

          audioPlayer.addEventListener('ended', () => {
              showMessage && showMessage('播放结束');
          });
        }

        // 上一曲/下一曲功能 (if prevBtn/nextBtn exist)
        if (prevBtn) prevBtn.addEventListener('click', () => { showMessage('上一曲功能'); });
        if (nextBtn) nextBtn.addEventListener('click', () => { showMessage('下一曲功能'); });

        // 朗读按钮 → 跳转到 Audio-Related 页面（并把文本作为 query param 传递）
        if (readAloudBtn) {
          readAloudBtn.addEventListener('click', () => {
              const quoteText = document.querySelector('.quote-text').textContent || '';
              const target = `./Audio-Related.html?auto=read&text=${encodeURIComponent(quoteText)}`;
              window.location.href = target;
          });
        }

        // 频道点击功能
        function showChannel(type) {
            const channels = {
                'speaking': '口语练习频道',
                'listening': '听力训练频道',
                'reading': '阅读理解频道',
                'writing': '写作提升频道',
                'business': '商务英语频道'
            };

            showMessage(`进入${channels[type]}`);
        }

        // 消息提示功能
        function showMessage(message) {
            const existingMessages = document.querySelectorAll('.message-popup');
            existingMessages.forEach(msg => msg.remove());

            const messageEl = document.createElement('div');
            messageEl.className = 'message-popup';
            messageEl.textContent = message;
            document.body.appendChild(messageEl);

            setTimeout(() => {
                if (messageEl.parentNode) {
                    messageEl.parentNode.removeChild(messageEl);
                }
            }, 3000);
        }

        // 点击外部关闭菜单
        document.addEventListener('click', (e) => {
            if (speedMenu && !speedMenu.contains(e.target) && !speedBtn.contains(e.target)) {
                speedMenu.classList.remove('active');
            }

            if (playlistPanel && !playlistPanel.contains(e.target) && !playlistBtn.contains(e.target)) {
                playlistPanel.classList.remove('active');
            }
        });

        // 防止菜单点击事件冒泡
        if (speedMenu) speedMenu.addEventListener('click', (e) => { e.stopPropagation(); });
        if (playlistPanel) playlistPanel.addEventListener('click', (e) => { e.stopPropagation(); });

        // 音频播放结束 event for original audio
        if (audioPlayer) {
          audioPlayer.addEventListener('ended', () => {
              if (playBtn) playBtn.innerHTML = '<i class="fas fa-play-circle"></i>';
              if (progressFill) progressFill.style.width = '0%';
              if (currentTime) currentTime.textContent = '00:00';
          });
        }
    </script>
</body>
</html>