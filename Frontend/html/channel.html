<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¢‘é“ - æ˜Ÿä¹‹å£°</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/channel.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="../js/search.js"></script>
    <script src="../js/script.js" defer></script>
    <style>
        /* æ–°å¢æ ·å¼ï¼šç¡®ä¿å†…å®¹ä¸è¢«åº•éƒ¨æ’­æ”¾æ é®æŒ¡ */
        .main.channel-main {
            padding-bottom: 90px;
        }

        /* ä¸ºå›ºå®šæ’­æ”¾æ é¢„ç•™ç©ºé—´ */
        body { padding-bottom: 96px; }
        /* PlayBarï¼ˆæ¥è‡ª PlayBar.htmlï¼‰æ ·å¼ */
        .pv-player-bar {
          position: fixed; left: 0; right: 0; bottom: 0;
          width: 100%; height: 96px; background: #ffffff;
          border-top: 1px solid #e0e0e0; box-shadow: 0 -4px 20px rgba(0,0,0,0.08);
          z-index: 29999; display: flex; align-items: center; user-select: none; pointer-events: auto;
        }
        .pv-inner {
          width: 100%; max-width: 1200px; margin: 0 auto;
          display: grid; grid-template-columns: auto 1fr auto; align-items: center;
          column-gap: 16px; padding: 0 24px; height: 100%;
        }
        .pv-left { display: inline-flex; align-items: center; gap: 12px; min-width: 240px; }
        .pv-cover { width: 52px; height: 52px; border-radius: 8px; background: #eee no-repeat center/cover; box-shadow: 0 2px 6px rgba(0,0,0,0.1); flex-shrink: 0; }
        .pv-meta { display: flex; flex-direction: column; min-width: 0; }
        .pv-title { font-size: 16px; font-weight: 700; color: #222; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .pv-artist { font-size: 12px; color: #666; margin-top: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .pv-center { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; min-width: 0; }
        .pv-controls { display: inline-flex; align-items: center; gap: 18px; }
        .ctrl-btn, .mode-btn, .rate-btn { background: transparent; border: none; cursor: pointer; color: #444; font-size: 18px; padding: 6px; display: inline-flex; align-items: center; justify-content: center; transition: color 0.2s; }
        .ctrl-btn:hover, .mode-btn:hover, .rate-btn:hover { color: #ff8c00; }
        .play-btn { width: 44px; height: 44px; border-radius: 50%; background: #ff8c00; color: #fff; border: none; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 10px rgba(255,140,0,0.30); transition: transform 0.1s, background 0.2s; }
        .play-btn:hover { background: #e67e00; transform: scale(1.05); }
        .icon { width: 18px; height: 18px; fill: currentColor; }
        .pv-progress-row { display: flex; align-items: center; gap: 12px; width: 100%; }
        .time.small { font-size: 12px; color: #888; width: 48px; text-align: center; font-variant-numeric: tabular-nums; }
        .pv-progress { position: relative; flex: 1; height: 6px; background: #eee; border-radius: 3px; cursor: pointer; touch-action: none; }
        .pv-progress-fill { position: absolute; left: 0; top: 0; bottom: 0; background: #ff8c00; border-radius: 3px; width: 0%; pointer-events: none; }
        .pv-knob { position: absolute; top: 50%; right: -6px; transform: translateY(-50%); width: 12px; height: 12px; background: #fff; border: 2px solid #ff8c00; border-radius: 50%; box-shadow: 0 1px 4px rgba(0,0,0,0.2); opacity: 0; transition: opacity 0.2s; pointer-events: none; }
        .pv-right { display: inline-flex; align-items: center; justify-content: flex-end; gap: 12px; min-width: 240px; }
        .pv-volume { width: 140px; height: 20px; display: flex; align-items: center; cursor: pointer; position: relative; }
        .pv-volume-bar { width: 100%; height: 4px; background: #eee; border-radius: 2px; position: relative; overflow: visible; pointer-events: none; }
        .pv-volume-fill { height: 100%; background: #888; width: 50%; border-radius: 2px; position: relative; }
        .playlist-panel { background:#fff; border:1px solid #eee; border-radius:8px; box-shadow:0 8px 30px rgba(0,0,0,0.12); overflow:auto; padding:8px; position:absolute; bottom:110px; right:24px; display:none; }
        .playlist-item { padding:8px 12px; cursor:pointer; }
        .playlist-item.active { background:#fff3e0; color:#ff8c00; font-weight:600; }
        @media (max-width: 900px) { .pv-left{min-width:0;} .pv-right{min-width:0;} .pv-inner{grid-template-columns:auto 1fr auto; column-gap:10px; padding:0 12px;} }
        /* Feed post styles (improved) */
        .post-card { background: #fff; border: 1px solid #f0f0f0; padding: 14px; border-radius: 12px; margin-bottom: 14px; box-shadow: 0 4px 14px rgba(16,24,40,0.04); }
        .post-header { display:flex; align-items:center; gap:12px; margin-bottom:10px; }
        .avatar { width:40px; height:40px; border-radius:50%; background:#ffe9d6; display:inline-flex; align-items:center; justify-content:center; color:#c24a00; font-weight:700; font-size:14px; flex-shrink:0; }
        .post-author { display:flex; flex-direction:column; }
        .author-name { font-weight:700; color:#222; font-size:14px; }
        .post-time { color:#999; font-size:12px; }
        .post-body { font-size:15px; color:#222; margin-bottom:10px; white-space:pre-wrap; line-height:1.5; }
        .post-images { display:grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap:8px; margin-bottom:8px; }
        .post-images img { width:100%; height:100%; object-fit:cover; border-radius:8px; display:block; }
        .post-actions { display:flex; gap:12px; align-items:center; }
        .like-btn { background:transparent; border:1px solid #ffe6d0; padding:6px 10px; border-radius:20px; color:#ff6b35; cursor:pointer; transition:transform .12s ease; }
        .like-btn:active { transform:scale(.96); }
        /* Composer improvements */
        .composer { background:#fff; border:1px solid #eee; padding:12px; border-radius:10px; margin-bottom:14px; }
        .composer textarea { width:100%; border:1px solid #f0f0f0; padding:10px; border-radius:8px; resize:vertical; min-height:72px; }
        .composer-actions { display:flex; gap:10px; margin-top:10px; align-items:center; }
        .attach-btn { background:#fff; border:1px solid #ffcc80; color:#ff8c00; padding:8px 14px; border-radius:20px; cursor:pointer; display:inline-flex; align-items:center; gap:6px; font-size:14px; transition:all .2s; }
        .attach-btn:hover { background:#fff3e0; border-color:#ff8c00; }
        .btn-orange { background:linear-gradient(135deg,#ff9800,#ff5722); color:#fff; border:none; padding:8px 16px; border-radius:20px; cursor:pointer; display:inline-flex; align-items:center; gap:6px; font-size:14px; box-shadow:0 2px 8px rgba(255,152,0,.25); transition:transform .15s,box-shadow .15s; }
        .btn-orange:hover { transform:translateY(-2px); box-shadow:0 4px 12px rgba(255,152,0,.35); }
        .preview-area { display:grid; grid-template-columns:repeat(auto-fill,minmax(100px,1fr)); gap:10px; margin-top:10px; }
        .preview-area>div { position:relative; border-radius:10px; overflow:hidden; box-shadow:0 2px 8px rgba(0,0,0,.08); }
        .preview-area img { width:100%; height:100px; object-fit:cover; display:block; border-radius:10px; }
        .preview-area button { position:absolute; top:4px; right:4px; width:24px; height:24px; background:rgba(0,0,0,.55); color:#fff; border:none; border-radius:50%; cursor:pointer; font-size:14px; display:flex; align-items:center; justify-content:center; transition:background .2s; }
        .preview-area button:hover { background:rgba(0,0,0,.75); }

        /* åŠ¨æ€å¡ç‰‡æ ·å¼ */
        .posts-list { display:flex; flex-direction:column; gap:12px; }
        .post-card { background:#fff; border:1px solid #f0f0f0; border-radius:12px; padding:16px; transition:box-shadow .2s; }
        .post-card:hover { box-shadow:0 4px 16px rgba(0,0,0,.08); }
        .post-header { display:flex; align-items:center; gap:12px; margin-bottom:12px; }
        .post-header .avatar { width:44px; height:44px; border-radius:50%; background:linear-gradient(135deg,#ff9800,#ff5722); color:#fff; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:18px; flex-shrink:0; }
        .post-author .author-name { font-weight:600; font-size:15px; color:#333; }
        .post-author .post-time { font-size:12px; color:#999; margin-top:2px; }
        .post-body { font-size:15px; line-height:1.7; color:#333; margin-bottom:12px; word-wrap:break-word; }
        .post-body .hashtag { color:#ff8c00; font-weight:500; cursor:pointer; }
        .post-body .hashtag:hover { text-decoration:underline; }
        .post-images { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-bottom:12px; border-radius:8px; overflow:hidden; }
        .post-images img { width:100%; aspect-ratio:1; object-fit:cover; cursor:pointer; transition:transform .2s; }
        .post-images img:hover { transform:scale(1.02); }
        .post-actions { display:flex; gap:24px; padding-top:12px; border-top:1px solid #f5f5f5; }
        .action-btn { background:none; border:none; color:#666; font-size:14px; cursor:pointer; display:flex; align-items:center; gap:6px; padding:6px 12px; border-radius:20px; transition:all .2s; }
        .action-btn:hover { background:#fff3e0; color:#ff8c00; }
        .action-btn.liked { color:#ff5722; }
        .action-btn.liked i { color:#ff5722; }
        .action-btn i { font-size:16px; }

        /* è¯„è®ºåŒºæ ·å¼ */
        .comments-section { margin-top:12px; padding-top:12px; border-top:1px solid #f0f0f0; }
        .comments-list { display:flex; flex-direction:column; gap:16px; margin-bottom:12px; }
        .comment-item { display:flex; gap:10px; }
        .comment-avatar { width:32px; height:32px; border-radius:50%; background:linear-gradient(135deg,#ffb74d,#ff9800); color:#fff; display:flex; align-items:center; justify-content:center; font-weight:600; font-size:13px; flex-shrink:0; }
        .comment-content { flex:1; min-width:0; }
        .comment-header { display:flex; align-items:center; gap:8px; margin-bottom:4px; }
        .comment-author { font-weight:600; font-size:13px; color:#333; }
        .comment-time { font-size:12px; color:#999; }
        .comment-text { font-size:14px; color:#333; line-height:1.5; margin-bottom:6px; word-wrap:break-word; }
        .comment-text .mention { color:#ff8c00; font-weight:500; cursor:pointer; }
        .comment-text .mention:hover { text-decoration:underline; }
        .comment-actions { display:flex; gap:12px; }
        .comment-actions button { background:none; border:none; color:#999; font-size:12px; cursor:pointer; display:flex; align-items:center; gap:4px; padding:2px 6px; border-radius:4px; transition:all .2s; }
        .comment-actions button:hover { color:#ff8c00; background:#fff3e0; }
        .comment-like-btn.liked { color:#ff5722 !important; }
        .comment-like-btn i { font-size:12px; }
        /* å›å¤åµŒå¥—åŒºåŸŸ - Bç«™/å¾®åšé£æ ¼ */
        .replies-wrapper { margin-top:10px; margin-left:42px; padding:12px; background:#f8f8f8; border-radius:8px; }
        .replies-list { display:flex; flex-direction:column; gap:10px; }
        .reply-item { display:flex; gap:8px; }
        .reply-item .comment-avatar { width:24px; height:24px; font-size:11px; }
        .reply-item .comment-author { font-size:12px; }
        .reply-item .comment-text { font-size:13px; margin-bottom:4px; }
        .reply-item .comment-time { font-size:11px; }
        .reply-item .comment-actions button { font-size:11px; }
        .view-more-replies { color:#ff8c00; font-size:12px; cursor:pointer; margin-top:8px; background:none; border:none; padding:0; }
        .view-more-replies:hover { text-decoration:underline; }
        .replies-list { margin-top:10px; display:flex; flex-direction:column; gap:8px; }
        .comment-composer { display:flex; gap:10px; align-items:center; background:#f9f9f9; padding:10px; border-radius:8px; }
        .comment-input { flex:1; border:1px solid #e0e0e0; border-radius:20px; padding:8px 14px; font-size:13px; outline:none; transition:border-color .2s; }
        .comment-input:focus { border-color:#ff9800; }
        .comment-submit-btn { background:linear-gradient(135deg,#ff9800,#ff5722); color:#fff; border:none; padding:8px 16px; border-radius:20px; font-size:13px; cursor:pointer; transition:transform .15s; }
        .comment-submit-btn:hover { transform:scale(1.02); }

        /* çƒ­é—¨æ¨èä¾§è¾¹æ  */
        .channel-container { display:grid; grid-template-columns:280px 1fr 260px; gap:20px; }
        .hot-sidebar { display:flex; flex-direction:column; gap:16px; }
        .hot-section { background:linear-gradient(135deg,#fff 0%,#fffbf7 100%); border:1px solid #ffe0b2; border-radius:12px; padding:16px; box-shadow:0 2px 8px rgba(255,152,0,.08); transition:all .3s; }
        .hot-section:hover { box-shadow:0 4px 16px rgba(255,152,0,.12); }
        .hot-title { font-size:15px; font-weight:700; color:#ff6d00; margin:0 0 12px 0; display:flex; align-items:center; gap:8px; }
        .hot-title i { color:#ff9800; animation:pulse 2s infinite; }
        .hot-list { display:flex; flex-direction:column; gap:8px; }
        .hot-item { display:flex; align-items:center; gap:10px; padding:10px 8px; border-radius:8px; cursor:pointer; transition:all .3s cubic-bezier(.4,0,.2,1); position:relative; }
        .hot-item:hover { background:#fff8f0; transform:translateX(4px); box-shadow:inset 0 0 0 1px #ffe0b2; }
        .hot-rank { width:32px; height:32px; background:linear-gradient(135deg,#ff9800,#ff5722); color:#fff; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:14px; font-weight:700; flex-shrink:0; box-shadow:0 2px 8px rgba(255,152,0,.3); transition:all .3s; }
        .hot-item:hover .hot-rank { transform:scale(1.1); }
        .hot-rank.gold { background:linear-gradient(135deg,#ffd700,#ffb300); box-shadow:0 2px 12px rgba(255,215,0,.4); }
        .hot-rank.silver { background:linear-gradient(135deg,#e8e8e8,#b0b0b0); box-shadow:0 2px 12px rgba(192,192,192,.3); color:#666; }
        .hot-rank.bronze { background:linear-gradient(135deg,#cd7f32,#a0511e); box-shadow:0 2px 12px rgba(205,127,50,.4); }
        .hot-info { flex:1; min-width:0; display:flex; flex-direction:column; gap:2px; }
        .hot-name { font-size:14px; font-weight:700; color:#333; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
        .hot-desc { font-size:11px; color:#bbb; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
        .hot-members { font-size:13px; color:#ff6d00; font-weight:700; white-space:nowrap; text-align:right; min-width:50px; }

        /* å·¦ä¾§æ ï¼šå·²åŠ å…¥ç¾¤ç»„ */
        .channel-sidebar { background:#fff; border:1px solid #ffe0b2; border-radius:12px; padding:16px; height:fit-content; }
        .sidebar-title { font-size:15px; font-weight:700; color:#ff6d00; margin:0 0 12px 0; display:flex; align-items:center; gap:8px; }
        .sidebar-title i { color:#ff9800; }
        .joined-groups-list { display:flex; flex-direction:column; gap:6px; max-height:300px; overflow-y:auto; margin-bottom:12px; }
        .joined-group-item { display:flex; align-items:center; gap:10px; padding:10px; background:#fff; border:1px solid #f0f0f0; border-radius:10px; cursor:pointer; transition:all .2s; }
        .joined-group-item:hover { background:#fff8f0; border-color:#ff9800; }
        .joined-group-item.active { background:#fff3e0; border-color:#ff9800; }
        .jg-avatar { width:36px; height:36px; border-radius:8px; background:linear-gradient(135deg,#ff9800,#ff6d00); display:flex; align-items:center; justify-content:center; color:#fff; font-weight:700; font-size:14px; flex-shrink:0; }
        .jg-info { flex:1; min-width:0; }
        .jg-name { font-size:14px; font-weight:600; color:#333; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
        .jg-members { font-size:12px; color:#999; }
        .jg-unread { background:#ff5722; color:#fff; font-size:11px; padding:2px 6px; border-radius:10px; }

        /* åŠ å…¥ç¾¤ç»„åŒºå— */
        .join-group-section { margin-top:16px; padding-top:16px; border-top:1px solid #f0f0f0; }
        .join-title { font-size:14px; font-weight:600; color:#ff6d00; margin:0 0 10px 0; display:flex; align-items:center; gap:6px; }
        .join-title i { color:#ff9800; font-size:13px; }
        .invite-code-form { display:flex; gap:8px; }
        .invite-code-input { flex:1; padding:10px 12px; border:1px solid #e0e0e0; border-radius:8px; font-size:14px; text-transform:uppercase; letter-spacing:1px; outline:none; transition:border-color .2s; }
        .invite-code-input:focus { border-color:#ff9800; }
        .invite-code-input::placeholder { text-transform:none; letter-spacing:normal; color:#999; }
        .join-code-btn { padding:8px 12px; background:linear-gradient(135deg,#ff9800,#ff5722); color:#fff; border:none; border-radius:8px; font-size:12px; font-weight:600; cursor:pointer; transition:transform .15s; white-space:nowrap; }
        .join-code-btn:hover { transform:scale(1.02); }

        /* ä¸­é—´åŒºåŸŸï¼šTab åˆ‡æ¢æŒ‰é’® */
        .tab-chips { display:flex; gap:8px; margin-left:12px; }
        .tab-chip { padding:8px 20px; border:1px solid #ffe0b2; border-radius:8px; background:#fff; font-size:14px; font-weight:600; cursor:pointer; transition:all .2s; color:#666; }
        .tab-chip:hover { border-color:#ff9800; background:#fff8f0; }
        .tab-chip.active { background:#ff9800; color:#fff; border-color:#ff9800; }

        /* æ´»åŠ¨é¢æ¿æ ·å¼ */
        .activity-section { padding:10px 0; }
        .topics-title { font-size:16px; font-weight:700; color:#333; margin:0 0 16px 0; display:flex; align-items:center; gap:8px; }
        .topics-title i { color:#ff9800; animation:pulse 2s infinite; }
        @keyframes pulse { 0%,100%{transform:scale(1);} 50%{transform:scale(1.1);} }
        @keyframes float { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-4px);} }
        @keyframes shimmer { 0%{background-position:-200% 0;} 100%{background-position:200% 0;} }
        @keyframes progressFill { from{width:0;} }
        .topics-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-bottom:20px; }
        .topic-card { background:linear-gradient(135deg,#fff 0%,#fff8f0 100%); border:1px solid #ffe0b2; border-radius:12px; padding:14px; display:flex; align-items:center; gap:10px; cursor:pointer; transition:all .3s cubic-bezier(.4,0,.2,1); position:relative; overflow:hidden; }
        .topic-card::before { content:''; position:absolute; top:0; left:-100%; width:100%; height:100%; background:linear-gradient(90deg,transparent,rgba(255,255,255,.4),transparent); transition:left .5s; }
        .topic-card:hover::before { left:100%; }
        .topic-card:hover { border-color:#ff9800; transform:translateY(-4px) scale(1.02); box-shadow:0 8px 24px rgba(255,152,0,.2); }
        .topic-icon { font-size:32px; animation:float 3s ease-in-out infinite; }
        .topic-card:nth-child(2) .topic-icon { animation-delay:.5s; }
        .topic-card:nth-child(3) .topic-icon { animation-delay:1s; }
        .topic-info { flex:1; }
        .topic-name { font-size:13px; font-weight:700; color:#ff6d00; margin-bottom:4px; }
        .topic-count { font-size:11px; color:#999; display:flex; align-items:center; gap:3px; }
        .topic-count::before { content:'\f0c0'; font-family:'Font Awesome 6 Free'; font-weight:900; font-size:10px; color:#ffb74d; }
        .ongoing-activities { margin-top:20px; }
        .activity-list { display:flex; flex-direction:column; gap:12px; }
        .activity-card { background:#fff; border:1px solid #f0f0f0; border-radius:12px; padding:16px; transition:all .3s; position:relative; overflow:hidden; }
        .activity-card::after { content:''; position:absolute; top:0; right:0; width:60px; height:60px; background:linear-gradient(135deg,transparent 50%,rgba(255,152,0,.03) 50%); border-radius:0 12px 0 0; }
        .activity-card:hover { border-color:#ffcc80; box-shadow:0 4px 12px rgba(0,0,0,.06); }
        .activity-badge { display:inline-flex; align-items:center; gap:4px; padding:3px 8px; border-radius:20px; font-size:10px; font-weight:600; background:#e8f5e9; color:#4caf50; margin-bottom:8px; }
        .activity-badge::before { content:'\f111'; font-family:'Font Awesome 6 Free'; font-weight:900; font-size:6px; animation:blink 1.5s infinite; }
        @keyframes blink { 0%,100%{opacity:1;} 50%{opacity:.3;} }
        .activity-badge.hot { background:linear-gradient(135deg,#fff3e0,#ffe0b2); color:#e65100; }
        .activity-badge.hot::before { color:#ff5722; }
        .activity-badge.new { background:linear-gradient(135deg,#e3f2fd,#bbdefb); color:#1565c0; }
        .activity-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:6px; }
        .activity-title { font-size:15px; font-weight:700; color:#333; margin-bottom:4px; display:flex; align-items:center; gap:6px; }
        .activity-title-icon { font-size:18px; }
        .activity-desc { font-size:12px; color:#999; margin-bottom:10px; line-height:1.5; }
        .activity-progress { margin-bottom:10px; }
        .progress-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:4px; font-size:11px; }
        .progress-label { color:#999; }
        .progress-value { color:#ff8c00; font-weight:600; font-size:11px; }
        .progress-bar { height:6px; background:#f0f0f0; border-radius:3px; overflow:hidden; }
        .progress-fill { height:100%; background:linear-gradient(90deg,#ffb74d,#ff9800,#ff5722); border-radius:3px; animation:progressFill 1s ease-out; transition:width .3s; }
        .activity-meta { display:flex; flex-wrap:wrap; gap:12px; font-size:11px; color:#bbb; margin-bottom:10px; }
        .activity-meta span { display:flex; align-items:center; gap:4px; }
        .activity-meta i { color:#ffb74d; font-size:12px; }
        .activity-stats { display:flex; gap:16px; margin-bottom:10px; }
        .stat-item { text-align:center; flex:1; }
        .stat-value { font-size:16px; font-weight:700; color:#ff8c00; }
        .stat-label { font-size:10px; color:#bbb; margin-top:2px; }
        .activity-footer { display:flex; justify-content:space-between; align-items:center; gap:8px; }
        .activity-avatars { display:flex; flex-shrink:0; }
        .activity-avatars .avatar { width:24px; height:24px; border-radius:50%; background:linear-gradient(135deg,#ffb74d,#ff9800); color:#fff; display:flex; align-items:center; justify-content:center; font-size:9px; font-weight:600; border:1.5px solid #fff; margin-left:-6px; flex-shrink:0; }
        .activity-avatars .avatar:first-child { margin-left:0; }
        .activity-avatars .avatar.more { background:#f5f5f5; color:#999; font-size:9px; }
        .activity-join-btn { padding:6px 16px; background:linear-gradient(135deg,#ff9800,#ff5722); color:#fff; border:none; border-radius:20px; font-size:12px; font-weight:600; cursor:pointer; transition:all .3s; display:flex; align-items:center; gap:4px; box-shadow:0 2px 8px rgba(255,152,0,.2); white-space:nowrap; flex-shrink:0; }
        .activity-join-btn:hover { box-shadow:0 4px 12px rgba(255,152,0,.3); }
        .activity-join-btn i { font-size:11px; }
        .activity-join-btn.joined { background:linear-gradient(135deg,#66bb6a,#43a047); box-shadow:0 2px 8px rgba(76,175,80,.2); }
        .activity-join-btn.joined:hover { box-shadow:0 4px 12px rgba(76,175,80,.3); }
        .checkin-btn { padding:6px 16px; background:linear-gradient(135deg,#ff5722,#e64a19); color:#fff; border:none; border-radius:20px; font-size:12px; font-weight:600; cursor:pointer; transition:all .3s; display:flex; align-items:center; gap:4px; box-shadow:0 2px 8px rgba(255,87,34,.2); animation:pulse 2s infinite; white-space:nowrap; flex-shrink:0; }
        .checkin-btn:hover { animation:none; transform:scale(1.03); }

        @media (max-width:1100px) { .channel-container { grid-template-columns:240px 1fr; } .hot-sidebar { display:none; } .topics-grid { grid-template-columns:repeat(2,1fr); } }
        @media (max-width:768px) { .channel-container { grid-template-columns:1fr; } .channel-sidebar { display:none; } .topics-grid { grid-template-columns:1fr; } }

        /* åˆ›å»ºç¾¤ç»„å¼¹çª— */
        .modal-overlay { position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,.5); display:none; justify-content:center; align-items:center; z-index:1000; }
        .modal-overlay.show { display:flex; }
        .modal-box { background:#fff; border-radius:16px; width:90%; max-width:480px; padding:24px; box-shadow:0 20px 60px rgba(0,0,0,.3); animation:modalIn .25s ease; }
        @keyframes modalIn { from { opacity:0; transform:scale(.9) translateY(-20px); } to { opacity:1; transform:scale(1) translateY(0); } }
        .modal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
        .modal-title { font-size:20px; font-weight:700; color:#333; }
        .modal-close { background:none; border:none; font-size:24px; color:#999; cursor:pointer; padding:4px 8px; }
        .modal-close:hover { color:#333; }
        .modal-body { display:flex; flex-direction:column; gap:16px; }
        .form-group { display:flex; flex-direction:column; gap:6px; }
        .form-label { font-size:14px; font-weight:600; color:#333; }
        .form-input { padding:12px 14px; border:1px solid #ddd; border-radius:8px; font-size:14px; transition:border-color .2s; }
        .form-input:focus { outline:none; border-color:#ff9800; }
        .form-textarea { resize:vertical; min-height:80px; }
        .form-select { padding:12px 14px; border:1px solid #ddd; border-radius:8px; font-size:14px; background:#fff; cursor:pointer; }
        .form-hint { font-size:12px; color:#999; }
        .invite-code-display { display:flex; align-items:center; gap:8px; padding:10px 14px; background:#fff8f0; border:1px dashed #ff9800; border-radius:8px; }
        .invite-code-display code { font-size:16px; font-weight:700; color:#ff6d00; letter-spacing:1px; }
        .copy-code-btn { padding:4px 10px; background:#ff9800; color:#fff; border:none; border-radius:4px; font-size:12px; cursor:pointer; }
        .copy-code-btn:hover { background:#f57c00; }
        .modal-footer { margin-top:24px; display:flex; justify-content:flex-end; gap:12px; }
        .btn-cancel { padding:10px 24px; background:#f5f5f5; color:#666; border:none; border-radius:8px; font-size:14px; cursor:pointer; }
        .btn-cancel:hover { background:#e0e0e0; }
        .btn-submit { padding:10px 24px; background:linear-gradient(135deg,#ff9800,#ff5722); color:#fff; border:none; border-radius:8px; font-size:14px; font-weight:600; cursor:pointer; }
        .btn-submit:hover { box-shadow:0 4px 12px rgba(255,152,0,.4); }
        
        /* åˆ é™¤ç¾¤ç»„æŒ‰é’® */
        .joined-group-item { position:relative; }
        .jg-delete-btn { position:absolute; right:8px; top:50%; transform:translateY(-50%); width:24px; height:24px; background:#fff; border:1px solid #ffcdd2; border-radius:50%; color:#e57373; font-size:14px; cursor:pointer; display:none; align-items:center; justify-content:center; transition:all .2s; }
        .jg-delete-btn:hover { background:#ffebee; border-color:#ef5350; color:#d32f2f; }
        .joined-group-item:hover .jg-delete-btn { display:flex; }
        
        /* ç¡®è®¤åˆ é™¤å¼¹çª— */
        .confirm-modal { position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,.5); display:none; justify-content:center; align-items:center; z-index:1001; }
        .confirm-modal.show { display:flex; }
        .confirm-box { background:#fff; border-radius:12px; padding:24px; width:90%; max-width:360px; text-align:center; animation:modalIn .2s ease; }
        .confirm-icon { font-size:48px; color:#ff9800; margin-bottom:16px; }
        .confirm-title { font-size:18px; font-weight:700; color:#333; margin-bottom:8px; }
        .confirm-msg { font-size:14px; color:#666; margin-bottom:24px; line-height:1.5; }
        .confirm-btns { display:flex; gap:12px; justify-content:center; }
        .btn-confirm-cancel { padding:10px 28px; background:#f5f5f5; color:#666; border:none; border-radius:8px; font-size:14px; cursor:pointer; }
        .btn-confirm-cancel:hover { background:#e0e0e0; }
        .btn-confirm-delete { padding:10px 28px; background:#f44336; color:#fff; border:none; border-radius:8px; font-size:14px; font-weight:600; cursor:pointer; }
        .btn-confirm-delete:hover { background:#d32f2f; }
    </style>
</head>
<body>
    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="audioPlayer" controls style="display: none;">
        <source src="" type="audio/mpeg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
    </audio>

    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="header">
        <div class="logo">
            <div class="logo-img"></div>
            <span class="logo-text">æ˜Ÿä¹‹å£°</span>
        </div>
        <nav class="main-nav">
            <a href="index.html" class="nav-item">é¦–é¡µ</a>
            <a href="category.html" class="nav-item">åˆ†ç±»</a>
            <a href="channel.html" class="nav-item active">ç¤¾åŒº</a>
        </nav>
        <div class="search-box">
            <input type="text" placeholder="æœç´¢è¯¾ç¨‹ã€é¢‘é“..." class="search-input" id="homeSearchInput">
            <button class="search-btn" id="homeSearchBtn"><i class="fas fa-search"></i></button>
        </div>
        <div class="user-functions">
            <a href="my-recent.html" class="func-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
            </a>
            <a href="my-message.html" class="func-item"><i class="fas fa-bell"></i> æ¶ˆæ¯</a>
            <a href="my-collect.html" class="func-item"><i class="fas fa-star"></i> æ”¶è—</a>
            <a href="my-recent.html" class="func-item"><i class="fas fa-history"></i> å†å²</a>
            <a href="my-creator_center.html" class="func-item"><i class="fas fa-pen"></i> åˆ›ä½œä¸­å¿ƒ</a>
            <a href="login.html"><button class="submit-btn">ç™»å½•/æ³¨å†Œ</button></a>
        </div>
    </header>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸï¼šåˆ†ç±»ä¾§æ  + ç¾¤ç»„åˆ—è¡¨ / åŠ¨æ€ Feed -->
    <main class="main channel-main">
      <div class="container channel-container">
        <!-- å·¦ä¾§ï¼šå·²åŠ å…¥çš„ç¾¤ç»„åˆ—è¡¨ -->
        <aside class="channel-sidebar">
          <h3 class="sidebar-title"><i class="fas fa-users"></i> å·²åŠ å…¥çš„ç¾¤ç»„</h3>
          <div class="joined-groups-list" id="joinedGroupsList">
            <!-- ç”± JS æ¸²æŸ“ -->
          </div>
          <button class="create-group-btn" id="openCreateGroupBtn">+ åˆ›å»ºç¾¤ç»„</button>
          
          <!-- åŠ å…¥ç¾¤ç»„ -->
          <div class="join-group-section">
            <h4 class="join-title"><i class="fas fa-sign-in-alt"></i> åŠ å…¥ç¾¤ç»„</h4>
            <div class="invite-code-form">
              <input type="text" id="inviteCodeInput" class="invite-code-input" placeholder="è¾“å…¥é‚€è¯·ç " maxlength="8" />
              <button id="joinByCodeBtn" class="join-code-btn">åŠ å…¥</button>
            </div>
          </div>
        </aside>

    <!-- åˆ›å»ºç¾¤ç»„å¼¹çª— -->
    <div class="modal-overlay" id="createGroupModal">
      <div class="modal-box">
        <div class="modal-header">
          <h3 class="modal-title">åˆ›å»ºæ–°ç¾¤ç»„</h3>
          <button class="modal-close" id="closeCreateGroupBtn">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">ç¾¤ç»„åç§° *</label>
            <input type="text" class="form-input" id="newGroupName" placeholder="ä¾‹å¦‚ï¼šé›…æ€å¤‡è€ƒäº¤æµç¾¤" maxlength="20" />
          </div>
          <div class="form-group">
            <label class="form-label">ç¾¤ç»„ç®€ä»‹</label>
            <textarea class="form-input form-textarea" id="newGroupDesc" placeholder="ç®€å•ä»‹ç»ç¾¤ç»„çš„ä¸»é¢˜å’Œç›®çš„..." maxlength="100"></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">ç¾¤ç»„åˆ†ç±»</label>
            <select class="form-select" id="newGroupCategory">
              <option value="å­¦ä¹ ">å­¦ä¹ </option>
              <option value="è€ƒè¯•">è€ƒè¯•</option>
              <option value="å…´è¶£">å…´è¶£</option>
              <option value="å…¶ä»–">å…¶ä»–</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">ç¾¤ç»„é‚€è¯·ç </label>
            <div class="invite-code-display">
              <code id="generatedInviteCode">------</code>
              <button class="copy-code-btn" id="copyNewCodeBtn">å¤åˆ¶</button>
            </div>
            <span class="form-hint">é‚€è¯·ç å°†åœ¨åˆ›å»ºåè‡ªåŠ¨ç”Ÿæˆï¼Œå¯åˆ†äº«ç»™æœ‹å‹åŠ å…¥</span>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn-cancel" id="cancelCreateGroupBtn">å–æ¶ˆ</button>
          <button class="btn-submit" id="submitCreateGroupBtn">åˆ›å»ºç¾¤ç»„</button>
        </div>
      </div>
    </div>

    <!-- ç¡®è®¤åˆ é™¤å¼¹çª— -->
    <div class="confirm-modal" id="deleteConfirmModal">
      <div class="confirm-box">
        <div class="confirm-icon"><i class="fas fa-exclamation-triangle"></i></div>
        <div class="confirm-title">ç¡®è®¤é€€å‡ºç¾¤ç»„</div>
        <div class="confirm-msg">ä½ ç¡®å®šè¦é€€å‡ºã€Œ<span id="deleteGroupName"></span>ã€ç¾¤ç»„å—ï¼Ÿ</div>
        <div class="confirm-btns">
          <button class="btn-confirm-cancel" id="cancelDeleteBtn">å–æ¶ˆ</button>
          <button class="btn-confirm-delete" id="confirmDeleteBtn">ç¡®è®¤é€€å‡º</button>
        </div>
      </div>
    </div>

        <!-- ä¸­é—´ä¸»è§†å›¾åŒºï¼ˆå·¥å…·æ  + åˆ—è¡¨æˆ– Feedï¼‰ -->
        <section class="groups-section">
          <div class="channel-controls">
            <div class="left-controls">
              <div class="tab-chips">
                <button class="tab-chip active" data-tab="feed">åŠ¨æ€</button>
                <button class="tab-chip" data-tab="groups">ç¾¤ç»„</button>
                <button class="tab-chip" data-tab="activity">æ´»åŠ¨</button>
              </div>
            </div>
            <div class="right-controls">
              <span class="sort-label">æ’åºï¼š</span>
              <!-- åŠ¨æ€æ’åº -->
              <select id="feedSortSelect">
                <option value="new">æœ€æ–°</option>
                <option value="hot">æœ€çƒ­</option>
              </select>
              <!-- ç¾¤ç»„æ’åº -->
              <select id="groupSortSelect" style="display:none;">
                <option value="active">æ´»è·ƒåº¦</option>
                <option value="new">æœ€æ–°</option>
                <option value="members">æˆå‘˜æ•°</option>
              </select>
            </div>
          </div>

          <!-- ç¾¤ç»„åˆ—è¡¨é¢æ¿ -->
          <div id="groupsPanel" class="panel">
            <div id="groupsGrid" class="groups-grid"></div>
          </div>

          <!-- æ´»åŠ¨é¢æ¿ -->
          <div id="activityPanel" class="panel" style="display:none;">
            <div class="activity-section">
              <div class="hot-topics">
                <h4 class="topics-title"><i class="fas fa-fire"></i> çƒ­é—¨æ´»åŠ¨</h4>
                <div class="topics-grid">
                  <div class="topic-card" data-topic="æ¯æ—¥ä¸€å¥">
                    <div class="topic-icon">ğŸ’¬</div>
                    <div class="topic-info">
                      <div class="topic-name">#æ¯æ—¥ä¸€å¥#</div>
                      <div class="topic-count">1.2ä¸‡äººå‚ä¸</div>
                    </div>
                  </div>
                  <div class="topic-card" data-topic="æ‰“å¡æŒ‘æˆ˜">
                    <div class="topic-icon">âœ…</div>
                    <div class="topic-info">
                      <div class="topic-name">#æ‰“å¡æŒ‘æˆ˜#</div>
                      <div class="topic-count">5.1åƒäººå‚ä¸</div>
                    </div>
                  </div>
                  <div class="topic-card" data-topic="è‹±è¯­å­¦ä¹ ">
                    <div class="topic-icon">ğŸ“š</div>
                    <div class="topic-info">
                      <div class="topic-name">#è‹±è¯­å­¦ä¹ #</div>
                      <div class="topic-count">8.5åƒäººå‚ä¸</div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="ongoing-activities">
                <h4 class="topics-title"><i class="fas fa-calendar-alt"></i> è¿›è¡Œä¸­çš„æ´»åŠ¨</h4>
                <div class="activity-list">
                  <div class="activity-card">
                    <div class="activity-badge">è¿›è¡Œä¸­</div>
                    <div class="activity-title"><span class="activity-title-icon">ğŸŒ…</span> 21å¤©æ—©èµ·æ‰“å¡æŒ‘æˆ˜</div>
                    <div class="activity-desc">è¿ç»­21å¤©æ—©èµ·7ç‚¹å‰æ‰“å¡ï¼Œå…»æˆæ—©èµ·å¥½ä¹ æƒ¯ï¼Œèµ¢å–ä¸“å±å‹‹ç« ï¼</div>
                    <div class="activity-progress">
                      <div class="progress-header">
                        <span class="progress-label">æ´»åŠ¨è¿›åº¦</span>
                        <span class="progress-value">6/21 å¤©</span>
                      </div>
                      <div class="progress-bar">
                        <div class="progress-fill" style="width:28%"></div>
                      </div>
                    </div>
                    <div class="activity-meta">
                      <span><i class="fas fa-users"></i> 108äººå‚ä¸</span>
                      <span><i class="fas fa-clock"></i> è¿˜å‰©15å¤©ç»“æŸ</span>
                      <span><i class="fas fa-trophy"></i> å·²æœ‰18äººå®Œæˆ</span>
                    </div>
                    <div class="activity-footer">
                      <div class="activity-avatars">
                        <div class="avatar">å°</div>
                        <div class="avatar">çº¢</div>
                        <div class="avatar">æ˜</div>
                        <div class="avatar more">+105</div>
                      </div>
                      <button class="checkin-btn"><i class="fas fa-check"></i> ç«‹å³æ‰“å¡</button>
                    </div>
                  </div>
                  <div class="activity-card">
                    <div class="activity-badge hot">ç«çˆ†</div>
                    <div class="activity-title"><span class="activity-title-icon">ğŸ’¬</span> æ¯æ—¥ä¸€å¥è‹±æ–‡</div>
                    <div class="activity-desc">æ¯å¤©å­¦ä¸€å¥åœ°é“è‹±æ–‡è¡¨è¾¾ï¼Œç§¯å°‘æˆå¤šï¼ŒåšæŒå°±æ˜¯èƒœåˆ©ï¼</div>
                    <div class="activity-stats">
                      <div class="stat-item">
                        <div class="stat-value">1.5åƒ</div>
                        <div class="stat-label">å‚ä¸äººæ•°</div>
                      </div>
                      <div class="stat-item">
                        <div class="stat-value">365</div>
                        <div class="stat-label">ä»Šæ—¥æ‰“å¡</div>
                      </div>
                      <div class="stat-item">
                        <div class="stat-value">28</div>
                        <div class="stat-label">æˆ‘çš„è¿ç»­</div>
                      </div>
                    </div>
                    <div class="activity-meta">
                      <span><i class="fas fa-infinity"></i> é•¿æœŸæ´»åŠ¨</span>
                      <span><i class="fas fa-fire"></i> ä»Šæ—¥çƒ­åº¦ TOP1</span>
                    </div>
                    <div class="activity-footer">
                      <div class="activity-avatars">
                        <div class="avatar">è‹±</div>
                        <div class="avatar">å­¦</div>
                        <div class="avatar">éœ¸</div>
                        <div class="avatar more">+1.5åƒ</div>
                      </div>
                      <button class="activity-join-btn joined"><i class="fas fa-check-circle"></i> å·²å‚åŠ </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Feed åŠ¨æ€é¢æ¿ -->
          <div id="feedPanel" class="panel">
            <section id="feedSection" class="feed-section">
              <div class="composer">
                <textarea id="composerInput" placeholder="è¯´ç‚¹ä»€ä¹ˆ..." rows="3"></textarea>
                <div class="composer-actions">
                  <input type="file" id="composerFiles" accept="image/*" multiple style="display:none;">
                  <button id="attachBtn" class="attach-btn"><i class="fas fa-image"></i> å›¾ç‰‡</button>
                  <button id="postBtn" class="btn-orange"><i class="fas fa-paper-plane"></i> å‘å¸ƒ</button>
                </div>
                <div id="previewArea" class="preview-area"></div>
              </div>

              <div id="postsList" class="posts-list"></div>
            </section>
          </div>
        </section>

        <!-- çƒ­é—¨æ¨èä¾§è¾¹æ  -->
        <aside class="hot-sidebar">
          <div class="hot-section">
            <h3 class="hot-title"><i class="fas fa-fire"></i> çƒ­é—¨æ¨è</h3>
            <div class="hot-list" id="hotGroupsList">
              <div class="hot-item">
                <div class="hot-rank">1</div>
                <div class="hot-info">
                  <div class="hot-name">è‹±è¯­å£è¯­ç»ƒä¹ ç¾¤</div>
                  <div class="hot-desc">å£è¯­ç»ƒä¹ ä¸èµ„æºåˆ†äº«</div>
                </div>
                <div class="hot-members">128äºº</div>
              </div>
              <div class="hot-item">
                <div class="hot-rank">2</div>
                <div class="hot-info">
                  <div class="hot-name">æ‰˜ç¦å¤‡è€ƒç¾¤</div>
                  <div class="hot-desc">æ¯å¤©æ—©èµ·ä¸€èµ·å­¦ä¹ </div>
                </div>
                <div class="hot-members">64äºº</div>
              </div>
              <div class="hot-item">
                <div class="hot-rank">3</div>
                <div class="hot-info">
                  <div class="hot-name">å•†åŠ¡è‹±è¯­äº¤æµ</div>
                  <div class="hot-desc">é•¿ç¯‡ææ–™è®¨è®º</div>
                </div>
                <div class="hot-members">32äºº</div>
              </div>
            </div>
          </div>
          <div class="hot-section">
            <h3 class="hot-title"><i class="fas fa-chart-line"></i> æ´»è·ƒæ’è¡Œ</h3>
            <div class="hot-list">
              <div class="hot-item">
                <div class="hot-rank gold">1</div>
                <div class="hot-info">
                  <div class="hot-name">å°æ˜</div>
                  <div class="hot-desc">å‘å¸ƒäº†12æ¡åŠ¨æ€</div>
                </div>
              </div>
              <div class="hot-item">
                <div class="hot-rank silver">2</div>
                <div class="hot-info">
                  <div class="hot-name">å°çº¢</div>
                  <div class="hot-desc">å‘å¸ƒäº†8æ¡åŠ¨æ€</div>
                </div>
              </div>
              <div class="hot-item">
                <div class="hot-rank bronze">3</div>
                <div class="hot-info">
                  <div class="hot-name">å°å</div>
                  <div class="hot-desc">å‘å¸ƒäº†5æ¡åŠ¨æ€</div>
                </div>
              </div>
            </div>
          </div>
        </aside>
      </div>
    </main>

    <!-- æ›¿æ¢åº•éƒ¨æ’­æ”¾æ ä¸º PlayBar.html ç‰ˆæœ¬ -->
    <aside id="pv-player" class="pv-player-bar" role="region" aria-label="æ’­æ”¾å™¨">
      <div class="pv-inner">
        <!-- å·¦ä¾§ï¼šå°é¢ä¸æ ‡é¢˜ -->
        <div class="pv-left">
          <div id="pv-cover" class="pv-cover"></div>
          <div class="pv-meta">
            <div id="pv-title" class="pv-title">Kalimba (Test Audio)</div>
            <div id="pv-artist" class="pv-artist">Ninja Tuna</div>
          </div>
        </div>

        <!-- ä¸­é—´ï¼šæ§åˆ¶ä¸è¿›åº¦ -->
        <div class="pv-center">
          <div class="pv-controls">
            <button id="pv-prev" class="ctrl-btn" title="ä¸Šä¸€é¦–" aria-label="ä¸Šä¸€é¦–">
              <svg class="icon" viewBox="0 0 24 24"><path d="M6 6h2v12H6V6zm3.5 6l8.5 6V6l-8.5 6z"/></svg>
            </button>
            <button id="pv-play" class="play-btn" title="æ’­æ”¾/æš‚åœ" aria-label="æ’­æ”¾/æš‚åœ">
              <svg id="play-icon" class="icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
            </button>
            <button id="pv-next" class="ctrl-btn" title="ä¸‹ä¸€é¦–" aria-label="ä¸‹ä¸€é¦–">
              <svg class="icon" viewBox="0 0 24 24"><path d="M16 6h2v12h-2V6zM6 18l8.5-6L6 6v12z"/></svg>
            </button>

            <!-- æ’­æ”¾æ¨¡å¼ -->
            <div style="position: relative;">
              <button id="pv-mode-btn" class="mode-btn" title="æ’­æ”¾æ¨¡å¼" aria-label="æ’­æ”¾æ¨¡å¼">
                <svg class="icon" viewBox="0 0 24 24"><path d="M7 7h8v3l4-4-4-4v3H5v6h2V7zm10 10H9v-3l-4 4 4 4v-3h10v-6h-2v4z"/></svg>
              </button>
              <div id="mode-pop" class="popover mode-popover" style="display:none;">
                <div class="mode-item active" data-mode="single" title="å•æ›²å¾ªç¯">
                  <svg class="icon" viewBox="0 0 24 24"><path d="M12 5v4l-1.5-1.5C8 10 8 14 10.5 16.5S16 19 18.5 16.5L20 18c-3 3-8 3-11 0S6 9 9 6L12 5z"/></svg>
                </div>
                <div class="mode-item" data-mode="list" title="æ­Œå•é¡ºåºå¾ªç¯">
                  <svg class="icon" viewBox="0 0 24 24"><path d="M4 6h12v2H4V6zm0 5h12v2H4v-2zm0 5h8v2H4v-2zm15-7l-3 3h2v4h2v-4h2l-3-3z"/></svg>
                </div>
                <div class="mode-item" data-mode="shuffle" title="æ­Œå•ä¹±åºå¾ªç¯">
                  <svg class="icon" viewBox="0 0 24 24"><path d="M16 3h5v5h-2V6.41l-4.29 4.3-1.42-1.42L17.59 5H16V3zM4 6h7l2 2H4V6zm0 6h5l2 2H4v-2zm12 3h1.59l-2.29 2.29 1.42 1.42L20 17.41V19h2v-5h-5v2z"/></svg>
                </div>
              </div>
            </div>

            <!-- å€é€Ÿ -->
            <div class="rate-control" style="position: relative;">
              <button id="pv-rate-btn" class="rate-btn" title="å€é€Ÿ"><span id="rate-text" style="font-size: 12px; font-weight: bold;">1x</span></button>
              <div id="rate-pop" class="popover rate-popover" style="display:none;">
                <div class="rate-item" data-rate="0.5">0.5x</div>
                <div class="rate-item active" data-rate="1">1.0x</div>
                <div class="rate-item" data-rate="1.5">1.5x</div>
                <div class="rate-item" data-rate="2">2.0x</div>
              </div>
            </div>
          </div>

          <div class="pv-progress-row">
            <span id="pv-time-cur" class="time small">00:00</span>
            <div id="pv-progress" class="pv-progress">
              <div id="pv-progress-fill" class="pv-progress-fill"></div>
              <div id="pv-knob" class="pv-knob"></div>
            </div>
            <span id="pv-time-total" class="time small">00:00</span>
          </div>
        </div>

        <!-- å³ä¾§ï¼šéŸ³é‡ -->
        <div class="pv-right">
          <button id="pv-mute" class="ctrl-btn" title="é™éŸ³/å–æ¶ˆé™éŸ³" aria-label="é™éŸ³">
            <svg id="vol-icon" class="icon" viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3z"/></svg>
          </button>
          <div id="pv-volume" class="pv-volume" title="éŸ³é‡">
            <div class="pv-volume-bar"><div id="pv-volume-fill" class="pv-volume-fill"></div></div>
          </div>
          <button id="pv-list-btn" class="ctrl-btn" title="æ’­æ”¾åˆ—è¡¨" aria-label="æ’­æ”¾åˆ—è¡¨">â–¤</button>
        </div>
      </div>

      <!-- æ’­æ”¾åˆ—è¡¨å¼¹çª—ï¼ˆç¤ºä¾‹ï¼‰ -->
      <div id="playlist-panel" class="playlist-panel">
        <div class="playlist-item active" onclick="playIndex(0)">1. Kalimba (Test)</div>
        <div class="playlist-item" onclick="playIndex(1)">2. Sample MP3 (Test)</div>
      </div>

      <audio id="pv-audio" preload="metadata"></audio>
    </aside>

    <!-- åˆ›å»ºç¾¤ç»„æ¨¡æ€æ¡†æ ·å¼ -->
    <style>
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .modal {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            overflow: hidden;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background-color: #FFDAB9;
            color: #333;
        }
        .modal-title {
            margin: 0;
            font-size: 20px;
        }
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #333;
        }
        .modal-content {
            padding: 20px;
        }
        .form-group {
            margin-bottom: 16px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px;
            background-color: #f5f5f5;
        }
        .btn-cancel,
        .btn-create {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .btn-cancel {
            background-color: #ccc;
            color: #333;
        }
        .btn-create {
            background-color: #FF6B35;
            color: white;
        }
        .btn-create:hover {
            background-color: #E55A2A;
        }
        .create-group-btn {
            background-color: #FF6B35;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 16px;
            font-size: 14px;
            cursor: pointer;
            margin-bottom: 16px;
        }
        .create-group-btn:hover {
            background-color: #E55A2A;
        }
    </style>

    <!-- PlayBar å¯¼èˆªä¸åŸºç¡€äº¤äº’ï¼ˆç®€ç‰ˆï¼‰ -->
    <script>
      (function () {
        const audio = document.getElementById('pv-audio');
        const playBtn = document.getElementById('pv-play');
        const progressWrap = document.getElementById('pv-progress');

        function formatTime(s) {
          if (!s || isNaN(s) || s <= 0) return '00:00';
          const m = Math.floor(s / 60), sec = Math.floor(s % 60);
          return `${String(m).padStart(2,'0')}:${String(sec).padStart(2,'0')}`;
        }

        const timeCurEl = document.getElementById('pv-time-cur');
        const timeTotalEl = document.getElementById('pv-time-total');
        const progFill = document.getElementById('pv-progress-fill');
        const pvKnob = document.getElementById('pv-knob');

        function togglePlay() {
          if (!audio) return;
          const playIcon = document.getElementById('play-icon');
          if (audio.paused) {
            audio.play().catch(()=>{});
            playBtn.setAttribute('aria-pressed','true');
            if (playIcon) playIcon.innerHTML = '<path d="M6 5h4v14H6V5zm8 0h4v14h-4V5z"/>';
          } else {
            audio.pause();
            playBtn.setAttribute('aria-pressed','false');
            if (playIcon) playIcon.innerHTML = '<path d="M8 5v14l11-7z"/>';
          }
        }
        if (playBtn) playBtn.addEventListener('click', (e) => { e.stopPropagation(); togglePlay(); });

        if (audio) {
          audio.addEventListener('timeupdate', () => {
            const dur = audio.duration || 0;
            const cur = audio.currentTime || 0;
            const pct = dur ? (cur / dur) * 100 : 0;
            if (progFill) progFill.style.width = pct + '%';
            if (pvKnob) pvKnob.style.left = pct + '%';
            if (timeCurEl) timeCurEl.textContent = formatTime(cur);
            if (timeTotalEl) timeTotalEl.textContent = formatTime(dur);
          });
          audio.addEventListener('loadedmetadata', () => {
            if (timeTotalEl) timeTotalEl.textContent = formatTime(audio.duration);
          });
          audio.addEventListener('ended', () => {
            const playIcon = document.getElementById('play-icon');
            if (playIcon) playIcon.innerHTML = '<path d="M8 5v14l11-7z"/>';
            playBtn.setAttribute('aria-pressed','false');
          });
        }

        // ç‚¹å‡»è¿›åº¦æ¡è·³è½¬
        if (progressWrap) {
          progressWrap.addEventListener('click', (e) => {
            if (!audio || !audio.duration) return;
            const rect = progressWrap.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const p = Math.max(0, Math.min(1, x / rect.width));
            audio.currentTime = p * audio.duration;
          });
        }
      })();
    </script>

    <!-- PlayBar ä¸šåŠ¡è„šæœ¬ï¼ˆæ¥è‡ª PlayBar.htmlï¼‰ -->
    <script>
    ;(function () {
      const playlist = [
        { title: "Kalimba (Test Audio)", artist: "Ninja Tuna", cover: "", src: "https://www.learningcontainer.com/wp-content/uploads/2020/02/Kalimba.mp3" },
        { title: "Sample MP3 (700KB)", artist: "Sample Source", cover: "", src: "https://sample.cat/downloads/file_example_MP3_700KB.mp3" }
      ];

      let currentIndex = 0;
      let isPlaying = false;
      let isDraggingProgress = false;
      let isDraggingVolume = false;
      let playMode = 'list'; /* single | list | shuffle */

      const audio = document.getElementById('pv-audio');
      const playBtn = document.getElementById('pv-play');
      const playIcon = document.getElementById('play-icon');
      const prevBtn = document.getElementById('pv-prev');
      const nextBtn = document.getElementById('pv-next');
      const titleEl = document.getElementById('pv-title');
      const artistEl = document.getElementById('pv-artist');
      const coverEl = document.getElementById('pv-cover');
      const progressEl = document.getElementById('pv-progress');
      const progressFill = document.getElementById('pv-progress-fill');
      const knobEl = document.getElementById('pv-knob');
      const timeCurEl = document.getElementById('pv-time-cur');
      const timeTotalEl = document.getElementById('pv-time-total');
      const volEl = document.getElementById('pv-volume');
      const volFill = document.getElementById('pv-volume-fill');
      const listBtn = document.getElementById('pv-list-btn');
      const playlistPanel = document.getElementById('playlist-panel');
      const rateBtn = document.getElementById('pv-rate-btn');
      const rateText = document.getElementById('rate-text');
      const muteBtn = document.getElementById('pv-mute');
      const volIcon = document.getElementById('vol-icon');
      const modeBtn = document.getElementById('pv-mode-btn');
      const modePop = document.getElementById('mode-pop');
      const ratePop = document.getElementById('rate-pop');

      function loadTrack(index) {
        const track = playlist[index];
        titleEl.innerText = track.title;
        artistEl.innerText = track.artist;
        coverEl.style.backgroundImage = track.cover ? `url('${track.cover}')` : '';
        audio.src = track.src;
        document.querySelectorAll('.playlist-item').forEach((item, i) => item.classList.toggle('active', i === index));
      }
      function playTrack() { audio.play().then(() => { isPlaying = true; updatePlayIcon(); }).catch(err => console.error("Play failed:", err)); }
      function pauseTrack() { audio.pause(); isPlaying = false; updatePlayIcon(); }
      function togglePlay() { isPlaying ? pauseTrack() : playTrack(); }
      function updatePlayIcon() {
        playIcon.setAttribute('viewBox','0 0 24 24');
        playIcon.innerHTML = isPlaying ? '<path d="M6 5h4v14H6V5zm8 0h4v14h-4V5z"/>' : '<path d="M8 5v14l11-7z"/>';
      }
      function formatTime(s) { if (!s || isNaN(s)) return "00:00"; const m = Math.floor(s/60), ss = Math.floor(s%60); return `${m<10?'0':''}${m}:${ss<10?'0':''}${ss}`; }
      function stopWrap(handler) { return function(e){ e.stopPropagation(); handler(e); }; }

      /* æ§ä»¶äº‹ä»¶ï¼ˆé˜»æ­¢å†’æ³¡ï¼‰ */
      playBtn.addEventListener('click', stopWrap(togglePlay));
      prevBtn.addEventListener('click', stopWrap(() => prevByMode()));
      nextBtn.addEventListener('click', stopWrap(() => nextByMode()));
      muteBtn.addEventListener('click', stopWrap(() => {
        audio.muted = !audio.muted;
        if (audio.muted || audio.volume === 0) { volIcon.innerHTML = '<path d="M3 9v6h4l5 5V4L7 9H3zM14 3l7 7-1.4 1.4L16 7.8V16h-2V8.6L9.4 4 11 2.4 14 3z"/>'; }
        else if (audio.volume < 0.5) { volIcon.innerHTML = '<path d="M3 9v6h4l5 5V4L7 9H3zM14 9v6c1.7-0.7 3-2.4 3-4.5S15.7 9.7 14 9z"/>'; }
        else { volIcon.innerHTML = '<path d="M3 9v6h4l5 5V4L7 9H3zM14 7v10c3-1 5-3.6 5-7s-2-6-5-7z"/>'; }
      }));

      /* æ¨¡å¼å¼¹å±‚ */
      modeBtn.addEventListener('click', stopWrap(() => {
        ratePop.style.display = 'none';
        modePop.style.display = modePop.style.display === 'flex' ? 'none' : 'flex';
      }));
      modePop.addEventListener('click', stopWrap((e) => {
        const item = e.target.closest('.mode-item');
        if (!item) return;
        playMode = item.getAttribute('data-mode');
        document.querySelectorAll('#mode-pop .mode-item').forEach(el => el.classList.toggle('active', el === item));
        modePop.style.display = 'none';
      }));

      /* å€é€Ÿå¼¹å±‚ */
      rateBtn.addEventListener('click', stopWrap(() => {
        modePop.style.display = 'none';
        ratePop.style.display = ratePop.style.display === 'flex' ? 'none' : 'flex';
      }));
      ratePop.addEventListener('click', stopWrap((e) => {
        const item = e.target.closest('.rate-item');
        if (!item) return;
        const r = parseFloat(item.getAttribute('data-rate'));
        audio.playbackRate = r;
        rateText.innerText = r.toFixed(1) + 'x';
        document.querySelectorAll('#rate-pop .rate-item').forEach(el => el.classList.toggle('active', el === item));
        ratePop.style.display = 'none';
      }));

      /* ç‚¹å‡»å…¶ä»–åŒºåŸŸå…³é—­å¼¹å±‚ */
      document.addEventListener('click', (e) => {
        if (!modeBtn.contains(e.target) && !modePop.contains(e.target)) modePop.style.display = 'none';
        if (!rateBtn.contains(e.target) && !ratePop.contains(e.target)) ratePop.style.display = 'none';
      });

      /* éŸ³é¢‘äº‹ä»¶ä¸åˆ‡æ­Œæ¨¡å¼ */
      audio.addEventListener('timeupdate', () => {
        if (isDraggingProgress) return;
        const percent = (audio.currentTime / audio.duration) * 100;
        progressFill.style.width = `${percent}%`;
        knobEl.style.left = `${percent}%`;
        timeCurEl.innerText = formatTime(audio.currentTime);
      });
      audio.addEventListener('loadedmetadata', () => { timeTotalEl.innerText = formatTime(audio.duration); });
      audio.addEventListener('ended', () => {
        if (playMode === 'single') { audio.currentTime = 0; playTrack(); }
        else { nextByMode(); }
      });
      function prevByMode() {
        if (playMode === 'shuffle') currentIndex = Math.floor(Math.random() * playlist.length);
        else currentIndex = (currentIndex - 1 + playlist.length) % playlist.length;
        loadTrack(currentIndex); playTrack();
      }
      function nextByMode() {
        if (playMode === 'shuffle') currentIndex = Math.floor(Math.random() * playlist.length);
        else currentIndex = (currentIndex + 1) % playlist.length;
        loadTrack(currentIndex); playTrack();
      }

      /* è¿›åº¦æ¡æ‹–æ‹½ï¼ˆé¼ æ ‡/è§¦æ‘¸ï¼‰ */
      function handleProgressInput(clientX) {
        const rect = progressEl.getBoundingClientRect();
        let x = clientX - rect.left; x = Math.max(0, Math.min(x, rect.width));
        const pct = (x / rect.width) * 100; progressFill.style.width = `${pct}%`; knobEl.style.left = `${pct}%`;
        return (x / rect.width) * audio.duration;
      }
      progressEl.addEventListener('mousedown', stopWrap((e) => { isDraggingProgress = true; progressEl.classList.add('dragging'); const t = handleProgressInput(e.clientX); timeCurEl.innerText = formatTime(t); }));
      document.addEventListener('mousemove', (e) => { if (isDraggingProgress) { e.preventDefault(); const t = handleProgressInput(e.clientX); timeCurEl.innerText = formatTime(t); } });
      document.addEventListener('mouseup', (e) => { if (isDraggingProgress) { isDraggingProgress = false; progressEl.classList.remove('dragging'); const t = handleProgressInput(e.clientX); if (isFinite(t)) audio.currentTime = t; } });

      function getTouchX(e){ return (e.touches&&e.touches[0]) ? e.touches[0].clientX : (e.changedTouches&&e.changedTouches[0] ? e.changedTouches[0].clientX : 0); }
      progressEl.addEventListener('touchstart', (e) => { e.stopPropagation(); e.preventDefault(); isDraggingProgress = true; const t = handleProgressInput(getTouchX(e)); timeCurEl.innerText = formatTime(t); }, { passive:false });
      document.addEventListener('touchmove', (e) => { if (isDraggingProgress) { e.preventDefault(); const t = handleProgressInput(getTouchX(e)); timeCurEl.innerText = formatTime(t); } }, { passive:false });
      document.addEventListener('touchend', (e) => { if (isDraggingProgress) { isDraggingProgress = false; const t = handleProgressInput(getTouchX(e)); if (isFinite(t)) audio.currentTime = t; } }, { passive:false });

      /* éŸ³é‡æ‹–æ‹½ï¼ˆé¼ æ ‡/è§¦æ‘¸ï¼‰ */
      function handleVolumeInput(clientX) {
        const rect = volEl.getBoundingClientRect();
        let x = clientX - rect.left; x = Math.max(0, Math.min(x, rect.width));
        const p = x / rect.width; volFill.style.width = `${p * 100}%`; audio.volume = p;
        if (p === 0 || audio.muted) { volIcon.innerHTML = '<path d="M3 9v6h4l5 5V4L7 9H3zM14 3l7 7-1.4 1.4L16 7.8V16h-2V8.6L9.4 4 11 2.4 14 3z"/>'; }
        else if (p < 0.5) { volIcon.innerHTML = '<path d="M3 9v6h4l5 5V4L7 9H3zM14 9v6c1.7-0.7 3-2.4 3-4.5S15.7 9.7 14 9z"/>'; }
        else { volIcon.innerHTML = '<path d="M3 9v6h4l5 5V4L7 9H3zM14 7v10c3-1 5-3.6 5-7s-2-6-5-7z"/>'; }
      }
      volEl.addEventListener('mousedown', stopWrap((e) => { isDraggingVolume = true; handleVolumeInput(e.clientX); }));
      document.addEventListener('mousemove', (e) => { if (isDraggingVolume) { e.preventDefault(); handleVolumeInput(e.clientX); } });
      document.addEventListener('mouseup', () => { isDraggingVolume = false; });
      volEl.addEventListener('touchstart', (e) => { e.stopPropagation(); e.preventDefault(); isDraggingVolume = true; handleVolumeInput(getTouchX(e)); }, { passive:false });
      document.addEventListener('touchmove', (e) => { if (isDraggingVolume) { e.preventDefault(); handleVolumeInput(getTouchX(e)); } }, { passive:false });
      document.addEventListener('touchend', () => { isDraggingVolume = false; }, { passive:false });

      /* ç®€æ˜“æ’­æ”¾åˆ—è¡¨å¼€å…³ï¼ˆç¤ºä¾‹ï¼‰ */
      listBtn.addEventListener('click', stopWrap(() => {
        playlistPanel.style.display = playlistPanel.style.display === 'block' ? 'none' : 'block';
      }));

      /* æä¾›ç»™ HTML çš„æ’­æ”¾åˆ—è¡¨åˆ‡æ¢ */
      window.playIndex = function(index){ currentIndex = index; loadTrack(currentIndex); playTrack(); }

      /* åˆå§‹åŒ–ç¬¬ä¸€é¦– */
      loadTrack(currentIndex);
    })();
    </script>

      <!-- ç¤¾åŒºé¡µäº¤äº’è„šæœ¬ï¼ˆFeedã€è§†å›¾åˆ‡æ¢ã€ç­›é€‰ï¼‰ -->
      <script>
      (function(){
        // ç®€å• mock æ•°æ®ï¼Œå¯æ›¿æ¢ä¸ºåç«¯ API è¯·æ±‚
        const sampleGroups = [
          { id:1, name:'è‹±è¯­å£è¯­ç»ƒä¹ ç¾¤', desc:'å£è¯­ç»ƒä¹ ä¸èµ„æºåˆ†äº«', members:128, category:'å­¦ä¹ ', inviteCode:'ORAL2024' },
          { id:2, name:'æ‰˜ç¦å¤‡è€ƒç¾¤', desc:'æ¯å¤©æ—©èµ·ä¸€èµ·å­¦ä¹ ', members:64, category:'å…¶ä»–', inviteCode:'TOEFL888' },
          { id:3, name:'å•†åŠ¡è‹±è¯­äº¤æµ', desc:'é•¿ç¯‡ææ–™è®¨è®º', members:32, category:'groups', inviteCode:'BIZ12345' },
          { id:4, name:'è‹±æ–‡åŸç‰ˆé˜…è¯»', desc:'ä¸€èµ·è¯»è‹±æ–‡åŸç‰ˆä¹¦ç±', members:56, category:'å­¦ä¹ ', inviteCode:'BOOK2024' }
        ];
        // expose for other scripts/pages
        window.sampleGroups = sampleGroups;

        // å·²åŠ å…¥çš„ç¾¤ç»„IDï¼ˆæ¯æ¬¡åˆ·æ–°æ¢å¤åˆå§‹çŠ¶æ€ï¼‰
        const myJoinedGroupIds = new Set([1, 2, 3]);
        
        // Save joined groups (å½“å‰ä¼šè¯æœ‰æ•ˆ)
        function saveJoinedGroups(){
          // ä¸å†ä¿å­˜åˆ°localStorageï¼Œåˆ·æ–°å³æ¢å¤åˆå§‹çŠ¶æ€
        }

        // ========== åˆ é™¤ç¾¤ç»„ç¡®è®¤å¼¹çª— ==========
        const deleteConfirmModal = document.getElementById('deleteConfirmModal');
        const deleteGroupNameEl = document.getElementById('deleteGroupName');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        let pendingDeleteGroupId = null;
        
        function showDeleteConfirm(groupId, groupName){
          pendingDeleteGroupId = groupId;
          deleteGroupNameEl.textContent = groupName;
          // å¦‚æœæ˜¯è‡ªå·±åˆ›å»ºçš„ç¾¤ï¼ˆid > 4ï¼‰ï¼Œæ˜¾ç¤º"è§£æ•£ç¾¤ç»„"ï¼Œå¦åˆ™æ˜¾ç¤º"é€€å‡ºç¾¤ç»„"
          const isMyGroup = groupId > 4;
          document.querySelector('.confirm-title').textContent = isMyGroup ? 'ç¡®è®¤è§£æ•£ç¾¤ç»„' : 'ç¡®è®¤é€€å‡ºç¾¤ç»„';
          document.getElementById('confirmDeleteBtn').textContent = isMyGroup ? 'ç¡®è®¤è§£æ•£' : 'ç¡®è®¤é€€å‡º';
          deleteConfirmModal.classList.add('show');
        }
        
        function hideDeleteConfirm(){
          deleteConfirmModal.classList.remove('show');
          pendingDeleteGroupId = null;
        }
        
        cancelDeleteBtn.addEventListener('click', hideDeleteConfirm);
        deleteConfirmModal.addEventListener('click', (e)=>{
          if(e.target === deleteConfirmModal) hideDeleteConfirm();
        });
        
        confirmDeleteBtn.addEventListener('click', ()=>{
          if(pendingDeleteGroupId !== null){
            // ä»å·²åŠ å…¥åˆ—è¡¨ç§»é™¤
            myJoinedGroupIds.delete(pendingDeleteGroupId);
            
            // å¦‚æœæ˜¯è‡ªå·±åˆ›å»ºçš„ç¾¤ï¼ˆid > 4ï¼‰ï¼Œä»ç¾¤ç»„åˆ—è¡¨ä¸­ä¹Ÿåˆ é™¤
            if(pendingDeleteGroupId > 4){
              const idx = sampleGroups.findIndex(g => g.id === pendingDeleteGroupId);
              if(idx !== -1){
                sampleGroups.splice(idx, 1);
              }
            }
            
            saveJoinedGroups();
            renderJoinedGroups();
            hideDeleteConfirm();
          }
        });

        // Render joined groups in left sidebar
        function renderJoinedGroups(){
          const container = document.getElementById('joinedGroupsList');
          if(!container) return;
          const joined = sampleGroups.filter(g => myJoinedGroupIds.has(g.id));
          container.innerHTML = joined.map(g => `
            <div class="joined-group-item" data-id="${g.id}">
              <div class="jg-avatar">${escapeHtml((g.name||'').slice(0,1))}</div>
              <div class="jg-info">
                <div class="jg-name">${escapeHtml(g.name)}</div>
                <div class="jg-members">${g.members}äºº</div>
              </div>
              <button class="jg-delete-btn" data-id="${g.id}" data-name="${escapeHtml(g.name)}" title="é€€å‡ºç¾¤ç»„"><i class="fas fa-times"></i></button>
            </div>
          `).join('');
          // click to navigate
          container.querySelectorAll('.joined-group-item').forEach(el => {
            el.addEventListener('click', (e)=>{
              if(e.target.closest('.jg-delete-btn')) return; // ä¸è§¦å‘å¯¼èˆª
              window.location.href = `channel2.html?groupId=${el.dataset.id}`;
            });
          });
          // delete button handler
          container.querySelectorAll('.jg-delete-btn').forEach(btn => {
            btn.addEventListener('click', (e)=>{
              e.stopPropagation();
              const id = parseInt(btn.dataset.id);
              const name = btn.dataset.name;
              showDeleteConfirm(id, name);
            });
          });
        }

        const samplePosts = [
          { id:1, author:'å°æ˜', avatar:'M', text:'åˆšå®Œæˆä¸€èŠ‚å‘éŸ³ç»ƒä¹ ï¼Œæ”¶è·é¢‡ä¸°ï¼ä»Šå¤©ç»ˆäºæŒæ¡äº† th çš„å‘éŸ³æŠ€å·§ï¼Œæ„Ÿè§‰è‡ªå·±åˆè¿›æ­¥äº†ä¸€ç‚¹ç‚¹~ ğŸ‰ #è‹±è¯­å­¦ä¹ #', likes:24, time:'10åˆ†é’Ÿå‰', tags:['è‹±è¯­å­¦ä¹ '],
            comments:[
              { id:101, author:'å°çº¢', avatar:'H', text:'åŠ æ²¹ï¼thçš„å‘éŸ³ç¡®å®å¾ˆéš¾ï¼Œæˆ‘ä¹Ÿç»ƒäº†å¾ˆä¹…', time:'8åˆ†é’Ÿå‰', likes:3 },
              { id:102, author:'è‹±è¯­è¾¾äºº', avatar:'E', text:'å¯ä»¥è¯•è¯•æŠŠèˆŒå¤´æ”¾åœ¨ç‰™é½¿ä¹‹é—´ï¼Œç„¶åè½»è½»å¹æ°”ï¼Œæ•ˆæœä¼šæ›´å¥½', time:'6åˆ†é’Ÿå‰', likes:8, replies:[
                { id:1021, author:'å°æ˜', avatar:'M', text:'è°¢è°¢å¤§ç¥æŒ‡ç‚¹ï¼æˆ‘è¯•è¯•çœ‹', time:'4åˆ†é’Ÿå‰', likes:2 },
                { id:1022, author:'å°çº¢', avatar:'H', text:'è¿™ä¸ªæŠ€å·§æˆ‘ä¹Ÿå­¦åˆ°äº†ï¼', time:'3åˆ†é’Ÿå‰', likes:1 }
              ]},
              { id:103, author:'å‘éŸ³æ•™ç»ƒ', avatar:'F', text:'thæœ‰ä¸¤ç§å‘éŸ³ï¼šæ¸…è¾…éŸ³/Î¸/å’ŒæµŠè¾…éŸ³/Ã°/ï¼Œè¦æ³¨æ„åŒºåˆ†å“¦', time:'2åˆ†é’Ÿå‰', likes:15 }
            ]
          },
          { id:2, author:'å°çº¢', avatar:'H', text:'å‘¨æœ«ç»„ç»‡çº¿ä¸Šåˆ†äº«ä¼šï¼Œä¸»é¢˜æ˜¯ã€Šå¦‚ä½•æå‡è‹±è¯­å¬åŠ›ã€‹ï¼Œæ¬¢è¿å¤§å®¶å‚åŠ ï¼æ—¶é—´ï¼šå‘¨å…­æ™š8ç‚¹ï¼Œè…¾è®¯ä¼šè®®ã€‚ #è‹±è¯­å­¦ä¹ #', likes:42, time:'1å°æ—¶å‰', tags:['è‹±è¯­å­¦ä¹ '],
            comments:[
              { id:201, author:'å­¦éœ¸å°å§', avatar:'X', text:'å·²æŠ¥åï¼æœŸå¾…å‘¨å…­çš„åˆ†äº«', time:'50åˆ†é’Ÿå‰', likes:5 },
              { id:202, author:'å°å', avatar:'H', text:'ä¼šè®®å·æ˜¯å¤šå°‘ï¼Ÿ', time:'45åˆ†é’Ÿå‰', likes:2, replies:[
                { id:2021, author:'å°çº¢', avatar:'H', text:'ä¼šè®®å·ï¼š888-666-999ï¼Œå‘¨å…­è§~', time:'40åˆ†é’Ÿå‰', likes:3 }
              ]},
              { id:203, author:'æ—©èµ·é¸Ÿ', avatar:'Z', text:'å¤ªæ£’äº†ï¼Œæ­£å¥½éœ€è¦æå‡å¬åŠ›ï¼å·²åŠ æ—¥å†æé†’', time:'30åˆ†é’Ÿå‰', likes:3 },
              { id:204, author:'è‹±è¯­è¾¾äºº', avatar:'E', text:'å¬åŠ›æå‡æœ€é‡è¦çš„æ˜¯ç²¾å¬+æ³›å¬ç»“åˆ', time:'20åˆ†é’Ÿå‰', likes:12, replies:[
                { id:2041, author:'å°çº¢', avatar:'H', text:'å¯¹ï¼è¿™æ¬¡åˆ†äº«ä¼šä¹Ÿä¼šè®²åˆ°è¿™ä¸ªæ–¹æ³•', time:'15åˆ†é’Ÿå‰', likes:2 }
              ]},
              { id:205, author:'æ‰˜ç¦æˆ˜å‹', avatar:'T', text:'èƒ½å½•å±å—ï¼Ÿå‘¨å…­å¯èƒ½æœ‰äº‹', time:'10åˆ†é’Ÿå‰', likes:4 }
            ]
          },
          { id:3, author:'è‹±è¯­è¾¾äºº', avatar:'E', text:'ä»Šæ—¥å•è¯æ‰“å¡ Day 45 âœ…\n\ntranscend - è¶…è¶Šï¼Œèƒœè¿‡\nperseverance - åšæŒä¸æ‡ˆ\nresilience - éŸ§æ€§ï¼Œæ¢å¤åŠ›\n\næ¯å¤©ç§¯ç´¯ï¼Œå¿…æœ‰æ‰€æˆï¼åŠ æ²¹åŠ æ²¹ ğŸ’ª #æ‰“å¡æŒ‘æˆ˜# #æ¯æ—¥ä¸€å¥#', likes:89, time:'2å°æ—¶å‰', tags:['æ‰“å¡æŒ‘æˆ˜','æ¯æ—¥ä¸€å¥'],
            comments:[
              { id:301, author:'å°æ˜', avatar:'M', text:'è·Ÿç€æ‰“å¡ï¼perseverance è¿™ä¸ªè¯å¾ˆæ£’ï¼Œæˆ‘è¦ç”¨åˆ°ä½œæ–‡é‡Œ', time:'1å°æ—¶50åˆ†é’Ÿå‰', likes:12 },
              { id:302, author:'å•†åŠ¡ç²¾è‹±', avatar:'S', text:'resilience åœ¨å•†åŠ¡åœºæ™¯é‡Œç»å¸¸ç”¨åˆ°ï¼æ¯”å¦‚ organizational resilience', time:'1å°æ—¶40åˆ†é’Ÿå‰', likes:6, replies:[
                { id:3021, author:'è‹±è¯­è¾¾äºº', avatar:'E', text:'æ²¡é”™ï¼è¿˜æœ‰ financial resilience ä¹Ÿå¾ˆå¸¸è§', time:'1å°æ—¶30åˆ†é’Ÿå‰', likes:4 }
              ]},
              { id:303, author:'å•è¯ç‹‚äºº', avatar:'D', text:'Day 45ï¼å¤ªå‰å®³äº†ï¼Œæˆ‘æ‰åšæŒåˆ°Day 7å°±æ”¾å¼ƒäº†ğŸ˜­', time:'1å°æ—¶å‰', likes:8, replies:[
                { id:3031, author:'è‹±è¯­è¾¾äºº', avatar:'E', text:'æ²¡å…³ç³»ï¼Œé‡æ–°å¼€å§‹å°±å¥½ï¼å…³é”®æ˜¯æ‰¾åˆ°é€‚åˆè‡ªå·±çš„èŠ‚å¥', time:'50åˆ†é’Ÿå‰', likes:15 },
                { id:3032, author:'å°çº¢', avatar:'H', text:'å¯ä»¥åŠ å…¥æˆ‘ä»¬çš„æ‰“å¡ç¾¤ï¼Œäº’ç›¸ç›‘ç£', time:'40åˆ†é’Ÿå‰', likes:6 }
              ]},
              { id:304, author:'å­¦éœ¸å°å§', avatar:'X', text:'è¿™ä¸‰ä¸ªè¯éƒ½æ˜¯æ‰˜ç¦é«˜é¢‘è¯ï¼æ”¶è—äº†', time:'30åˆ†é’Ÿå‰', likes:10 }
            ]
          },
          { id:4, author:'å°å', avatar:'H', text:'åˆ†äº«ä¸€ä¸ªå­¦ä¹ è‹±è¯­çš„å°æŠ€å·§ï¼šçœ‹ç¾å‰§çš„æ—¶å€™å…ˆå…³å­—å¹•çœ‹ä¸€éï¼Œç„¶åå¼€è‹±æ–‡å­—å¹•å†çœ‹ä¸€éï¼Œæœ€åå¼€ä¸­æ–‡å­—å¹•æ ¸å¯¹ã€‚è¿™æ ·å¯ä»¥å¤§å¤§æå‡å¬åŠ›ï¼ #è‹±è¯­å­¦ä¹ #', likes:156, time:'3å°æ—¶å‰', tags:['è‹±è¯­å­¦ä¹ '],
            comments:[
              { id:401, author:'å°çº¢', avatar:'H', text:'è¿™ä¸ªæ–¹æ³•å¤ªå®ç”¨äº†ï¼æ”¶è—äº†ğŸ“Œ', time:'2å°æ—¶50åˆ†é’Ÿå‰', likes:15 },
              { id:402, author:'è‹±è¯­è¾¾äºº', avatar:'E', text:'æ¨èçœ‹ã€ŠFriendsã€‹ï¼Œå¯¹è¯ç®€å•åˆåœ°é“ï¼Œè€Œä¸”å¾ˆæç¬‘', time:'2å°æ—¶40åˆ†é’Ÿå‰', likes:22, replies:[
                { id:4021, author:'å°å', avatar:'H', text:'æ­£åœ¨çœ‹ï¼ç¡®å®å¾ˆé€‚åˆå­¦è‹±è¯­ï¼ŒRosså¤ªæç¬‘äº†', time:'2å°æ—¶30åˆ†é’Ÿå‰', likes:3 },
                { id:4022, author:'ç¾å‰§è¿·', avatar:'M', text:'è¿˜æ¨èã€ŠModern Familyã€‹ï¼Œæ—¥å¸¸å¯¹è¯è¶…å¤š', time:'2å°æ—¶å‰', likes:8 }
              ]},
              { id:403, author:'æ–°æ‰‹å°ç™½', avatar:'X', text:'è¯·é—®ä¸€é›†è¦çœ‹ä¸‰éå—ï¼Ÿæ„Ÿè§‰å¥½èŠ±æ—¶é—´', time:'1å°æ—¶å‰', likes:5, replies:[
                { id:4031, author:'å°å', avatar:'H', text:'ä¸ç”¨æ¯é›†éƒ½è¿™æ ·ï¼Œé€‰å‡ é›†ç²¾çœ‹å°±å¥½ï¼Œå…¶ä»–æ³›å¬', time:'50åˆ†é’Ÿå‰', likes:12 }
              ]},
              { id:404, author:'å¬åŠ›å¼±é¸¡', avatar:'T', text:'å…³å­—å¹•å®Œå…¨å¬ä¸æ‡‚æ€ä¹ˆåŠğŸ˜¢', time:'30åˆ†é’Ÿå‰', likes:7, replies:[
                { id:4041, author:'è‹±è¯­è¾¾äºº', avatar:'E', text:'å¯ä»¥å…ˆå¼€è‹±æ–‡å­—å¹•ï¼Œæ…¢æ…¢è¿‡æ¸¡åˆ°å…³å­—å¹•', time:'20åˆ†é’Ÿå‰', likes:9 },
                { id:4042, author:'å°å', avatar:'H', text:'é€‰ç®€å•çš„å‰§å¼€å§‹ï¼Œæ¯”å¦‚åŠ¨ç”»ç‰‡', time:'10åˆ†é’Ÿå‰', likes:4 }
              ]}
            ]
          },
          { id:5, author:'å­¦éœ¸å°å§', avatar:'X', text:'æ‰˜ç¦å¤‡è€ƒç¬¬30å¤©ï¼Œä»Šå¤©åšäº†ä¸¤å¥—å¬åŠ›çœŸé¢˜ï¼Œæ­£ç¡®ç‡ç»ˆäºçªç ´25é¢˜äº†ï¼ğŸ‰ æ„Ÿè°¢ç¾¤é‡Œå¤§å®¶çš„é¼“åŠ±ï¼Œç»§ç»­åŠ æ²¹ï¼ #æ‰“å¡æŒ‘æˆ˜# #è‹±è¯­å­¦ä¹ #', likes:67, time:'5å°æ—¶å‰', tags:['æ‰“å¡æŒ‘æˆ˜','è‹±è¯­å­¦ä¹ '],
            comments:[
              { id:501, author:'å°æ˜', avatar:'M', text:'å‰å®³ï¼æ±‚åˆ†äº«å­¦ä¹ æ–¹æ³•', time:'4å°æ—¶å‰', likes:8, replies:[
                { id:5011, author:'å­¦éœ¸å°å§', avatar:'X', text:'ä¸»è¦æ˜¯æ¯å¤©åšæŒåšTPOï¼Œé”™é¢˜åå¤å¬3éä»¥ä¸Š', time:'3å°æ—¶å‰', likes:12 }
              ]},
              { id:502, author:'è‹±è¯­è¾¾äºº', avatar:'E', text:'25é¢˜å·²ç»å¾ˆæ£’äº†ï¼Œç»§ç»­ä¿æŒï¼', time:'3å°æ—¶å‰', likes:6 },
              { id:503, author:'æ‰˜ç¦æˆ˜å‹', avatar:'T', text:'æˆ‘ä¹Ÿåœ¨å¤‡è€ƒï¼Œäº’ç›¸é¼“åŠ±ï¼ä½ ç”¨çš„ä»€ä¹ˆèµ„æ–™ï¼Ÿ', time:'2å°æ—¶å‰', likes:4, replies:[
                { id:5031, author:'å­¦éœ¸å°å§', avatar:'X', text:'TPO + è€ƒæ»¡åˆ†çš„ç²¾å¬ï¼Œæ•ˆæœä¸é”™', time:'1å°æ—¶å‰', likes:7 }
              ]}
            ]
          },
          { id:6, author:'å•†åŠ¡ç²¾è‹±', avatar:'S', text:'ä»Šå¤©çš„å•†åŠ¡è‹±è¯­è¯¾ç¨‹å¾ˆæ£’ï¼å­¦ä¹ äº†æ€ä¹ˆå†™ä¸“ä¸šçš„è‹±æ–‡é‚®ä»¶ï¼Œè€å¸ˆè¯´çš„å‡ ä¸ªå¼€å¤´ç»“å°¾çš„æ¨¡æ¿å¾ˆå®ç”¨ï¼å·²ç»æ•´ç†æˆç¬”è®°ï¼Œéœ€è¦çš„åŒå­¦ç§ä¿¡æˆ‘~ #è‹±è¯­å­¦ä¹ #', likes:45, time:'æ˜¨å¤© 22:30', tags:['è‹±è¯­å­¦ä¹ '],
            comments:[
              { id:601, author:'èŒåœºæ–°äºº', avatar:'Z', text:'æ±‚ç¬”è®°ï¼ç§ä¿¡ä½ äº†', time:'æ˜¨å¤© 22:45', likes:3 },
              { id:602, author:'å°çº¢', avatar:'H', text:'æˆ‘ä¹Ÿæƒ³è¦ï¼å•†åŠ¡é‚®ä»¶çœŸçš„å¾ˆé‡è¦', time:'æ˜¨å¤© 23:00', likes:5 },
              { id:603, author:'å¤–ä¼å‘˜å·¥', avatar:'W', text:'è¡¥å……ä¸€ä¸ªæŠ€å·§ï¼šå¼€å¤´ç”¨ I hope this email finds you well å¾ˆåŠ åˆ†', time:'ä»Šå¤© 08:00', likes:18, replies:[
                { id:6031, author:'å•†åŠ¡ç²¾è‹±', avatar:'S', text:'å¯¹å¯¹ï¼è€å¸ˆä¹Ÿæåˆ°äº†è¿™ä¸ª', time:'ä»Šå¤© 09:00', likes:2 },
                { id:6032, author:'å°æ˜', avatar:'M', text:'å­¦åˆ°äº†ï¼Œé©¬ä¸Šç”¨èµ·æ¥', time:'ä»Šå¤© 10:00', likes:1 }
              ]}
            ]
          },
          { id:7, author:'æ—©èµ·é¸Ÿ', avatar:'Z', text:'æ—©å®‰ï¼â˜€ï¸ è¿ç»­æ—©èµ·æ‰“å¡ç¬¬21å¤© âœ…\nä»Šæ—¥å­¦ä¹ è®¡åˆ’ï¼š\nâœ… èƒŒ50ä¸ªå•è¯\nâ¬œ å¬åŠ›ç»ƒä¹ 1å°æ—¶\nâ¬œ å£è¯­è·Ÿè¯»30åˆ†é’Ÿ\n\nä¸€èµ·åŠ æ²¹å§ï¼ #æ‰“å¡æŒ‘æˆ˜#', likes:38, time:'ä»Šå¤© 06:30', tags:['æ‰“å¡æŒ‘æˆ˜'],
            comments:[
              { id:701, author:'å°æ˜', avatar:'M', text:'æ—©å®‰ï¼ä¸€èµ·åŠ æ²¹ğŸ’ª', time:'ä»Šå¤© 06:35', likes:5 },
              { id:702, author:'å­¦éœ¸å°å§', avatar:'X', text:'è¶…è‡ªå¾‹ï¼å‘ä½ å­¦ä¹ ', time:'ä»Šå¤© 07:00', likes:4 },
              { id:703, author:'å¤œçŒ«å­', avatar:'Y', text:'æˆ‘åˆšç¡ä¸‹ä½ å°±èµ·æ¥äº†ğŸ˜‚ä½©æœä½©æœ', time:'ä»Šå¤© 06:40', likes:15, replies:[
                { id:7031, author:'æ—©èµ·é¸Ÿ', avatar:'Z', text:'å“ˆå“ˆæ—©ç¡æ—©èµ·èº«ä½“å¥½~', time:'ä»Šå¤© 06:45', likes:3 }
              ]},
              { id:704, author:'è‹±è¯­è¾¾äºº', avatar:'E', text:'21å¤©ä¹ æƒ¯å…»æˆï¼å‰å®³ğŸ‘', time:'ä»Šå¤© 07:30', likes:8 }
            ]
          }
        ];

        const groupsGrid = document.getElementById('groupsGrid');
        const postsList = document.getElementById('postsList');
        const feedPanel = document.getElementById('feedPanel');
        const groupsPanel = document.getElementById('groupsPanel');
        const viewBtns = document.querySelectorAll('.view-btn');
        const filterChips = document.querySelectorAll('.chip');
        const composerInput = document.getElementById('composerInput');
        
        const tabChips = document.querySelectorAll('.tab-chip');

        function escapeHtml(str){
          return String(str).replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[m]; });
        }

        function renderGroups(list){
          groupsGrid.innerHTML = '';
          list.forEach(g=>{
            const isJoined = myJoinedGroupIds.has(g.id);
            const el = document.createElement('div'); el.className='group-item';
            el.setAttribute('data-group-id', g.id);
            el.innerHTML = `<div class="group-info"><h3>${escapeHtml(g.name)}</h3><p>${escapeHtml(g.desc)}</p></div><div class="group-buttons"><span class="members-count">å·²åŠ å…¥${g.members}äºº</span><button class="join-btn" data-id="${g.id}" ${isJoined ? 'disabled' : ''}>${isJoined ? 'å·²åŠ å…¥' : 'åŠ å…¥'}</button><span class="invite-code" title="ç‚¹å‡»å¤åˆ¶" style="cursor:pointer;">é‚€è¯·ç ï¼š${g.inviteCode || 'N/A'}</span></div>`;
            // clicking the group navigates to the chat/detail page for that group
            el.querySelector('.group-info').addEventListener('click', ()=>{
              window.location.href = `channel2.html?groupId=${encodeURIComponent(g.id)}`;
            });
            // click invite code to copy
            el.querySelector('.invite-code').addEventListener('click', (e)=>{
              e.stopPropagation();
              if(g.inviteCode){
                navigator.clipboard.writeText(g.inviteCode).then(()=>{
                  alert(`é‚€è¯·ç  ${g.inviteCode} å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼`);
                });
              }
            });
            groupsGrid.appendChild(el);
          });
        }

        // Tab switching: Feed vs Groups vs Activity
        const feedSortSelect = document.getElementById('feedSortSelect');
        const groupSortSelect = document.getElementById('groupSortSelect');
        const activityPanel = document.getElementById('activityPanel');
        const sortLabel = document.querySelector('.sort-label');
        
        tabChips.forEach(chip => {
          chip.addEventListener('click', ()=>{
            tabChips.forEach(c => c.classList.remove('active'));
            chip.classList.add('active');
            const tab = chip.dataset.tab;
            if(tab === 'feed') {
              feedPanel.style.display = 'block';
              groupsPanel.style.display = 'none';
              activityPanel.style.display = 'none';
              feedSortSelect.style.display = 'inline-block';
              groupSortSelect.style.display = 'none';
              sortLabel.style.display = 'inline';
            } else if(tab === 'groups') {
              feedPanel.style.display = 'none';
              groupsPanel.style.display = 'block';
              activityPanel.style.display = 'none';
              feedSortSelect.style.display = 'none';
              groupSortSelect.style.display = 'inline-block';
              sortLabel.style.display = 'inline';
              renderGroups(sampleGroups);
            } else if(tab === 'activity') {
              feedPanel.style.display = 'none';
              groupsPanel.style.display = 'none';
              activityPanel.style.display = 'block';
              feedSortSelect.style.display = 'none';
              groupSortSelect.style.display = 'none';
              sortLabel.style.display = 'none';
            }
          });
        });

        // initial render
        renderJoinedGroups();

        // Helper to render hashtags
        function renderTextWithTags(text){
          return escapeHtml(text).replace(/#([^#\s]+)#/g, '<span class="hashtag">#$1#</span>').replace(/\n/g, '<br>');
        }

        // Helper to render comment text with @mentions highlighted
        function renderCommentText(text){
          return escapeHtml(text).replace(/@(\S+)/g, '<span class="mention">@$1</span>');
        }

        // Render a reply item (smaller style)
        function renderReplyItem(r, postId, parentCommentId){
          return `
            <div class="reply-item" data-comment-id="${r.id}">
              <div class="comment-avatar">${escapeHtml(r.avatar || r.author.slice(0,1))}</div>
              <div class="comment-content">
                <div class="comment-header">
                  <span class="comment-author">${escapeHtml(r.author)}</span>
                  <span class="comment-time">${escapeHtml(r.time)}</span>
                </div>
                <div class="comment-text">${renderCommentText(r.text)}</div>
                <div class="comment-actions">
                  <button class="comment-like-btn" data-id="${r.id}"><i class="far fa-heart"></i> ${r.likes || 0}</button>
                  <button class="reply-btn" data-post-id="${postId}" data-parent-id="${parentCommentId}" data-reply-to="${r.author}">å›å¤</button>
                </div>
              </div>
            </div>
          `;
        }

        // Render main comment with nested replies (Bç«™/å¾®åš style)
        function renderComment(c, postId){
          const replies = c.replies || [];
          const hasReplies = replies.length > 0;
          
          return `
            <div class="comment-item" data-comment-id="${c.id}">
              <div class="comment-avatar">${escapeHtml(c.avatar || c.author.slice(0,1))}</div>
              <div class="comment-content">
                <div class="comment-header">
                  <span class="comment-author">${escapeHtml(c.author)}</span>
                  <span class="comment-time">${escapeHtml(c.time)}</span>
                </div>
                <div class="comment-text">${renderCommentText(c.text)}</div>
                <div class="comment-actions">
                  <button class="comment-like-btn" data-id="${c.id}"><i class="far fa-heart"></i> ${c.likes || 0}</button>
                  <button class="reply-btn" data-post-id="${postId}" data-parent-id="${c.id}" data-reply-to="${c.author}">å›å¤</button>
                </div>
                ${hasReplies ? `
                  <div class="replies-wrapper">
                    <div class="replies-list">
                      ${replies.map(r => renderReplyItem(r, postId, c.id)).join('')}
                    </div>
                  </div>
                ` : ''}
              </div>
            </div>
          `;
        }

        function renderPosts(list){
          postsList.innerHTML = '';
          list.forEach(p=>{
            const node = document.createElement('div'); node.className='post-card'; node.dataset.postId = p.id;
            const avatarLetter = escapeHtml(p.avatar || (p.author||'').slice(0,1));
            const commentsArr = p.comments || [];
            const commentCount = commentsArr.length + commentsArr.reduce((sum, c) => sum + (c.replies?.length || 0), 0);
            
            node.innerHTML = `
              <div class="post-header">
                <div class="avatar">${avatarLetter}</div>
                <div class="post-author">
                  <div class="author-name">${escapeHtml(p.author)}</div>
                  <div class="post-time">${escapeHtml(p.time)}</div>
                </div>
              </div>
              <div class="post-body">${renderTextWithTags(p.text)}</div>
              ${p.images&&p.images.length?`<div class="post-images">${p.images.map(src=>`<img src="${src}" alt="image">`).join('')}</div>`:''}
              <div class="post-actions">
                <button class="action-btn like-btn" data-id="${p.id}"><i class="far fa-heart"></i> <span class="like-count">${p.likes}</span></button>
                <button class="action-btn comment-toggle-btn" data-id="${p.id}"><i class="far fa-comment"></i> <span class="comment-count">${commentCount}</span></button>
                <button class="action-btn share-btn"><i class="far fa-share-square"></i> è½¬å‘</button>
              </div>
              <div class="comments-section" id="comments-${p.id}" style="display:none;">
                <div class="comments-list">
                  ${commentsArr.map(c => renderComment(c, p.id)).join('')}
                </div>
                <div class="comment-composer">
                  <input type="text" class="comment-input" placeholder="å†™è¯„è®º..." data-post-id="${p.id}" />
                  <button class="comment-submit-btn" data-post-id="${p.id}">å‘é€</button>
                </div>
              </div>
            `;
            postsList.appendChild(node);
          });
          
          // Bind comment toggle
          document.querySelectorAll('.comment-toggle-btn').forEach(btn => {
            btn.addEventListener('click', ()=>{
              const postId = btn.dataset.id;
              const section = document.getElementById('comments-' + postId);
              if(section){
                section.style.display = section.style.display === 'none' ? 'block' : 'none';
              }
            });
          });
          
          // Track which comment we're replying to
          let replyingToCommentId = null;
          
          // Bind comment submit
          document.querySelectorAll('.comment-submit-btn').forEach(btn => {
            btn.addEventListener('click', ()=>{
              const postId = btn.dataset.postId;
              const input = document.querySelector(`.comment-input[data-post-id="${postId}"]`);
              let text = input.value.trim();
              if(!text) return;
              
              // Find the post
              const post = samplePosts.find(p => p.id == postId);
              if(!post) return;
              if(!post.comments) post.comments = [];
              
              const newComment = {
                id: Date.now(),
                author: 'æˆ‘',
                avatar: 'W',
                text: text,
                time: 'åˆšåˆš',
                likes: 0
              };
              
              // Check if replying to someone (text starts with @username)
              const replyMatch = text.match(/^@(\S+)\s*/);
              if(replyMatch && replyingToCommentId){
                // Find the parent comment and add as reply
                const parentComment = post.comments.find(c => c.id == replyingToCommentId);
                if(parentComment){
                  if(!parentComment.replies) parentComment.replies = [];
                  parentComment.replies.push(newComment);
                } else {
                  // Fallback: add as top-level comment
                  post.comments.push(newComment);
                }
              } else {
                // Add as top-level comment
                post.comments.push(newComment);
              }
              
              // Reset reply state
              replyingToCommentId = null;
              
              renderPosts(samplePosts);
              // Re-open the comments section
              setTimeout(()=>{
                const section = document.getElementById('comments-' + postId);
                if(section) section.style.display = 'block';
              }, 0);
            });
          });
          
          // Bind reply buttons
          document.querySelectorAll('.reply-btn').forEach(btn => {
            btn.addEventListener('click', ()=>{
              const postId = btn.dataset.postId;
              const replyTo = btn.dataset.replyTo;
              const parentId = btn.dataset.parentId; // ä¸»è¯„è®ºçš„ID
              const input = document.querySelector(`.comment-input[data-post-id="${postId}"]`);
              if(input){
                input.value = `@${replyTo} `;
                input.focus();
                replyingToCommentId = parentId; // è®°å½•ä¸»è¯„è®ºID
              }
            });
          });
          
          // Bind post like buttons
          document.querySelectorAll('.post-card .like-btn').forEach(btn => {
            btn.addEventListener('click', (e)=>{
              e.stopPropagation();
              const id = parseInt(btn.dataset.id);
              const post = samplePosts.find(p => p.id === id);
              if(!post) return;
              
              // Toggle like state
              if(btn.classList.contains('liked')){
                post.likes = Math.max(0, (post.likes || 1) - 1);
                btn.classList.remove('liked');
              } else {
                post.likes = (post.likes || 0) + 1;
                btn.classList.add('liked');
              }
              const countEl = btn.querySelector('.like-count');
              if(countEl) countEl.textContent = post.likes;
            });
          });
          
          // Bind comment like buttons
          document.querySelectorAll('.comment-like-btn').forEach(btn => {
            btn.addEventListener('click', (e)=>{
              e.stopPropagation();
              btn.classList.toggle('liked');
              // Simple visual toggle for demo
              const currentText = btn.textContent.trim();
              const num = parseInt(currentText.match(/\d+/)?.[0] || '0');
              if(btn.classList.contains('liked')){
                btn.innerHTML = `<i class="fas fa-heart"></i> ${num + 1}`;
              } else {
                btn.innerHTML = `<i class="far fa-heart"></i> ${Math.max(0, num - 1)}`;
              }
            });
          });
        }

        // Initial render
        renderJoinedGroups();
        renderPosts(samplePosts);

        // Composer: image preview and post creation
        const postBtn = document.getElementById('postBtn');
        const attachBtnEl = document.getElementById('attachBtn');
        const composerFilesEl = document.getElementById('composerFiles');
        const previewAreaEl = document.getElementById('previewArea');

        attachBtnEl.addEventListener('click', ()=> composerFilesEl.click());
        // manage selected files manually so we can remove thumbnails
        let composerSelectedFiles = [];
        composerFilesEl.addEventListener('change', (e)=>{
          const files = Array.from(e.target.files || []);
          // append new files to the selection
          composerSelectedFiles = composerSelectedFiles.concat(files);
          renderComposerPreviews();
        });

        function renderComposerPreviews(){
          previewAreaEl.innerHTML = '';
          composerSelectedFiles.forEach((f, idx)=>{
            const reader = new FileReader();
            const wrap = document.createElement('div'); wrap.style.display='inline-block'; wrap.style.position='relative';
            reader.onload = ev=>{
              const img = document.createElement('img'); img.src = ev.target.result; img.style.maxWidth='120px'; img.style.margin='6px'; img.style.borderRadius='6px';
              wrap.appendChild(img);
              const removeBtn = document.createElement('button'); removeBtn.textContent='Ã—'; removeBtn.style.position='absolute'; removeBtn.style.right='4px'; removeBtn.style.top='4px'; removeBtn.style.background='rgba(0,0,0,0.5)'; removeBtn.style.color='#fff'; removeBtn.style.border='none'; removeBtn.style.borderRadius='50%'; removeBtn.style.width='22px'; removeBtn.style.height='22px'; removeBtn.style.cursor='pointer';
              removeBtn.addEventListener('click',(ev)=>{ ev.stopPropagation(); composerSelectedFiles.splice(idx,1); renderComposerPreviews(); });
              wrap.appendChild(removeBtn);
            };
            reader.readAsDataURL(f);
            previewAreaEl.appendChild(wrap);
          });
        }

        postBtn.addEventListener('click', ()=>{
          const text = composerInput.value.trim();
          const images = [];
          const files = composerSelectedFiles.slice();
          // convert files to data URLs synchronously via FileReader (already previewed)
          const readers = files.map(f=> new Promise(resolve=>{ const r=new FileReader(); r.onload=ev=>resolve(ev.target.result); r.readAsDataURL(f);}));
          Promise.all(readers).then(dataUrls=>{
            const newId = (samplePosts.length? Math.max(...samplePosts.map(p=>p.id))+1:1);
            const now = new Date();
            const post = { id:newId, author:'æˆ‘', avatar:'W', text:text, images:dataUrls, likes:0, comments:[], time: now.toLocaleString(), tags:[] };
            samplePosts.unshift(post);
            composerInput.value = '';
            composerFilesEl.value = '';
            composerSelectedFiles = [];
            previewAreaEl.innerHTML = '';
            renderPosts(samplePosts);
          });
        });

        // Search box filters groups (already bound above via applyGroupFilters)

        // View mode
        function setViewMode(mode){
          document.body.classList.remove('view-card','view-list','view-compact');
          document.body.classList.add('view-'+mode);
          viewBtns.forEach(b=>b.classList.toggle('active', b.getAttribute('data-mode')===mode));
          localStorage.setItem('channelViewMode', mode);
        }
        viewBtns.forEach(b=> b.addEventListener('click', ()=> setViewMode(b.getAttribute('data-mode'))));
        const saved = localStorage.getItem('channelViewMode') || 'card'; setViewMode(saved);

        // Sort - Feed (åŠ¨æ€æ’åºï¼šæœ€æ–°/æœ€çƒ­)
        feedSortSelect.addEventListener('change', ()=>{
          const val = feedSortSelect.value;
          let sorted = [...samplePosts];
          if(val === 'new') {
            // æŒ‰æ—¶é—´æ’åºï¼ˆidè¶Šå¤§è¶Šæ–°ï¼‰
            sorted.sort((a, b) => b.id - a.id);
          } else if(val === 'hot') {
            // æŒ‰çƒ­åº¦æ’åºï¼ˆç‚¹èµ+è¯„è®ºæ•°ï¼‰
            sorted.sort((a, b) => {
              const aHot = (a.likes || 0) + (a.comments?.length || 0);
              const bHot = (b.likes || 0) + (b.comments?.length || 0);
              return bHot - aHot;
            });
          }
          renderPosts(sorted);
        });

        // Sort - Groups (ç¾¤ç»„æ’åºï¼šæ´»è·ƒåº¦/æœ€æ–°/æˆå‘˜æ•°)
        groupSortSelect.addEventListener('change', ()=>{
          const val = groupSortSelect.value;
          let sorted = [...sampleGroups];
          if(val === 'new') sorted.sort((a, b) => b.id - a.id);
          else if(val === 'members') sorted.sort((a, b) => b.members - a.members);
          else if(val === 'active') sorted.sort((a, b) => b.members - a.members);
          renderGroups(sorted);
        });

        // Filter chips (tags) affect groups display
        filterChips.forEach(ch=> ch.addEventListener('click', ()=>{
          ch.classList.toggle('active');
          const active = Array.from(filterChips).filter(c=>c.classList.contains('active')).map(c=>c.getAttribute('data-filter'));
          if(active.length===0) renderGroups(sampleGroups);
          else renderGroups(sampleGroups.filter(g=> active.includes(g.category)));
        }));

        // Join button handler (delegated)
        groupsGrid.addEventListener('click', (e)=>{
          const btn = e.target.closest('.join-btn'); if(!btn) return;
          e.stopPropagation(); // prevent parent group click from firing navigation
          const id = parseInt(btn.getAttribute('data-id'));
          if(!myJoinedGroupIds.has(id)){
            myJoinedGroupIds.add(id);
            saveJoinedGroups(); // persist to localStorage
            renderJoinedGroups(); // refresh left sidebar
          }
          btn.textContent = 'å·²åŠ å…¥'; btn.disabled = true;
        });

        // Join by invite code handler
        const inviteCodeInput = document.getElementById('inviteCodeInput');
        const joinByCodeBtn = document.getElementById('joinByCodeBtn');
        
        joinByCodeBtn.addEventListener('click', ()=>{
          const code = inviteCodeInput.value.trim().toUpperCase();
          if(!code){
            alert('è¯·è¾“å…¥é‚€è¯·ç ');
            return;
          }
          if(code.length < 4){
            alert('é‚€è¯·ç æ ¼å¼ä¸æ­£ç¡®');
            return;
          }
          // Find group by invite code
          const group = sampleGroups.find(g => g.inviteCode && g.inviteCode.toUpperCase() === code);
          if(group){
            if(myJoinedGroupIds.has(group.id)){
              alert(`æ‚¨å·²ç»åŠ å…¥äº†ã€Œ${group.name}ã€ç¾¤ç»„`);
            } else {
              myJoinedGroupIds.add(group.id);
              saveJoinedGroups(); // persist to localStorage
              alert(`æˆåŠŸåŠ å…¥ã€Œ${group.name}ã€ç¾¤ç»„ï¼`);
              renderJoinedGroups(); // refresh left sidebar
            }
          } else {
            alert('é‚€è¯·ç æ— æ•ˆï¼Œè¯·æ£€æŸ¥åé‡è¯•');
          }
          inviteCodeInput.value = '';
        });
        
        // Allow Enter key to submit
        inviteCodeInput.addEventListener('keypress', (e)=>{
          if(e.key === 'Enter'){
            joinByCodeBtn.click();
          }
        });

        // Topic card click handler - filter Feed by hashtag
        document.querySelectorAll('.topic-card').forEach(card => {
          card.addEventListener('click', ()=>{
            const tag = card.dataset.topic;
            if(!tag) return;
            // Switch to Feed tab
            tabChips.forEach(c => c.classList.remove('active'));
            document.querySelector('.tab-chip[data-tab="feed"]').classList.add('active');
            feedPanel.style.display = 'block';
            groupsPanel.style.display = 'none';
            activityPanel.style.display = 'none';
            feedSortSelect.style.display = 'inline-block';
            groupSortSelect.style.display = 'none';
            // Filter posts by tag
            const filtered = samplePosts.filter(p => p.tags && p.tags.includes(tag));
            if(filtered.length > 0){
              renderPosts(filtered);
            } else {
              postsList.innerHTML = `<div style="text-align:center;padding:40px;color:#999;"><i class="fas fa-search" style="font-size:48px;margin-bottom:16px;display:block;color:#ddd;"></i>æš‚æ—  #${escapeHtml(tag)}# ç›¸å…³åŠ¨æ€</div>`;
            }
          });
        });

        // Composer and like handling implemented earlier (avoid duplicate handlers)

        // Show Feed panel by default, hide Groups panel
        (function initPanels(){
          feedPanel.style.display='block';
          groupsPanel.style.display='none';
          activityPanel.style.display='none';
        })();

        // ========== åˆ›å»ºç¾¤ç»„åŠŸèƒ½ ==========
        const createGroupModal = document.getElementById('createGroupModal');
        const openCreateGroupBtn = document.getElementById('openCreateGroupBtn');
        const closeCreateGroupBtn = document.getElementById('closeCreateGroupBtn');
        const cancelCreateGroupBtn = document.getElementById('cancelCreateGroupBtn');
        const submitCreateGroupBtn = document.getElementById('submitCreateGroupBtn');
        const generatedInviteCode = document.getElementById('generatedInviteCode');
        const copyNewCodeBtn = document.getElementById('copyNewCodeBtn');
        
        // ç”Ÿæˆéšæœºé‚€è¯·ç 
        function generateInviteCode(){
          const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
          let code = '';
          for(let i=0; i<6; i++) code += chars[Math.floor(Math.random()*chars.length)];
          return code;
        }
        
        // æ‰“å¼€å¼¹çª—
        openCreateGroupBtn.addEventListener('click', ()=>{
          generatedInviteCode.textContent = generateInviteCode();
          document.getElementById('newGroupName').value = '';
          document.getElementById('newGroupDesc').value = '';
          document.getElementById('newGroupCategory').value = 'å­¦ä¹ ';
          createGroupModal.classList.add('show');
        });
        
        // å…³é—­å¼¹çª—
        function closeModal(){
          createGroupModal.classList.remove('show');
        }
        closeCreateGroupBtn.addEventListener('click', closeModal);
        cancelCreateGroupBtn.addEventListener('click', closeModal);
        createGroupModal.addEventListener('click', (e)=>{
          if(e.target === createGroupModal) closeModal();
        });
        
        // å¤åˆ¶é‚€è¯·ç 
        copyNewCodeBtn.addEventListener('click', ()=>{
          const code = generatedInviteCode.textContent;
          navigator.clipboard.writeText(code).then(()=>{
            copyNewCodeBtn.textContent = 'å·²å¤åˆ¶';
            setTimeout(()=>{ copyNewCodeBtn.textContent = 'å¤åˆ¶'; }, 1500);
          });
        });
        
        // æäº¤åˆ›å»ºç¾¤ç»„
        submitCreateGroupBtn.addEventListener('click', ()=>{
          const name = document.getElementById('newGroupName').value.trim();
          const desc = document.getElementById('newGroupDesc').value.trim();
          const category = document.getElementById('newGroupCategory').value;
          const inviteCode = generatedInviteCode.textContent;
          
          if(!name){
            alert('è¯·è¾“å…¥ç¾¤ç»„åç§°');
            return;
          }
          if(name.length < 2){
            alert('ç¾¤ç»„åç§°è‡³å°‘2ä¸ªå­—ç¬¦');
            return;
          }
          
          // åˆ›å»ºæ–°ç¾¤ç»„
          const newId = Math.max(...sampleGroups.map(g=>g.id)) + 1;
          const newGroup = {
            id: newId,
            name: name,
            desc: desc || 'æš‚æ— ç®€ä»‹',
            members: 1,
            category: category,
            inviteCode: inviteCode
          };
          
          // æ·»åŠ åˆ°ç¾¤ç»„åˆ—è¡¨
          sampleGroups.push(newGroup);
          
          // è‡ªåŠ¨åŠ å…¥è‡ªå·±åˆ›å»ºçš„ç¾¤ç»„
          myJoinedGroupIds.add(newId);
          
          // åˆ·æ–°ç•Œé¢
          renderJoinedGroups();
          
          alert(`ç¾¤ç»„ã€Œ${name}ã€åˆ›å»ºæˆåŠŸï¼\né‚€è¯·ç ï¼š${inviteCode}`);
          closeModal();
        });

      })();
      </script>
</body>
</html>